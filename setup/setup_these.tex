%\usepackage[a4paper]{geometry}

\usepackage[top=2.5cm, bottom=2cm, left=3cm, right=2.5cm, headheight=15pt]{geometry}

\def\titlepage{
	\newpage
	\centering
	\linespread{1}
	\normalsize
	\vbox to \vsize\bgroup\vbox to 9in\bgroup
}
\def\endtitlepage{
	\par
	\kern 0pt
	\egroup
	\vss
	\egroup
	\cleardoublepage
}

\pagestyle{empty}
\makeatletter
	\def\@ecole{école}
	\newcommand{\ecole}[1]{\def\@ecole{#1}}

	\def\@specialite{Spécialité}
	\newcommand{\specialite}[1]{\def\@specialite{#1}}

	\def\@directeur{directeur}
	\newcommand{\directeur}[1]{\def\@directeur{#1}}

	\def\@encadrant{encadrant}
	\newcommand{\encadrant}[1]{\def\@encadrant{#1}}
	
	\def\@jurya{}{}{}
	\newcommand{\jurya}[3]{\def\@jurya{#1,	& #2	& #3\\}}
	
	\def\@juryb{}{}{}
	\newcommand{\juryb}[3]{\def\@juryb{#1,	& #2	& #3\\}}
	
	\def\@juryc{}{}{}
	\newcommand{\juryc}[3]{\def\@juryc{#1,	& #2	& #3\\}}
	
	\def\@juryd{}{}{}
	\newcommand{\juryd}[3]{\def\@juryd{#1,	& #2	& #3\\}}
	
	\def\@jurye{}{}{}
	\newcommand{\jurye}[3]{\def\@jurye{#1,	& #2	& #3\\}}
	
	\def\@juryf{}{}{}
	\newcommand{\juryf}[3]{\def\@juryf{#1,	& #2	& #3\\}}
	
	\def\@juryg{}{}{}
	\newcommand{\juryg}[3]{\def\@juryg{#1,	& #2	& #3\\}}
	
	\def\@juryh{}{}{}
	\newcommand{\juryh}[3]{\def\@juryh{#1,	& #2	& #3\\}}
	
	\def\@juryi{}{}{}
	\newcommand{\juryi}[3]{\def\@juryi{#1,	& #2	& #3\\}}
\makeatother

\newcommand\BackgroundPic{%
	\put(0,0){%
		\parbox[b][\paperheight]{\paperwidth}{%
			\includegraphics[height=0.45\paperheight]{Bordure.png}%
			\vfill
		}
	}
}
\newcommand\EtiquetteThese{%
	\put(0,0){%
		\parbox[t][\paperheight]{\paperwidth}{%
			\hfill
			\colorbox{blue}{
				\begin{minipage}[b]{3em}
					\centering\Huge\textcolor{white}{T\\H\\E\\S\\E\\}
					\vspace{0.2cm}
				\end{minipage}
			}
		}
	}
}

\makeatletter
\newcommand{\firstpage}{
	\newgeometry{top=2.5cm, bottom=2cm, left=2cm, right=1cm}
	\AddToShipoutPicture*{\BackgroundPic}
	\AddToShipoutPicture*{\EtiquetteThese}
	\begin{titlepage}
		\centering
			\includegraphics[width=0.2\textwidth]{upmc}
			\hfill
			\includegraphics[width=0.2\textwidth]{sorbonne}\\
		\vspace{1cm}
			{\Large \'{E}cole doctorale 364 : Sciences Fondamentales et Appliquées}\\
		\vspace{1cm}
			{\huge {\bfseries Doctorat ParisTech}\\
		\vspace{0.5cm}
			TH\`{E}SE}\\
		\vspace{1cm}
			{\bfseries pour obtenir le grade de docteur délivré par}\\
		\vspace{1cm}
			{\huge\bfseries \@ecole}\\
		\vspace{0.5cm}
			{\Large{\bfseries Spécialité doctorale ``\@specialite''}}\\
		\vspace{2cm}
			\textit{présentée et soutenue publiquement par}\\
		\vspace{0.5cm}
			{\Large {\bfseries \@author}} \\
		\vspace{0.5cm}
			le \@date \\
		\vfill
			{\LARGE \color[rgb]{0,0,1} \bfseries{\@title}} \\
		\vfill
			Directeur de thèse : {\bfseries \@directeur}\\
			Co-encadrant de thèse : {\bfseries \@encadrant}\\
		\vfill
		\begin{tabular}{>{\bfseries}llr}
			\large Jury\\
			\@jurya
			\@juryb
			\@juryc
			\@juryd
			\@jurye
			\@juryf
			\@juryg
			\@juryh
			\@juryi
		\end{tabular}
		\vfill
	\end{titlepage}
	\restoregeometry
}
\makeatother

%%%%%%%%%%%
% Preface %
%%%%%%%%%%%

\def\abstract{
	\begin{center}{
		\large\bf Abstract}
	\end{center}
	\small
	%\def\baselinestretch{1.5}
	\linespread{1.5}
	\normalsize
}

\def\endabstract{
	\par
}

\newenvironment{acknowledgements}{
	\cleardoublepage
	\begin{center}{
		\large \bf Acknowledgements}
	\end{center}
	\small
	\linespread{1.5}
	\normalsize
}{\cleardoublepage}

\def\endacknowledgements{
	\par
}

\newenvironment{dedication}{
	\cleardoublepage
	\begin{center}{
		\large \bf Dedication}
	\end{center}
	\small
	\linespread{1.5}
	\normalsize
}{\cleardoublepage}

\def\enddedication{
	\par
}

\usepackage{setspace}
\def\preface{
		\pagenumbering{roman}
		\pagestyle{plain}
%		\doublespacing
}

\makeatletter
\def\chapapp2{Chapter}

\def\ps@pheadings{
	\let\@mkboth\markboth
	% modifications
	\def\@oddhead{
		\protect\underline{
			\protect\makebox[\textwidth][l]
			{\sl\rightmark\hfill\rm\thepage/\pageref{pba}}
		}
	}
	\def\@oddfoot{}
	\def\@evenfoot{}
	\def\@evenhead{
		\protect\underline{
			\protect\makebox[\textwidth][l]
			{\rm\thepage\hfill\sl\leftmark}
		}
	}
	% end of modifications
	\def\chaptermark##1{
		\markboth{
			\ifnum \c@secnumdepth >\m@ne
			\chapapp2\ \thechapter. \ \fi ##1
		}{}
	}
	\def\sectionmark##1{
		\markright {
			\ifnum \c@secnumdepth >\z@
			\thesection. \ \fi ##1
		}
	}
}
\makeatother

%%%%%%%%%%%%
% Body     %
%%%%%%%%%%%%
%\usepackage[draft]{todonotes}

%uhead
\makeatletter
\def\chapapp2{Chapter}

\def\ps@uheadings{
	\let\@mkboth\markboth
	% modifications
	\def\@oddhead{
		\protect\underline{
			\protect\makebox[\textwidth][l]
			{\sl\rightmark\hfill\rm\thepage/\pageref{pba}}
		}
	}
	\def\@oddfoot{}
	\def\@evenfoot{}
	\def\@evenhead{
		\protect\underline{
			\protect\makebox[\textwidth][l]
			{\rm\thepage/\pageref{pba}\hfill\sl\leftmark}
		}
	}
	% end of modifications
	\def\chaptermark##1{
		\markboth{
			\ifnum \c@secnumdepth >\m@ne
			\chapapp2\ \thechapter. \ \fi ##1
		}{}
	}
	\def\sectionmark##1{
		\markright {
			\ifnum \c@secnumdepth >\z@
			\thesection. \ \fi ##1
		}
	}
}
\makeatother

\makeatletter  %to avoid error messages generated by "\@". Makes Latex treat "@" like a letter

\usepackage{setspace}
\def\body{
%		\cleardoublepage
%		\pagestyle{pheadings}
%		\listoftodos[ToDo]
%		\pagestyle{plain}

		\cleardoublepage
		\pagestyle{pheadings}
%		\addtocontents{toc}{\protect\setcounter{tocdepth}{-1}}
		\dominitoc
		\tableofcontents
%		\addtocontents{toc}{\protect\setcounter{tocdepth}{3}}
		\pagestyle{plain}
		
		\cleardoublepage
		\pagestyle{uheadings}
		\dominilot
		\listoftables
		\pagestyle{plain}
		
		\cleardoublepage
		\pagestyle{uheadings}
		\dominilof
		\listoffigures
		\pagestyle{plain}
		
		\cleardoublepage
		\pagestyle{uheadings}
		\printacronyms[include-classes=abbrev,name=\huge{Abbreviations}]
		\pagestyle{plain}
		
		\cleardoublepage
		\pagestyle{uheadings}
	\printacronyms[include-classes=nomencl,name=\huge{Nomenclature}]
		\pagestyle{plain}

		\cleardoublepage
		\pagestyle{uheadings}
		\pagenumbering{arabic}
%		\doublespacing
}

\def\bodytmp{
		\cleardoublepage
		\pagestyle{uheadings}
		\pagenumbering{arabic}
		\doublespacing
}
\makeatother	%to avoid error messages generated by "\@". Makes Latex treat "@" like a letter


%%%%%%%%%%%%
% Appendix %
%%%%%%%%%%%%
\def\Appendix{
	\label{pba}
	\appendix
	\pagestyle{plain}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Accronime et abriviation
\usepackage{acro}
	\acsetup{first-style=short}
%	\acsetup{first-long-format=\itshape}
	\newcommand{\addac}[2]{
		\DeclareAcronym{#1}{
			short = \ensuremath{#1},
			long  = {#2},
			sort  = {#1},
			class = nomencl
		}
	}
	\newcommand{\addab}[2]{
		\DeclareAcronym{#1}{
			short = {#1} ,
			long  = {#2},
			sort  = {#1},
			class = abbrev
		}
	}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{lmodern}
\usepackage{ae,aecompl} 		% Utilisation des fontes vectorielles modernes
\usepackage[upright]{fourier}

%% Maths
\usepackage{amsmath}			% Permet de taper des formules mathématiques
\usepackage{amssymb}			% Permet d'utiliser des symboles mathématiques
\usepackage{amsfonts}			% Permet d'utiliser des polices mathématiques
\usepackage{nicefrac}			% Fractions 'inline'

\usepackage[version=3]{mhchem}	% Equations chimiques
\usepackage{textcomp}
\usepackage{array}
\usepackage{hyphenat}
\usepackage{longtable}
\usepackage{lscape}

\usepackage{eso-pic}
\usepackage{import}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section
\usepackage[section]{placeins}	% Place un FloatBarrier à chaque nouvelle section
\usepackage{epigraph}
\usepackage[font={small}]{caption}
\usepackage{minitoc}		% Mini table des matières, en français
	\setcounter{minitocdepth}{4}
	\setlength{\mtcindent}{12pt}
	\renewcommand{\mtcfont}{\small\rm}
	\renewcommand{\mtcSfont}{\small\bf}
%	\setcounter{mtc}{2}
%\usepackage[notbib]{tocbibind}		% Ajoute les Tables	des Matières/Figures/Tableaux à la table des matières


% Item
\usepackage{enumerate}
\usepackage{enumitem}
	\setlist[enumerate]{topsep=-0.5cm,itemsep=0ex,partopsep=0ex,parsep=0ex}
	\setlist[itemize]{topsep=-0.5cm,itemsep=0ex,partopsep=0ex,parsep=0ex}

% Chapter
\usepackage{titlesec, blindtext}
	\titleformat{\chapter}[hang]
		{\Huge\bfseries}
		{\violet{\thechapter\hspace{20pt}|\hspace{20pt}}}{0pt}
		{\Huge\bfseries}

% Tableaux
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{threeparttable}
\usepackage{etoolbox}
	\appto\TPTnoteSettings{\footnotesize}

% Images
%\usepackage{graphicx}			% Permet l'inclusion d'images
%	\graphicspath{ {./res/} }
\usepackage{subcaption}
\usepackage{pdfpages}
\usepackage{rotating}
\usepackage{pgfplots}
	\usepgfplotslibrary{groupplots}
\usepackage{tikz}
	\usetikzlibrary{backgrounds,automata}
	\pgfplotsset{width=7cm,compat=1.3}
	\tikzset{every picture/.style={execute at begin picture={%\shorthandoff{:;!?};
			}
		}
	}
	\pgfplotsset{every linear axis/.append style={
		/pgf/number format/.cd,
		use comma,
		1000 sep={\,},
	}}

%%% Texte
%\usepackage{xspace}
%\usepackage[load-configurations = abbreviations]{siunitx}
%	\DeclareSIUnit{\MPa}{\mega\pascal}
%	\DeclareSIUnit{\micron}{\micro\meter}
%	\DeclareSIUnit{\tr}{tr}
%	\DeclareSIPostPower\totheM{m}
%	\sisetup{
%		locale = FR,
%		inter-unit-separator=$\cdot$,
%		range-phrase=~\`{a}~,     	% Utilise le tiret court pour dire "de... à"
%		range-units=single,  		% Cache l'unité sur la première borne
%	}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{etoolbox}
%\makeatletter
%\pretocmd{\chapter}{\addtocontents{toc}{\protect\addvspace{15\p@}}}{}{}
%\pretocmd{\section}{\addtocontents{toc}{\protect\addvspace{1\p@}}}{}{}
%\makeatother


\setcounter{tocdepth}{2}
\newcommand{\symbolfootnote}{\renewcommand{\thefootnote}{\fnsymbol{footnote}}}
\newcommand{\normallinespacing}{\renewcommand{\baselinestretch}{1.5} \normalsize}
\newcommand{\mediumlinespacing}{\renewcommand{\baselinestretch}{1.2} \normalsize}
\newcommand{\narrowlinespacing}{\renewcommand{\baselinestretch}{1.0} \normalsize}
\renewcommand{\theparagraph}{\arabic{paragraph})}
\renewcommand{\thesubparagraph}{\arabic{paragraph}.\arabic{subparagraph})}
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{5}
\setlength{\parskip}{3ex plus 0.5ex minus 0.2ex}


%\usepackage[square,sort&compress,sectionbib]{natbib}		% Doit être chargé avant babel
%\usepackage{chapterbib}
%	\renewcommand{\bibsection}{\section{Références}}		% Met les références biblio dans un \section (au lieu de \section*)
%		
%\usepackage{listofitems}
%	\newcommand\foo[1]{\setsepchar{:}\readlist\foolist{#1}%
%		\foreachitem\x\in\foolist{\fbox{\x}}
%	}

\titleformat*{\chapter}{\normalfont\huge\bfseries\color{violet}}
\titleformat*{\section}{\normalfont\Large\bfseries\color{violet}}
\titleformat*{\subsection}{\normalfont\large\bfseries\color{violet}}
\titleformat*{\subsubsection}{\normalfont\bfseries\color{violet}}
\titleformat*{\paragraph}{\normalfont\bfseries\color{violet}}
\titleformat*{\subparagraph}{\normalfont\color{violet}}

\input{nomenclature}
