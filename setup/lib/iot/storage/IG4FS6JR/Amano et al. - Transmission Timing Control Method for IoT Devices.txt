Transmission Timing Control Method for IoT Devices Equipped with Poor Oscillator
Masaki Amano, Mai Ohta, and Makoto Taromaru Fukuoka University
8-19-1, Nanakuma, Jonan-ku, Fukuoka, 814-0180 Fukuoka, Japan

Abstract—This paper focuses on a spectral efﬁciency for IoT (Internet of Things) with LPWAN (Low Power Wide Area Network). For IoT system, a packet collision causes a loss of sensor information or a waste of wireless resources due to retransmission. One of causes of the packet collision is a time jitter caused by an equipped poor oscillator, even if any packet collision avoidance is performed. Therefore, this paper proposes a method for avoiding the packet collision by controlling devices’ transmission timing with expecting each packet receiving time of IoT devices at a base station. In this paper, by assuming Class A of LoRaWAN as the device’s MAC protocol, the proposed method is evaluated by a computer simulation.
Index Terms—Internet of Things, Low Power Wide Area Network, time jitter, packet collision
I. INTRODUCTION
With the development of IoT (Internet of Things) technology, it is desired to stably communicate a base station with a lot of IoT devices. It is because the IoT base station of LPWAN (Low Power Wide Area Network) has a wide communication range. LoRa [1], SigFox [2], and so on are examples of LPWAN. The conventional study has focused on the amount of an event-driven trafﬁc [3]. However, in almost all IoT system, each device periodically transmits data observed by a sensor to the base station. Thus, the trafﬁc of the IoT system occurs periodically. The IoT devices are used to send its surrounding information to a base station. The surrounding information is observed by sensors at a regular interval.
The IoT system attracts attention as an application of sensor networks. Many researchers are seeking a lot of kinds of information and big data to analyze the surrounding environment. Therefore, in the future, many kinds of services will utilize the IoT system.
However, in most cases of IoT system, no devices are equipped with more expensive oscillator. In case of using low-priced IoT devices, a change of a communication timing occurs gradually more or less corresponding to an accuracy of the oscillator of the devices’ clock. The change of timing is called time jitter in this paper. Moreover, the time jitter is different by each device, because the oscillator of each device is different performance. Therefore, the communication period cannot become constant, even if the IoT device intended to periodically transmit the observed information.
In addition, the time jitter of IoT devices cause a packet collision. If the IoT devices could transmit a packet with an accurate time and all devices are arranged at uniform intervals within a single period, the packet doesn’t collide. To arrange

uniform intervals can be realized by setting each transmission timing for all devices before beginning the transmission or during periodic intervals. However, in the case having the poor oscillator, the amount of time jitter is accumulated with the lapse of time. Then, there is a possibility that the transmitted signals from devices within a same service area are simultaneously received at the base station. Therefore, the time jitter caused by the poor oscillator of cheap IoT devices is one of serious problems.
Furthermore, as a result, such packet collision increases a loss of sensor information or a packet resending. The lack of sensor information causes insufﬁcient analysis for an environment recognition and a big data analysis. In the case of the packet resending, the IoT devices transmitted the packet that collides waste its own energy that is limited corresponding to a battery capacity. In addition, when signals of IoT devices within wide area are transmitted at the same time, the sum of interference power increases instantaneously, because coexisting IoT systems have each different communication cycle. Thus, the time jitter should be considered to avoid the packet collision.
One of solutions for the time jitter due to the cheap IoT devices is a method that a base station always transmits a beacon signal to all IoT devices periodically. In this case, the IoT devices need to wait the beacon. However, while the IoT devices run on battery, the device’s power is continuously consumed for a standby of a reception period. Then, a long reception period leads to shorten one’s life time. Therefore, it is necessary that IoT device corrects the transmission timing caused by the time jitter without preferably receiving a beacon. It is because the battery consumption increases due to the long standby time and the retransmission.
Then, this paper proposes a method to reduce the packet collision by using a control signal for each IoT device. In particular, it is assumed that IoT devices apply LoRaWAN Class A and are equipped with the poor oscillator. In addition, in this paper, the impact of the packet collision caused by each device’s time jitter is showed by a computer simulation.
II. PACKET COLLISION DUE TO TIME JITTER
This paper focuses on the time jitter of IoT devices which are implemented by some cheap hardware. In the future, the IoT network which consists of the low-priced devices increases, because the IoT system is used for many kinds of applications and services. Therefore, it is difﬁcult for IoT

978-1-7281-1340-1/19/$31.00 ©2019 IEEE

132

ICUFN 2019

Fig. 1. Ideal Reception Interval at Base Station without Time Jitter.

Fig. 3. Receiving Window in Class A protocol of RoLaWAN.

III. LORAWAN CLASS A

Fig. 2. Packet Collision by Shifted Reception Timing Due to Time Jitter.
devices to be equipped with an oscillator having a high accuracy. One of examples is TCXO (Temperature Compensated Crystal Oscillator), which is utilized for a wireless device. An accuracy of TCXO is known to be about 1 µsec per 1 sec. The time jitter for any devices occurs more or less, whereas the amount of time jitter depends on the oscillator’s accuracy. In addition, the IoT system periodically transmits the information collected by a sensor. Thus, the time jitter is accumulated for every transmission and then the inﬂuence of the time jitter increases.
Moreover, there is a possibility that packet collision occurs again, even if a transmission timing is adjusted by a database information to avoid a packet collision. For simplicity, it is assumed that two IoT devices (Device A and B) communicate with a base station considering only up link. As shown in Fig. 1, the base station receives from the IoT devices that repeat the communication at a certain prescribed transmission cycle to collect the information at the base station. In the ideal case, a communication interval between two devices does not change. Therefore, the packet collision does not occur. On the other hand, in the real case as shown in Fig. 2, the packet collision occurs gradually at the base station after a while, because the transmission timing is changed duo to the IoT devices’ oscillators having an individual time jitter. The time jitter caused by the poor oscillator does not become zero in most cases.
In the real case, the time jitter leads to a quality deterioration of IoT’s sensor information because the gathering sensor data are regularly lost. Such lack of data can be solved by retransmitting the lost packets. On the other hand, the retransmission method increases a power consumption of IoT’s battery as the number of transmissions increases. A long-term packet collision leads eventually IoT devices to lower battery.
Therefore, the IoT system needs a method for reducing the packet collision. This paper proposes the method for controlling the transmission timing to avoid the packet collision between IoT devices. In addition, the proposed method restrains the power consumption caused by the retransmission.

This paper assumes that LoRaWAN, which is one of LPWAN, applies to IoT system and Class A of LoRaWAN is applied as the system’s MAC protocol [4]. In the LoRaWAN, a symbol is modulated by a chirp modulator. The modulated chirp signal is spread according to a spreading factor (SF). Especially, when the signals of the devices using the same SF value of the LoRaWAN collide, there is the problem that the base station cannot demodulate both transmitted signals with a high probability [5].
In the LoRaWAN Class A, a standby period as an RW (receiving window) is set to two times after its device’s transmission, as shown in Fig. 3. The Class A protocol can restrain IoT device’s power consumption by limiting the device’s receiving window, because the battery of the IoT devices is consumed during the standby period.
In generally, ”receive delay 1” is 1 sec after the packet transmission. The receive delays are decided corresponding to the response time. In addition, at the ﬁrst RW, the IoT device listen to at the same channel as the transmission for receiving an ACK (acknowledgement). If the ACK cannot be received at the device, the second RW is changed to a different channel from the data transmitted channel.
The LoRaWAN Class A is well known as the protocol which can restrain the power consumption. In other words, it is only two chances that the IoT device which applies the Class A can receive a signal from a base station. Thus, to receive a broadcasting signal such as a beacon is difﬁcult for devices with the Class A. As a result, LoRa system with the Class A cannot correct each device’s time jitter by receiving the beacon from a base station.
IV. TRANSMISSION TIMING CONTROL METHOD CONSIDERING TIME JITTER
In this section, our method is explained when the IoT devices apply the LoRaWAN Class A to the MAC protocol. The proposed method does not use a beacon signal to correct the transmission timing of each device. The procedure of the proposed method is described as the follows:
1) At ﬁrst, the base station receives a packet from IoT devices periodically.
2) The base station conﬁrms the communication cycle every IoT devices by checking the IoT device’s ID including in the transmitted packet. Additionally, the reception interval, T , between the transmitted packets is observed at the base station.

133

3) If the reception interval, T , is shorter than a threshold, Tr, the base station decides whether there is a possibility of the packet collision or not.
4) The base station estimates the receiving window (RW) corresponding to the device decided to lead to the packet collision. Then, in order to have the device revise the device’s transmission timing, the base station transmits a control signal based on the decision for the duration of the estimated RW of the device.
5) The device receives the control signal during the RW. 6) Then, the next transmission timing of the device is
revised by following the instruction of the base station. In this paper, when the device receives the control signal, the transmit timing is delayed by a certain period, which is called a shift time length, Ts.
Figure 4 shows the received packets at the base station in the case of Device A and B with time jitter, which is similar to Fig. 2. As shown in Fig. 4, it describes the sequential ﬂow from the packet’s reception without problem to the expectation and the avoidance of the packet collision between both devices.
As mentioned previously, IoT system employs LPWAN, which has the long-communication range. Therefore, IoT devices have each different propagation delay. However, the proposed method does not need to estimate the propagation delay of each device. In our method, the base station estimates the reception timing of packets instead of estimating the transmission timing of each device. The reason is that the packet collision at the base station depends on the reception timing of packets, which are transmitted at each device. Thus, the propagation delay of each device is neglected in this paper.
Moreover, the proposed method can avoid occupying a channel many times in comparison with the timing adjustment based on a beacon such as Class B. In Class B MAC protocol, IoT devices have to receive the beacon at ﬁxed intervals for a reception window except two RWs, which are the same reception window in Class A. Therefore, the energy of the IoT devices that employ Class B becomes lower than that of IoT devices that employ our proposed method. The reason is that the proposed method controls the transmission timing of packet which are expected to collide at the base station by utilizing the regular RWs. Additionally, the control signal is not transmitted to the devices that did not transmit the sensor data to the base station and the devices of which the base station did not receive the transmitted signal. In the proposed method, the avoidance effect of the device’s energy consumption caused by the oscillator’s time jitter can be expected as above.
V. SIMULATION EVALUATION
A. Simulation Parameters and Assumptions
In this subsection, the simulation parameters and assumptions are explained. This paper assumes that the IoT device is equipped with TCXO. The time jitter caused by TCOX is calculated by multiplying 1 µsec by value generated by standard normal distribution. Therefore, the employed time jitter

Fig. 4. Transmission Timing Control at Base Station in Proposed Method.

TABLE I BIT RATE IN LORAWAN

Spreading Factor (bandwidth: 125kHz)
SF7 SF8 SF9 SF10

Indicative physical bit rate [bit/s] 5470 3125 1760 980

of each device differs from device to device. For simplicity, the device’s time jitter is accumulated every second repetition during the simulation period.
The simulations start in the ideal state that all IoT devices does not interfere with other devices as shown in Fig. 1. In other words, all transmission periods of each device are separated with a uniform interval as given by:

TrINI

=

T INT D

−

LP,

(1)

where T INT indicates system’s transmission interval which is

prescribed by system’s own speciﬁcation. This paper assumes

the system’s speciﬁcation does not change during the simula-

tion period. D is the number of devices within the service

area of one base station, and LP is a packet length per a

transmission of the device. In this paper, the packet length

is ﬁxed during the simulation period. The packet length is

described by:

LP

=

Nbit , Rbit

(2)

where Nbit is the number of bits of the transmit signal of the device, and Rbit is a bit rate of the device of LoRaWAN system. The bit rate is given by [1]:

BW

Rbit = SF · 2SF ,

(3)

where BW is a signal’s bandwidth, and SF indicates SF in LoRa modulation. Table I shows the bit rate according to SF as referred to [6] when the signal’s bandwidth is 125 kHz.
As indicated by Eq. 2 and Eq. 3, SF decides the packet length per a transmission. The packet length does not change, because it is assumed that the number of bit per a packet, Nbit, is constant value during the simulation period. Therefore, in the ideal case without the time jitter, each device transmits the sensor information to the base station at T INT periodically. On the other hand, in the real environment, the time jitter is

134

TABLE II SIMULATION PARAMETERS

The number of device MAC protocol Packet size, Nbit
Bandwidth, BW Transmission interval, T INT Reception interval threshold, Tr
Shift time length, Ts Simulation time
The number of trial

1000 LoRaWAN Class A 240 bits (30 bytes)
125 kHz 10 minutes 100 msec 100 msec
1 week 10

added to T INT. When the time jitter is described by TiJT, the transmission interval of the i-th device is denoted by:

TiI,NnTrep = T INT + TiJT · nrep,

(4)

where nrep is the number of repetition of transmission. For simplicity, this paper assumes that a control signal
transmitted from a base station can be received at a destination device without packet collisions. The base station can know the destination device’s identiﬁcation (ID) by demodulating the received signal of the transmission device. The reason is that the signal transmitted by the IoT device is a sensor information including the device’s ID. In addition, the received signal can also be used for estimating a packet collision timing. Therefore, the base station can estimate all devices’ signal receiving time. A control signal is transmitted from the base station to the estimated device. The device received signal changes the data transmission timing corresponding to the control signal. As a result, the base station can control the devices’ transmission timing to avoid the packet collision.
In this simulation, the shift time length, Ts, and the reception interval threshold, Tr, are constant during the simulation period. The transmission interval, T INT, and the packet size, Nbit, are the same value for every devices. The time jitter is generated device by device. Table II shows the parameters for simulation evaluation.
In this paper, we arrange that the reception interval threshold, Tr, and the shift time length, Ts, are 100 msec, respectively. Note that we need to discuss these time lengths in order to decide appropriate values.

B. Simulation Results
In this paper, in order to consider the worst case, it is assumed that the packet collision occurs when transmitting periods of each device existing within a service area overlap. In addition, all devices within the service area use the same SF value. The simulation results based on each SF are shown in Fig. 5. The vertical axis is a transmission successful rate without causing packet collision during the simulation. The horizontal axis is SF from seven to ten. If the SF is lager, the packet length becomes longer as described in Eqs. 1-3. In this simulation evaluation, the transmission successful rate in three cases are shown in Fig. 5. The case A is the ideal situation where the time jitter does not occur in. The case B indicates the real situation with the time jitter. The last one is the case

Fig. 5. Packet collision rate due to overlap of transmission.
C that the device is controlled by the proposed method in the situation with the time jitter.
First of all, in the case A of the ideal state without time jitter, the transmission successful rate according to each SF is 100 percent. This is because all devices’ communication timing does not change from the initial state. The initial state indicates that the transmission timing is always separated by a uniform interval because of no time jitter.
In the second case B, which includes the time jitter in the transmission interval, the successful rate decreases as compared with that of case A. It is clear that the cause is the time jitter of each device. Moreover, the simulation result shows that the successful rate gets worse when the SF is bigger. It can be conceivable that the packet collision happens at an early stage by the accumulated time jitter because the reception interval, T , is inversely proportional to IoT devices’ packet length, LP . In the case that SF equals 10, the IoT communication fails with the probability of about 30 percent in the simulation. Therefore, it is clear that the time jitter has much bad inﬂuence to the communication in the state being no interference. When the number of devices increases, the similar result will be obtained because the reception interval, T , is shorter similarly.
Finally, in the case C using proposed method where there is the time jitter, the transmission successful rate is improved as compared with that of case B. However, it is not completely successful. That is to say, the packet collision occurs several times. This is because the reception interval between the revised packet and a received packet subsequent to its packet becomes conversely narrow after the base station instructs IoT devise to revise the transmission timing. Therefore, the instruction could be a factor of other packet collisions. The proposed method requires that the base station recognizes the communication state of the surrounding IoT devices for a long period of time to avoid a new packet collision.

135

VI. CONCLUSION This paper focuses on the impact of a cheap IoT device equipped with a poor-quality oscillator. In the future, the cheap device increases because the IoT systems used in wide area is put to practical use. While the IoT devices communicate periodically with a base station, the time jitter caused by cheap oscillator leads to packet collisions. Therefore, in order to avoid a loss of sensor information and a waste of wireless resources, this paper proposes the transmission timing control method by estimating a receiving time of each device. From the simulation results, the impact caused by the time jitter and the efﬁciency of the proposed method are showed.
ACKNOWLEDGMENT This research was supported by the MIC/SCOPE #175104004.
REFERENCES
[1] Semtech Corporation, “AN1200.22, LoRa Modulation Basics,h Available: https://www.semtech.com/uploads/documents/an1200.22.pdf.
[2] Sigfox, http//ww.sigfox.com. [3] V. Gupta, S. K. Devar, N. H. Kumar, K. P. Bagadi, “Modelling of
IoT Trafﬁc and Its Impact on LoRaWAN,” Proc. in IEEE Global Communications Conference (GLOBECOM) 2017, Dec., 2017. [4] LoRa Alliance, “LoRaWAN Speciﬁcation v1.1,” 2017, Available: https://lora-alliance.org/resource-hub/lorawantm-speciﬁcation-v11. [5] N. E. Rachkidy, A. Guitton, M. Kaneko, “Decoding Superposed LoRa Signals,” Proc. in IEEE Conference on Local Computer Networks (LCN) 2018, Oct. 2018. [6] LoRa Alliance, “LoRaWAN 1.1 Regional Parameters v1.1,” 2017, Available: https://lora-alliance.org/resource-hub/lorawantm-regionalparameters-v11rb.
136

