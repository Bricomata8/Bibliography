Pricing-based shared energy storage optimization for residential users with photovoltaic generation
system and demand-side load management
Insook Kim and Dongwoo Kim The Department of Electronic and Communication Engineering
Hanyang University, Ansan, 426-791 South Korea Email: {kimins, dkim}@hanyang.ac.kr

Abstract—In this paper, we investigate a problem of optimal capacities of energy storage system for the residential users and an optimal unit price energy storage system for an aggregator. We suppose that the residential users have own photovoltaic generation system and a smart meter which can schedule activation of home appliances and controls. The aggregator participates in energy market to maximize his proﬁt by selling the storage to the residential users. Each user determines his energy consumption schedule and a required amount of storage to minimize his energy cost depending on the unit price of energy storage, price proﬁle of electricity from the main grid and his renewable power generation capacity. We consider electricity bill from main grid and storage bill from the aggregator as users’ energy cost. We formulate a problem for the aggregator to decide an optimal unit price of energy storage and a problem for each user to decide energy consumption schedule and a required amount of storage capacity. With numerical investigation, it is shown that the energy storage can reduce the energy load to main grid and shave peak power. As a result, by purchasing energy storage, users can save their energy cost by 43% in average compared to the case without energy storage.
Index Terms—Energy storage system, residential photovolatic generation, home load management, aggregator, smart grids
I. INTRODUCTION
In power markets, renewables have become the technology of choice, making up almost two-thirds of global capacity additions to 2040, thanks to falling costs and supportive government policies [1]. However, technical limitations in transmission and distribution networks, the variability of renewable power sources, people’s behaviors, and energy consumption patterns have made it difﬁcult to integrate and accommodate these sources. The integration of storage technologies has emerged as an option to expedite energy consumption from renewable sources by increasing the ﬂexibility of the power system [2]. Energy storage can store energy when there is less demand and release the stored energy back to the system during peak periods [3].
Energy storage systems (ESSs) are especially desirable at the residential level and the adoption of the household
This research was supported by Basic Science Research Program through the National Research Foundation of Korea(NRF) funded by the Ministry of Education (2016R1A6A3A11934581).

energy storage system is expected to increase rapidly in the coming years [4]. However, considering their high acquisition, operation, and maintenance costs, isolated deployment of ESSs is not economically viable [5]. Since the idea of a shared ESS among users and network operator has been introduced in [3], the energy management problem for users with shared ESSs has been studied in the literature [3],[5]-[6].
In [7], they solved the cost minimization problem for energy consumers with demand response capability with no renewable energy integration. The self-interested users are willing to sell/buy energy to/from the shared ESS if they can achieve lower energy costs compared to the case of no energy trading while preserving their privacy in [8][9]. They proposed an iterative algorithm by which the central controller coordinates the charging/discharging values to/from the shared ESS by all users such that their individual energy costs reduce at the same time. A heuristic algorithm for optimizing the electricity cost by using the concept of load shifting and renewable power sharing among houses in the microgrid for a particular price was proposed in [6]. In [5], they have developed a stochastic analytical framework to provision a sharing-based energy storage units and shown that ESS at residential level is economically beneﬁcial if employed in a sharing-based architecture. However, the previous works in [8]-[6] assume that the capacity of storage is assumed to be given and ﬁxed.
ESS sizing has received some attention in the literature [5], [10]-[11]. Majority of the existing literature focus on energy storage sizing for isolated deployment of ESSs. In [5], they propose a sharing-based ESS architecture and the optimal size of ESSs is analyzed. But, the analysis in [5] do not consider renewable energy generation at each user site. In [12], we investigated an optimal capacity of shared ESS for cooperative residential users with individual photovoltaic generation system. In [13], they investigate the problem of ﬁnding optimal capacities of PV and ESS in the context of home load management in smart grids. However they assume that a user installs an individual ESS as well as PVS. In [11], they proposed a pricing-based virtual storage sharing scheme among a group of users and developed a business model that an aggregator owns and operates a central physical

978-1-7281-1340-1/19/$31.00 ©2019 IEEE

466

ICUFN 2019

storage unit, then virtualizes the storage into separable virtual storage capacities and sells them to different users. They demonstrated that virtualization of storage will lead to more efﬁcient use of the physical storage capacity, compared with the case where each user acquires his own physical storage. They did not take into account renewable energy sources at individual household users and assumed the original load is ﬁxed and there is no demand response. However, users with renewable energy generation facilities will need storage and storage accompanying with demand response effects on peak shaving.
In this paper, we investigate a problem of optimal capacities of energy storage system and its optimal price for residential users who have own photovoltaic generation system and a smart meter which can schedule activation of home appliances and controls. We consider an important player, so called aggregater, who owns and operates an energy storage system. The aggregator virtualizes the storage into separable virtual storage capacities and sells them to different users. The aggregator decides an unit price of storage to maximize her proﬁt. Depending on the unit price of energy storage, price proﬁle of electricity from the main grid and his renewable power generation capacity, each user determines his energy consumption schedule and a required amount of storage capacity to minimize his energy cost (including electricity bill from main grid and storage bill from the aggregator), and purchase the amount of storage capacity from the aggregator. A user charges the remaining energy of the electric energy generated in its photovoltaic system and discharges his storage to satisfy demand. Also we consider that users have a smart meter which can schedule activation of home appliances and controls, residential energy generation and storage system. We formulate a problem for the aggregator to decide an optimal unit price of energy storage and a problem for each user to decide energy consumption schedule and a required amount of storage. With numerical investigation, it is shown that the energy storage can reduce the energy load to main grid and shave peak power and thus users’ energy cost.
The rest of this paper is organized as follows. Section II introduces our system model including PV generation, energy storage system and residential load control model. In Section III, the problems are formulated for users and for the aggregator. Section IV provides some numerical results, which include optimal unit price of storage, users’ load proﬁle, peak load, and ﬁnally energy cost with compared with the case of which ESS is not installed. Section V concludes this paper.
II. SYSTEM MODEL
We consider a set of N > 1 users. Users are all connected to the main grid, which consists of conventional fossil fuel based energy generation units. We assume that each user has its own solar photovoltaic generators supplying a part or all of their loads over time. We consider that an aggregator owns and operates the central storage. The aggregator sells a storage to users. Users purchase the capacity to store energy when there is less demand and release the stored energy back to the system

Main grid

SM

PVS

HLM

HA

Residential users

SM

PVS

SM : Smart meter

HLM

HA

HLM : Home load management

HA : Home appliances

PVS : Photovoltaic generation system

Fig. 1. System structure.

Storage aggregator
Power flow Communications

during their peak load. By purchasing the storage system from the aggregator, a user can charge the remaining quantity of the electric energy generated in its photovoltaic system and discharge his storage to satisfy his demand and thus reduce his peak as well as total consumption of the electricity bill.
We assume an operation horizon by H {1, 2, . . . , H}. At the beginning of each operation horizon, the aggregator determines the unit price qes of storage capacity for this horizon and announces it to users. Each user n ∈ N decides the storage capacity for the next operation horizon and storage schedule for each time slot h, reports them to the aggregator [11]. And we assume that each user is equipped with a smart meter that has a home load management capability for scheduling the household energy consumption as well as photovolatic generation system (PVS) and energy storage system (ESS). The energy generated in PVS (located at user n’s home) at hour h can be immediately used for the user at that time or be stored in the storage (purchased from the aggregator).

A. Photovoltaic generation model

We assume that the amount of electricity a solar panel produces is upper-bounded by the area of solar panels. Photovoltaic energy generation proﬁled, denoted by gn[h] is

gn[h] ≤ κn[h]c¯pnv,

(1)

where c¯pnv is solar panels’ power capacity of user n and κn[h](> 0) is an hourly power production efﬁciency of PVS. κn[h] is forecasted and given to the system, which mainly depends on the availability of the solar radiation that is a
function of sky clearness index.

B. Energy storage model
Let a stock variable sn[h] be per-slot energy storage proﬁle measured at the end of time slot h. Two ﬂow variables scn[h] and sdn[h] denote per-slot energy charging and discharging proﬁle of user n at hour h, respectively. Then
sn[h] = βsn[h − 1] + scn[h] − sdn[h], for h > 1, (2)

467

where 0 ≤ β ≤ 1 is a leakage rate that represents the decrease in the energy level with the passage of time. We assume that

scn[h] ≤ δc (gn[h] − gnu[h]) ,

(3)

sdn[h] ≤ sn[h − 1], for h > 1,

(4)

where gnu[h] denotes energy generated by PV at hour h and immediately used at that time slot in user n. To complete the equation in (2), we deﬁne an auxiliary variable s[0] to
represent an initial state of energy storage. We assume that s[0] = s[H], which is, to ensure that the storage keeps a
desired level of charge at the end of time horizon of analysis
and to prevent any type of free leakage from or free inﬂux into
energy storage. Furthermore, the storage capacity purchased by user n, denoted by cens is depending on user n’s charge and discharge decision and the energy level. cens can be determined by the following constraint.

sn[h] ≤ cens.

(5)

There are some energy losses during the charging and discharging processes of the energy storage in practice, which are speciﬁed by charging and discharging efﬁciency parameters, denoted by 0 < δc < 1 and 0 < δd < 1, respectively.

C. Residential load control

We assume that the energy consumption by home appliances
a ∈ An per time unit for user n is controlled by home load management (HLM), denoted by {xan[h]}. For each user n, let An denote a set of household appliances. xan[h] can be determined depending on the appliance’s energy consumption
pattern. We consider three types of the appliances according
to energy consumption pattern: non-shiftable, power-shiftable
and time-shiftable [13]. Non-shiftable appliances such as heaters consume a ﬁxed amount of energy ζna during a ﬁxed operation period. The consumption requirement by non-
shiftable appliances can be written as

xan[h] =

ζna, if h ∈ {hans, · · · , hanf }. 0, elsewhere.

(6)

For power-shiftable appliances such as electric vehicles, the
smart meter will schedule ﬂexible power. They have a standby (lower) power(ηal) and a maximum working power (ηam).
Thus, the the scheduling is constrained by

ηal ≤ xan[h] ≤ ηam.

(7)

For a time-shiftable case, the smart meter is able to control

the switch of electricity supply corresponding to the energy

consumption pattern during the scheduled period. Suppose

that appliance a ∈ An has a ﬁxed energy consumption

[pan[1], · · · , pan[H]]. The schedule result xan[1], · · · , xan[H]

xan has to be exactly the same as one of the cyclic shifts. We

deﬁne

a

matrixforpman,1Pan

as pan,2

···

pan,23

pan,24 

Pan

= 

pan,24 ...

pan,1 ...

··· ...

pan,22 ...

pan,23 ...

 ,

(8)

pan,2 pan,3 · · · pan,24 pan,1

where superscript h in an element pan,h denotes the starting time of shift. The switch control for the time-shiftable ap-

pliance can be represented by a binary integer vector uan = [uan[1], · · · , uan[H]]. Time-shiftable appliances are assumed not to be allowed to stop once they start and the constraint can be

written as

uan,h = 1.

(9)

h∈H

We can write the schedule plan for time-shiftable appliances

as

xan = Panuan.

(10)

Notice that (11) is applicable for time-shitable but non-power shitable scheduling. For a time-shitable and power-shiftable (e.g. electric vehicles), (11) can be modiﬁed to describe ﬂexible energy consumption as follow:

Panluan ≤ xan ≤ Panmuan,

(11)

where boldPnal and Panm denotes the lower and the upper bound matrix of energy consumption, respectively. Each element of Panl and Panm is ﬁlled with ηal and ηam.
For each appliance, daily requirement Ena should be met by its total daily energy consumption

xan[h] ≥ Ena.

(12)

h∈H

Finally, the energy requirement can be met by supplying from main grid, PV generation and the storage. Let ln[h] denote energy load proﬁle by user n at hour h. Then the total load needed by user n is constrained by

ln[h] + gnu[h] + δdsdn[h] ≥ xan[h] + lnc [h].

(13)

where gnu[h] is energy generated by PV at hour h and immediately used at that time slot by user n and sdn[h] is energy discharged from the energy storage for user n at hour h. δd represents discharging efﬁciency (0 ≤ δd ≤ 1). Notice that ln[h] is energy purchased from the main grid with a priori
known prices.

III. PROBLEM FORMULATION
A. User n’s optimization problem
Given the storage unit price qes determined by the aggregator, each user n decides the optimal storage schedule scn[h] and sdn[h] in time slot h and the optimal capacity cens to minimize his cost. User n’s cost consists of two parts, one is the storage payment qescens to aggregator and the other is the electricity bill to the grid operator. If user n’s electricity consumption from the main grid is ln[h] in time slot h ∈ H, user n’s electricity bill in H is :

ρ[h]ln[h] + ρpeak max {ln[h]} ,

(14)

h∈H

h∈H

where ρ[h] is the unit price for energy consumption in time slot h, and ρpeak is the unit price for the peak power consumption
per slot in a billing cycle. To reduce the system peak, the utility company usually sets ρpeak much higher than ρ[h] [11]. Based

468

on the demand charge tariff, there is a clear incentive for a user to shave the peak load. User n’s optimization problem P-Un:

min subject to

qescens

+

h∈H

ρ(h)ln[h]

+

ρpeak

max
h∈H

{ln[h]}(15)

(1) − (7) and (9) − (13),

(16)

all variables are nonnegative,

(17)

uan[h] = 0 or 1.

(18)

In problem P-Un, the unit price qes is assumed to be ﬁxed
in the stage of solving this problem. We denote the optimal solutions to problem P-Un as ln∗[h], scn[h]∗(q), sdn[h]∗(q) and cens∗(q).
The aggregator determines the storage unit price qes to
maximize her proﬁt. The aggregator is paid the total amount of qes cens∗(q). We consider the degradation cost of storage.
n∈N
Repeated charging and discharging cause degradation of the
energy storage devices [14]. We adopt the linear operation cost
model in the literature [11]-[15].

COST(qes) = qop

scn[h]∗(qes) + sdn[h]∗(qes) ,

n∈N h∈H

(19)

where qop is the unit cost of charge and discharge amount and scn[h]∗(q) and sdn[h]∗(q) are optimal decisions of user n by solving problem P-Un. We formulates aggregator’s

optimization problem as follows :

Aggregator’s optimization problem P-A:

max π = qes
q es >0

cens∗(q) − COST(qes)).

(20)

n∈N

IV. NUMERICAL RESULTS

In the simulation, we consider one day as the operation horizon, which is equally divided into H = 24 time slots. We consider a system with nine users. We have designated that the amount of electricity requirement and owned PV capacity are different according to the users. Speciﬁcally, the ﬁrst three users (user1∼user3) are modelled as consumers with large power consumption, the next three users (user4∼user6) as with medium power consumption, and the last three users (user7∼user9) as with the smallest consumption. We use appliances and power consumption patterns from [13] (Table 4 therein). We assume that the installed capacity of PV of each user is 5 kW for large power consumption users (user1∼user3), and 3 kW for the others (user4∼user9), respectively. We use hourly production efﬁciency κn[h] in PVS in [12] and [13]. Proﬁle of solar energy for each user is shown in Fig. 2. The electricity prices over the period of planning are shown in Table I. The peak demand charge per month is ρpeak = 1$/kW . We set the operation cost qop = 1 cents/kWh [11]. We assume that β = 1, δc = δd = 0.95 for ESS parameters. For performance benchmark, we consider the case where users do not purchase ESS from aggregator (labeled as ‘w/o ESS’ in the ﬁgures). The simulation has been carried out using CPLEX 12.6.3.0 in GAMS 24.7.4.

TABLE I THE PRICE OF ELECTRICITY (CENTS/KWH).
hour (h) 1∼4 5 6∼7 8∼20 21 22∼24 price (ρ[h]) 7.5 8.6 9.8 10.6 10.8 9.8

PV energy (kW)

3

2.5
2
1.5
1
0.5
0 0 2 4 6 8 10 12 14 16 18 20 22 24 Hour (h)

user1 user2 user3 user4 user5 user6 user7 user8 user9

Fig. 2. Hourly capacity factor of PV generation.

Fig. 3 shows the aggregator’s proﬁt with respect to storage unit price qes. It is observed that the aggregator’s proﬁt is
not monotone in storage price. In our numerical example, the aggregator’s proﬁt is maximum when the price is about 14
cents/kWh.

Aggregator's profit ($)

6
5
4
3
2
1
0 0
-1

5 10 15 20 25 30 35 40 45 50
price (cents/kWh)

Fig. 3. Aggregator’s proﬁt.

TABLE II OPTIMAL STORAGE CAPACITIES. (KWH)
user1 user2 user3 user4 user5 user6 user7 user8 user9 8.89 4.00 6.49 5.78 1.60 4.86 6.38 1.73 0.97
Fig. 4-6 and Table II show the users’ results of the storage price of 14 cents/kWh. Table II shows the optimal capacities of storage for each user. Fig. 4 represents the sum of the electricity drawn from the main grid for all users. For the case of ‘w/o ESS’, it demands a lot of energy during the night time

469

(when photovoltaic systems cannot generate the electricity)

compared to the daytime. It is observed that the energy demand

of the case of ‘ESS purchase’ is almost smoothed over the day. This is because the surplus energy made in the photovoltaic

2.5

system can be charged in storage and utilized it later. The peak

2

power for the case of ‘ESS purchase’ is 0.68 kW while the

peak power for the case of ‘w/o ESS’ is 6.68 kW. In Fig. 5,

1.5

w/o ESS ESS Purchase

cost ($/day)

1

Energy load profile (kWh)

w/o ESS ESS Purchase

8

7

6

5

4

3

2

1

0 02468

11 13 15 17 19 21 23
Time (hour)

Fig. 4. Users’ energy load proﬁle.
we can see that the peak power of each user can be shaved dramatically by utilizing the energy storage system. It is noted that user3, and user6∼user9 satisfy all their energy demands with their own power generation and they are not in demand for electricity from the main grid. Fig. 6 shows the energy

Peak power (kW)

w/o ESS ESS Purchase
1.8 1.6 1.4 1.2
1 0.8 0.6 0.4 0.2
0 user1 user2 user3 user4 user5 user6 user7 user8 user9
Fig. 5. Peak Power.
cost of users. All users can reduce their cost by storing the remaining PV energy during the day and by using at night. In Fig. 6, the energy cost of users reduce to 17 ∼ 78% (43% in average) by purchasing the storage.
V. CONCLUSIONS In this paper, we studied a problem of optimal capacities of energy storage system and its optimal price for residential users who have own photovoltaic generation system and a smart meter which can schedule activation of home appliances

0.5
0 user1 user2 user3 user4 user5 user6 user7 user8 user9
Fig. 6. Users’ cost.
and controls. We considered an important player, so called aggregater, who owns and operates an energy storage system. The aggregator virtualizes the storage into separable virtual storage capacities and sells them to different users. The aggregator decides an unit price of storage to maximize his proﬁt. Depending on the unit price of energy storage, price proﬁle of electricity from the main grid and his renewable power generation capacity, each user determines his energy consumption schedule and a required amount of storage capacity to minimize his energy cost (including electricity bill from main grid and storage bill from the aggregator), and purchase the amount of storage from the aggregator. We formulated a problem for the aggregator to decide an optimal unit price of energy storage and a problem for each user to decide energy consumption schedule and a required amount of storage. With numerical investigation, it is shown that the energy storage can reduce the energy load to main grid and shave peak power. As a result, purchasing energy storage reduces the users’ energy cost by 43% in average compared to the case without energy storage.
REFERENCES
[1] World Energy Outlook 2018, (accessed March 31, 2019). [Online]. Available: https://www.iea.org/weo2018/
[2] J. M. Lujano-Rojas, R. Dufo-Lo´pez, J. L. Bernal-Agust´ın, and J. P. Catala˜o, “Optimizing daily operation of battery energy storage systems under real-time pricing schemes,” IEEE Transactions on Smart Grid, vol. 8, no. 1, pp. 316–330, 2017.
[3] Z. Wang, C. Gu, F. Li, P. Bale, and H. Sun, “Active demand response using shared energy storage for household energy management,” IEEE Transactions on Smart Grid, vol. 4, no. 4, pp. 1888–1897, 2013.
[4] J. E. Contreras-Ocana, M. A. Ortega-Vazquez, and B. Zhang, “Participation of an energy storage aggregator in electricity markets,” IEEE Transactions on Smart Grid, 2017.
[5] I. S. Bayram, M. Abdallah, A. Tajer, and K. A. Qaraqe, “A stochastic sizing approach for sharing-based energy storage applications,” IEEE Transactions on Smart Grid, vol. 8, no. 3, pp. 1075–1084, 2017.
[6] M. Arikiez, F. Alotaibi, S. Rehan, and W. Rohouma, “Minimizing the electricity cost of coordinating houses on microgrids,” in 2016 IEEE PES Innovative Smart Grid Technologies Conference Europe (ISGT-Europe). IEEE, 2016, pp. 1–6.
[7] K. Paridari, A. Parisio, H. Sandberg, and K. H. Johansson, “Demand response for aggregated residential consumers with energy storage

470

sharing,” in 2015 54th IEEE conference on decision and control (CDC). IEEE, 2015, pp. 2024–2030. [8] K. Rahbar, M. R. V. Moghadam, S. K. Panda, and T. Reindl, “Shared energy storage management for renewable energy integration in smart grid,” in 2016 IEEE Power & Energy Society Innovative Smart Grid Technologies Conference (ISGT). IEEE, 2016, pp. 1–5. [9] ——, “Energy management for demand responsive users with shared energy storage system,” in 2016 IEEE International Conference on Smart Grid Communications (SmartGridComm). IEEE, 2016, pp. 290– 295. [10] A. Oudalov, R. Cherkaoui, and A. Beguin, “Sizing and optimal operation of battery energy storage system for peak shaving application,” in 2007 IEEE Lausanne Power Tech. IEEE, 2007, pp. 621–625. [11] D. Zhao, H. Wang, J. Huang, and X. Lin, “Pricing-based energy storage sharing and virtual capacity allocation,” in 2017 IEEE International Conference on Communications (ICC). IEEE, 2017, pp. 1–6. [12] I. Kim and D. Kim, “Optimal capacity of shared energy storage and photovoltaic system for cooperative residential customers,” in 2017 International Conference on Information and Communications (ICIC). IEEE, 2017, pp. 293–297. [13] S. Jung and D. Kim, “Pareto-efﬁcient capacity planning for residential photovoltaic generation and energy storage with demand-side load management,” Energies, vol. 10, no. 4, p. 426, 2017. [14] H. Wang and J. Huang, “Incentivizing energy trading for interconnected microgrids,” IEEE Transactions on Smart Grid, vol. 9, no. 4, pp. 2647– 2657, 2018. [15] Y. Guo and Y. Fang, “Electricity cost saving strategy in data centers by using energy storage,” IEEE Transactions on Parallel and Distributed Systems, vol. 24, no. 6, pp. 1149–1160, 2013.
471

