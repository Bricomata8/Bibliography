Spectrum Sharing Exploiting
Spectrum Database for LPWA
Yudai Yamazaki†, Takeo Fujii†, Osamu Takyu‡, Mai Ohta§, Koichi Adachi† † Advanced Wireless and Communication Research Center (AWCC), The University of Electro-Communications
1–5–1 Chofugaoka, Chofu, Tokyo 182–8585, Japan Email: {yamazaki, adachi, fujii}@awcc.uec.ac.jp
‡ Shinshu University, 4-17-1 Wakasato, Nagano, 380-8553, Japan Email: takyu@shinshu-u.ac.jp
§ Fukuoka University, 8-19-1, Nanakuma, Jonan-ku, Fukuoka, 814-0180, Japan Email: maiohta@fukuoka-u.ac.jp

Abstract—In the most of current low power wide area (LPWA), packet collisions of uplink communication are controlled by setting duty cycle (DC), which controls the transmission cycle not to exceed the predeﬁned ﬁxed threshold. However, as the number of LPWA nodes increases, the ﬁxed DC fatally increases the number of packet collisions and degrades the communication quality. Therefore, in this paper, we propose an adaptive DC decision algorithm. The proposed algorithm aims at adapting the period that the system interferes with others and reducing the packet loss rate of uplink communication of the whole system to below the required value by adapting DC with the help of measurement-based spectrum database (MSD). In the proposed method, MSD knows the number of LoRa nodes that interfere with the nodes of other systems. The DC is calculated for keeping the period of interference to less than a certain duration. In addition, the DC is also adapted based on the required packet loss rate to improve communication efﬁciency. Computer simulation results show that the allowable interference time ratio and the required packet loss rate can be accurately guaranteed compared to the conventional method with the ﬁxed DC even if the number of nodes increases.
Index Terms—spectrum database, spectrum sharing, LPWA
I. INTRODUCTION
With the development of Internet of Things (IoT) and machine-to-machine (M2M) systems, the number of wireless terminals has been increasing. It is expected that approximately 50 billion terminals will be connected to the Internet by 2020 [1]. Meanwhile, with the increase in demand for IoT devices, technologies are required that can reduce the cost of devices, prolong the lifetime of device batteries and handle small data amount. One of technologies to meet these requirements is wireless communication systems called low power wide area (LPWA). LPWA is a general term for the technologies of the low-power communication in a wide range [2] and realizes long-distance communication using spread spectrum technology and ultra-narrow band communication technology, etc. LPWA can reduce device cost and power consumption by simplifying network topology and communication protocol. In this paper, we focus on LoRaWAN which is an open standard of LPWA [3].
In the existing LoRaWAN systems, packet collisions are reduced by setting duty cycle (DC), which controls the trans-

mission cycle not to exceed the predeﬁned ﬁxed threshold for each LoRa device [4]. However, as the number of LoRa devices increases, the conventional ﬁxed DC increases the number of packet collisions and degrades the communication quality. On the other hand, even if the number of LoRa devices is small, the throughput is very low due to the ﬁxed DC. In order to avoid packet collisions, it is necessary to set each LoRa device’s DC appropriately based on the accurate radio environment among LoRa devices. The accuracy of radio environment estimation directly affects the communication quality, and various ways to improve the accuracy have been discussed.
One of the most basic methods to estimate the radio environment is using a heuristics radio propagation model such as Okumura-Hata model [5]. Heuristic propagation models are usually modeled by simple regression analysis, and the propagation characteristics are uniquely determined by the distance information between a transmitter and a receiver. Therefore, the accuracy of propagation estimation may be degraded under the particular communication environment due to stochastic ﬂuctuation factors such as shadowing and multipath fading.
Measurement-based spectrum database (MSD) has attracted attention as a method to estimate the radio environment with high accuracy [6], [7]. In MSD, statistics of a huge amount of radio environment information observed by mobile terminals at each location is stored in a radio environment map (REM). A REM is the map that contains the spatial distribution of received signal strength and the average value of received power is stored for each location. By using REMs, location-dependent radio propagation characteristics can be estimated with high accuracy, and it is expected to improve the communication quality.
Thus, in this article, we propose a DC deciding algorithm that reduces the interference time ratio to other systems and keep the packet loss rate during uplink communication below the required value by cooperating with MSD. Here, the interference time ratio represents the ratio of time that other systems receive interference from LoRa nodes. In the proposed method, the number of LoRa nodes that interfere with other

978-1-7281-1340-1/19/$31.00 ©2019 IEEE

60

ICUFN 2019

5HFHLYHG 3RZHU 6LJQDO 6WUHQJWK

< ,QWHUIHUHQFH
VRXUFH

'DWDEDVH
;  7UDQVPLWWHU
0HVK Fig. 1: Overview of MSD.

6LJQDO E\ /R5D
)UHTXHQF\ Fig. 3: Spread spectrum technology.

< SRVLWLRQ

UHFHLYHG VLJQDO VWUHQJWK

�࢏, �࢏

DUH UHSRUWHG 'DWDEDVH

� ࢏�dBm�

 7UDQVQRGH

 2EVHUYHU

;

Fig. 2: MSD construction procedure.

systems’ nodes is determined based on the information stored in the MSD. Then, the DC that satisﬁes the allowable interference time ratio are decided. After that, the DC is updated based on the required packet loss rate to improve communication efﬁciency. In order to verify the usefulness of the proposed method, the average interference time ratio and the average packet loss rate are evaluated by computer simulation. The results show that the allowable interference time ratio and the required packet loss rate can be guaranteed and the throughput is improved compared to the ﬁxed DC.
The rest of paper is organized as follows. Section II describes overview of MSD. In Section III, we explain LPWA which is the basic knowledge of this research. Section IV shows the system model, and Section V describes the proposed DC deciding algorithm. Simulation conditions are given in Section VI, and Section VII shows simulation results. Finally, Section VIII concludes this work.
II. SPECTRUM DATABASE
Figure 1 shows the overview of MSD. In MSD, the radio environment information observed by mobile terminals is statistically processed for each location to construct REMs. The procedure of the database construction is shown in Fig. 2. Mobile terminals observe the radio environment such as the position, the time and the received signal strength at each location, and store them into their own storage. After the observation, the observation results are reported to a database server located outside via a network. The communication area is divided into square meshes in the database and REMs

are constructed. By using REMs, distance attenuation and shadowing at any place can be recognized with high accuracy, and it can be used for parameter design of communication. In order to identify the statistical unit area, a mesh code is used. The value of mesh code is calculated mechanically along the latitude and longitude of the observation value group.
In this paper, we design the DC based on the allowable interference time ratio to other nodes. Therefore, it is required to grasp the interference power from each LoRa node correctly. For this purpose, in this paper, we construct a REM for each LoRa node location and recognize the average interference power for other systems’ nodes.
III. LPWA
LPWA is a general term for the technologies that perform wide-area communication with lower power at lower data rates compared with the conventional technologies such as Bluetooth [2]. In many LPWAs including LoRaWAN, communication is performed on the sub-GHz band and some technologies such as spread spectrum technology and ultranarrow band technology enable long-distance communication. In addition, power consumption of the nodes is reduced by using direct communication between a gateway and each node. This type of network topology is called star topology. Moreover, the complexity of the node design is eased and the cost of the node is greatly reduced by simplifying the communication protocol in many LPWAs. One of the LPWA applications is a wide-area wireless sensor network. By using LPWA, costs and power consumption of sensor nodes can be reduced, and the entire network efﬁciency can be improved.
LoRaWAN is an LPWA technology that communicates on the sub-GHz band using LoRa which is one of the chirp spread spectrum technologies as a physical layer technology [8]. LoRaWAN spreads transmission signals over a wide band as shown in Fig. 3, to reduce the inﬂuence of interference signals and realize long-distance communication of approximately 5 km in urban area. The transmission distance and data rate change according to the spreading factor of the transmission signal, and there is a trade-off between them. The spreading factor is selected from six integer numbers

61

/R5D QRGH %

/R5D QRGH $

 7UDQVPLWWHU 0HVK
5(0

5(0

*DWHZD\ ⋈ ,QGLFDWLRQ RI
'XW\ &\FOH XSGDWH E\ $&. ⋇ 8SOLQN %
WUDQVPLVVLRQ

$  /R5D QRGH

 2WKHU V\VWHP QRGH

Fig. 4: System model.

from 7 to 12. If larger spreading factor is selected, the communication distance becomes longer while the data rate is smaller. LoRaWAN uses a communication protocol based on pure ALOHA for uplink communication [9]. In pure ALOHA, each node performs uplink communication and recognizes a packet collision depending on whether the node receives an ACK signal transmitted from the gateway or not. However, if the number of nodes increases, the probability of packet collision increases and the communication quality is degraded. Hence, in LoRaWAN, packet collisions are controlled by setting DC under the restriction in each node. The DC is the ratio of communication period to total period, 0 < DC < 1. Furthermore, the allowable DC is decided depending on the communication and the country. For example, the DC is set to less than 1% to restrict communication collisions for shared band with other systems in Japan and the EU. Nevertheless, as the number of nodes increases, packet collisions increase and communication quality is degraded in the communication using conventional method which uses ﬁxed DC.
IV. SYSTEM MODEL
Figure 4 shows the system model assumed in this paper. Within the communication area, there are N LoRa nodes and K other systems’ nodes. Each LoRa node performs uplink communication based on pure ALOHA. As described in Section II, a REM is constructed for each location of each LoRa node and used to design the DC. Therefore, it is assumed that N REMs are stored in the database and the location information of each LoRa node is known. The DC is updated by using the following procedure. At ﬁrst, each LoRa node transmits its own location information to the gateway via uplink communication. The gateway refers to REMs corresponding to the location information from each LoRa node, and designs DC using the algorithm described later. After that, the DC are sent along with the ACK signal to each LoRa node, and each LoRa node updates its own DC.

V. DC SETTING ALGORITHM USING MSD
In the system using the ﬁxed DC, the communication quality is degraded if the number of the nodes increases. Therefore, in this paper, the DC of each LoRa node is decided adaptively according to the surrounding radio environment in order to overcome that problem. The procedure to decide the DC is described below.

A. Calculation of the Number of Interfering Nodes Using MSD
First, the number of LoRa nodes that interfere with other systems’ nodes is determined by using MSD. In particular, average interference power from each LoRa node at the other systems’ node is obtained from REMs stored in MSD. Meshes with average interference power larger than γ [dBm] are extracted and considered that there is interference. Here, the number of LoRa nodes that interfere with the other system node k and their DC are deﬁned as Ik and Dk respectively.

B. DC Setting Based on the Allowable Interference Time Ratio

In the next step, the DC of each LoRa node is updated. The interference time ratio to the other system node k of the LoRa nodes is deﬁned as Pk and calculated based on the following equation,

Pk = 1 − (1 − Dk)Ik .

(1)

The second term of the right-hand side in Eq. (1) represents the probability that no LoRa node that interferes with other system node k is on communication. By subtracting this probability from 1 (overall probability), the interference time ratio Pk to other system k can be obtained. Then, Dk which satisﬁes the allowable interference time ratio Pd is calculated by the following equation,

Pk ≤ Pd.

(2)

Here, for the LoRa node that interferes with multiple other systems’ nodes, multiple DC are found. In this paper, the minimum of these calculated DC is selected as the DC at each LoRa node since it is required to strictly satisfy the allowable interference time ratio Pd. This operation makes it possible to raise DC of the other LoRa nodes that interfere with the other system node interferd by the LoRa node whose DC is lowered. Figure 5 (a) shows the case where LoRa nodes A and B give interference only to a single other system node C. In this case, the DC of LoRa nodes A and B should be increased by using Eq. (1) and Eq. (2). The other case where LoRa nodes A and B give interference to multiple nodes C and D in other system is shown in Fig. 5 (b). In this situation, if the DC is determined by considering the node C only, the allowable interference time ratio Pd for the node D may not be guaranteed. Hence, the DC is increased only in the case of Fig. 5 (a).

62

/R5D 1RGH $

⋇VHOHFW PLQLPXP '&

2WKHU V\VWHP 1RGH &

'&  '& 

'& 

'&  

/R5D 1RGH %

'&  
⋈ ,QFUHDVH WKH '& YDOXH
E\ WKH H[WUD DPRXQW
JHQHUDWHG E\ ⋇

'& 

'& 

(a) Case where A and B interfere with C.

NP

NP

/R5D *DWHZD\ /R5D 1RGHV 2WKHU 6\VWHP 1RGHV

Fig. 6: Simulation model.

/R5D 1RGH $

⋇VHOHFW PLQLPXP '&

2WKHU V\VWHP 1RGH &

'&  '& 

'& 

'& 

2WKHU V\VWHP 1RGH Ͼ

/R5D 1RGH % '& 

'& 

'& 

(b) Case where A and B interfere with C and D. Fig. 5: DC setting algorithm.

'& 

C. DC Update Based on Required Packet Loss Rate

(4),

P (M = 0) = (2τ λt)0 exp (−2τ λt)

(5)

=

[ 0{! exp −2τ 1

−

∏N

( 1

−

Di

)}]

.

τ

i=1

Thus, the packet loss rate C is described as

C

(Di)

=

1

−

exp

[ −2τ

{ 1

−

∏N

( 1

−

Di τ

)}]

.

(6)

i=1

In this article, it is required to decide the DC that meets the required packet loss rate Qd for every LoRa node. Hence, to conﬁrm whether the required packet loss rate is satisﬁed or not, the following equation is used ,

At last, the DC is adapted in consideration of the required packet loss rate during uplink communication. In this article, we assume that packet arrival at each LoRa node is statistically independent, and each LoRa node performs uplink communication based on ALOHA protocol. In this case, the amount of packet arrival at the gateway is modeled as Poison process. The probability that M packets arrive during the time duration t is expressed as follows,

(tλ)M exp (−tλ)

P (M ) =

M!

,

(3)

C(Di′) ≤ Qd

(7)

where Di′ is the DC at LoRa node i decided by Eq. (2). For LoRa nodes that do not satisfy Eq. (7), the DC is updated by

using Eq. (8) to guarantee the required packet loss rate Qd,

1

−

exp

[ −2τ

{ 1

−

∏N

( 1

−

Di′

− ∆Di τ

)}]

≤

Qd,

(8)

i=1

where ∆ is the rate for decreasing the DC. Di′ is decreased by ∆Di and decided to be the DC of LoRa node i, which
guarantees the required packet loss rate Qd.

where λ is the average amount of packet arrival. The probability that at least one packet arrives at the gateway is expressed by the following equation,

λt

=

1

−

∏N

( 1

−

Di τ

)

,

(4)

i=1

where Di is the DC of LoRa node i, τ is the packet length and N is the number of LoRa nodes. The second term in Eq. (4) represents the probability that no packets arrive.
Next, we model the success probability of the uplink communication. In pure ALOHA system, the communication succeed only if no new packet arrives within twice the packet length τ . Therefore, the success probability of the uplink communication can be modeled as below by considering Eq.

VI. SIMULATION CONDITIONS
We evaluate the average interference time ratio, the average packet loss rate and the average throughput by using computer simulations in order to verify effectiveness of the proposed method. Each LoRa node is assumed to continuously perform uplink communication. Figure 6 shows the simulation model. LoRa nodes and other systems’ nodes are randomly and uniformly distributed within the area and a gateway is located at the center of the area. In this simulation, we construct a REM by using only long-term median ﬂuctuation due to the distance attenuation. Furthermore, it is assumed that each LoRa node transmits uplink signals according to the Poisson process and the capture effect is not considered. The location of LoRa nodes and other systems’ nodes are changed by every iteration within the simulation to reconstruct the REMs and update the DC. In addition, in this paper, we mitigate the excessive

63

TABLE I: Simulation parameters

Area size Mesh size Frequency Packet length τ Spreading factor SF Coding rate CR Bandwidth BW Number of LoRa gateway
Number of LoRa nodes N
Number of other systems’ nodes K
Radio propagation model
Transmission power of LoRa nodes Interference power threshold γ Allowable interference time ratio Pd Required packet loss rate Qd Maximum DC Fixed DC α Step size of ∆ Simulation time Number of repetitions

4.1 ʷ 4.1 [km2] 100 ʷ 100 [m2]
923 [MHz] 400 [msec]
10 4/5 125 [kHz] 1 2,4,6,8,10,12, 14,16,18,20,22, 24,26,28,30,32, 34,36,38,40,42 30 Okumura-Hata model(Urban) 13 [dBm] -100 [dBm] 0.05 0.3 0.05 0.01 0.001 7200000 [msec] 100

$YHUDJH,QWHUIHUHQFH7LPH5DWLR









SURSRVHG )L[HG'&Ș  $OORZDEOH,QWHUIHUHQFH7LPH5DWLR3G
        
1XPEHURIQRGHV

Fig. 7: Average Interference Time Ratio.





$YHUDJH3DFNHW/RVV5DWH

communication times of LoRa nodes that do not interfere with other system nodes by determining the upper bound of DC. Moreover, we consider the uplink communication using the ﬁxed DC α as a benchmark method, and evaluate various characteristics. The throughput Rb is calculated by the following equation,

BW

Rb = SF × 2SF × CR,

(9)

where SF is a spreading factor, CR is a coding rate and BW is a communication bandwidth [10]. The other conditions used in the computer simulation are shown in Table 1.

VII. SIMULATION RESULTS
A. Average Interference Time Ratio
Figure 7 shows the average interference time ratio as a function of the number of LoRa nodes. As shown in the graph, the proposed method satisﬁes the allowable interference time ratio regardless of the number of LoRa nodes. On the other hand, as the number of LoRa nodes increases, the average interference time ratio increases for the conventional method which uses the ﬁxed DC. The average interference time ratio in the conventional method is more inﬂuenced from the number of LoRa nodes which interfere with other system nodes than the proposed method. When the number of LoRa nodes is large, the interference time ratio shown in Eq. (1) is relatively large, and the ratio of the average interference time is increased. Furthermore, in the proposed method, the average interference time ratio is signiﬁcantly lower than the



SURSRVHG )L[HG'&Ș  5HTXLUHG3DFNHW/RVV5DWH4G          1XPEHURIQRGHV
Fig. 8: Average Packetloss Rate.

allowable value Pd. In this paper, the DC is updated based not only on the allowable average interference time, but also on the required packet loss rate. Therefore, the reason that the DC in the graph is much smaller than the DC based on the allowable interference time ratio is due to the bound of the required packet loss rate.
B. Average Packet Loss Rate
Figure 8 shows the average packet loss rate to the number of LoRa nodes. The ﬁgure shows that the proposed method can guarantee the required packet loss rate. By contrast, the average packet loss rate of the conventional method increases and exceeds the required value as the number of LoRa nodes increases. It is inferred that the average packet loss rate asymptotically approaches the required value because the DC of each LoRa node in this simulation is determined based on the required packet loss rate as described in VII-A.

64

$YHUDJH7KURXJKSXW>ESV@

 SURSRVHG
)L[HG'&Ș  



         
1XPEHURIQRGHV Fig. 9: Average Throughput.
C. Average Throughput The average throughput characteristics are shown in Fig. 9.
The ﬁgure shows that the throughput is improved by the proposed method when the number of LoRa nodes is small. By contrast, when the number of LoRa nodes is large, the throughput is slightly lower than that of the conventional method. This is because smaller DC are used in the proposed method in order to guarantee the required packet loss rate. Considering both the allowable interference time ratio and the required packet loss rate results in decreasing the DC of each LoRa. As a result, the throughput is also decreased.

[4] LoRa Alliance Technical Committee Regional Parameters Workgroup, “LoRaWAN 1.1 Regional Parameters,” LoRa Alliance, https://lora-alliance.org/sites/default/ﬁles/2018-04/lorawantm regional parameters v1.1rb - ﬁnal.pdf, Accessed Jan 29, 2019.
[5] R. El Chall, S. Lahoud and M. El Helou, ”LoRaWAN Network: Radio Propagation Models and Performance Evaluation in Various Environments in Lebanon,” IEEE Internet Things J (early access), 2019.
[6] H. R. Imam, K. Inage, M. Ohta and T. Fujii, “Measurement based radio environment database using spectrum sensing in cognitive radio,” in Proc. 2011 International Conference on Selected Topics in Mobile and Wireless Networking (iCOST), Shanghai, pp. 110-115, Oct, 2011.
[7] K. Sato and T. Fujii, “Kriging-Based Interference Power Constraint: Integrated Design of the Radio Environment Map and Transmission Power,” IEEE Trans. on Cogn. Commun. Netw. vol. 3, no. 1, pp. 13-25, Mar, 2017.
[8] U. Noreen, L. Clavier and A. Bounceur, “LoRa-like CSS-based PHY layer, Capture Effect and Serial Interference Cancellation,” in Proc. European Wireless 2018; 24th European Wireless Conference, Catania, Italy, pp. 1-6, May, 2018.
[9] N. Sornin, “LoRaWAN 1.1 Speciﬁcation,” LoRa Alliance, https://lora-alliance.org/sites/default/ﬁles/2018-04/lorawantm speciﬁcation -v1.1.pdf, Accessed Jan 29, 2019.
[10] “LoRa Modulation Basics - AN1200.22, Revision 2,” Semtech Corporation, https://www.semtech.com/uploads/documents/an1200.22.pdf, Accessed Mar 29, 2019.

VIII. CONCLUSION
In this paper, we proposed the method to adaptively set DC of LoRa node considering the packet collisions and surrounding environment using radio environment database. In our proposed method, DC of each node was adapted by using ACK communication from the LoRa gateway. The simulation results showed that the proposed method can reduce the interference time ratio and the packet loss rate less than the required values and contribute to the improvement of communication efﬁciency.

ACKNOWLEDGMENT
This research was supported by the MIC/SCOPE #175104004.

REFERENCES
[1] D. Evans, “The internet of things: How the next evolution of the internet is changing everything, ” Available:http://www.cisco.com/web/about/ ac79/docs/innov/IoTIBSG0411FINAL.pdf, accessed Nov. 11. 2018.
[2] U. Raza, P. Kulkarni and M. Sooriyabandara, “Low Power Wide Area Networks: An Overview,” IEEE Commun. Surveys Tuts, vol. 19, no. 2, pp. 855-873, 2017.
[3] J. de Carvalho Silva, J. J. P. C. Rodrigues, A. M. Alberti, P. Solic and A. L. L. Aquino, “LoRaWAN - A low power WAN protocol for Internet of Things: A review and opportunities,” in Proc. 2017 2nd International Multidisciplinary Conference on Computer and Energy Science (SpliTech), Split, Jul, pp. 1-6 2017.

65

