Determination of optimum threshold values for NPRACH preamble detection in NB-IoT systems

Seongchul Cho, Hyungjin Kim, Gweondo Jo
Mobile Application Modem Research Section Electronics and Telecommunications Research Institute
Daejeon, Korea sccho@etri.re.kr

Abstract—In this paper, we describe the NPRACH of 3GPP NBIoT system and propose a possible receiver algorithm for NPRACH detection and timing advance estimation. We present simulation results for the performance of the random access preamble detection and timing advance for the proposed NPRACH detection scheme. In addition, we analyze the detection performance according to the detection threshold value and derive the optimal threshold value.
Keywords— NB-IoT, NPRACH.
I. INTRODUCTION
Today, our society is evolving towards a hyper-connected society where billions of devices are connected to the Internet. Among the IoT(Internet of Things) technologies connecting massive number of devices in a cell, NB-IoT being developed in the 3GPP(3rd Generation Partnership Project) is a typical cellular technology of the IoT. NB-IoT standard of 3GPP promises to provide improved coverage for massive number of low-throughput low-cost devices with low device power consumption in delay-tolerant applications[1][2].
NB-IoT reuses the LTE design extensively, including the downlink orthogonal frequency division multiple access, uplink single carrier frequency division multiple access, channel coding, rate matching, interleaving, etc[3]. However, the NB-IoT physical random access channel has been redesigned as a single tone signal with frequency hopping.
In this paper, we study random access preamble design and detection for NB-IoT physical random access channel, known as NPRACH(Narrowband Physical Random Access Channels). We show a functional block for detecting NPRACHs based on the NB-IoT physical layer specification of 3GPP Release 13, and analyze the performance according to the detection threshold value when the UE attempts random access.
II. NPRACH IN NB-IOT
The narrowband physical layer random access preamble is based on single subcarrier frequency hopping symbol groups. A symbol group is illustrated in Figure 1, consisting of a cyclic

prefix of length and a sequence of 5 identical symbols with total length. The parameter values are listed in Table 1[4].
CP

Figure 1. NPRACH Symbol Group

TABLE I.
Preamble format 0 1

NPRACH PREAMBLE PARAMETERS

Tcp 2048·Ts 8192·Ts

Tseq 5·8192·Ts 5·8192·Ts

The NPRACH preamble consists of four consecutive symbol groups. The four symbol groups are hopped according to the following frequency hopping pattern. The frequency location of
the NPRACH transmission is constrained within NsRcA = 12 sub-carriers. Frequency hopping shall be used within the 12 subcarriers, where the frequency location of the ith symbol group
( ) is given by nsRcA i = nstart + n~SRCA(i) [4].

ë û nstart = NsNcoPfRfsAeCt H + ninit

NsRcA

×

N

RA sc

( ) n~sRcA (i)

=

ïïïíìnn~~n~ssRRccsRcAAA(((ii0--)11+))

f + -

(i 1 1

/

4)

mod

N

RA sc

ïïïînn~~ssRRcc AA

(i (i

-

1) 1)

+ -

6 6

i mod 4 = 0 and i > 0
i mod 4 = 1,3 and n~sRcA (i -1) mod 2 = 0 i mod 4 = 1,3 and n~sRcA (i -1) mod 2 = 1 i mod 4 = 2 and n~sRcA (i -1) < 6 i mod 4 = 2 and n~sRcA (i -1) ³ 6

å ( ) ( ) ( ) ( ) f

t

= ççæ f è

t -1

æ 10t+9 +ç c
è n=10t+1

n

2n-(10t+1) ÷ö mod ø

N RA sc

-1

+

1÷÷ö

mod

N

RA sc

ø

f (-1) = 0

Where, n~SRCA(0) = ninit mod NsRcA with ninit being the subcarrier selected by the MAC layer from {0,1,..., NsNcPRACH -1} .
NsNcPRACH is the number of subcarriers allocated to the NPRACH and is one of 12, 24, 36, or 48 subcarriers.
When NPRACH preamble transmission is repeated, f(t) must be calculated in order to obtain the subcarrier index of the first symbol group of repeated transmission. The pseudo random

978-1-5386-4646-5/18/$31.00 ©2018 IEEE

616

ICUFN 2018

sequence c(n) is defined as a gold sequence of length 31, and

the output sequence c(n) is given by the following equation.
c(n) = (x1(n + NC ) + x2 (n + NC ))mod 2 x1(n + 31) = (x1(n + 3) + x1(n))mod 2 x2 (n + 31) = (x2 (n + 3) + x2 (n + 2) + x2 (n +1) + x2 (n))mod 2

Where NC = 1600 and the first m-sequence shall be initialized

with x1(0) = 1, x1(n) = 0, n = 1,2,...,30. The initialization of the

å second m-sequence is denoted by cinit =

30 i=0

x2

(i)

×

2i

with

the value depending on the application of the sequence. The

pseudo random sequence generator shall be initialized with

cinit

=

NINDcell .

N Ncell ID

is Narrowband physical layer cell identity

given by MAC layer.

The functional block diagram for NPRACH detection is shown in Figure 2.

Figure 2. Functional Block Diagram for NPRACH Detection

The received NPRACH preamble signal is combined with a sequence of 5 identical symbols after removing the CP and an 8192 point FFT is performed. 48 sequences corresponding to NPRACH PRB are extracted from the FFT output converted into the frequency domain signal. The power of each of the extracted 48 sequences is accumulated according to the frequency hopping pattern. This is performed during four consecutive slots. In the case of repeated transmission, accumulation for each frequency hopping pattern is performed during four consecutive input slots according to the number of repeated transmission. Figure 3 shows the process of accumulating the power of each sequence for 12 NPRACH resources and 2 repetition transmissions.

Repetition #1 8ms

Repetition #2 8ms

0

0

0

0

0

0

0

0

1

1

1

1

1

1

1

1

2

2

2

2

2

2

2

2

3

3

3

3

3

3

3

3

4

4

4

4

4

4

4

4

5

5

5

5

5

5

5

5

6

6

6

6

6

6

6

6

7

7

7

7

7

7

7

7

8

8

8

8

8

8

8

8

9

9

9

9

9

9

9

9

10

10

10

10

10

10

10

10

11

11

11

11

11

11

11

11

To estimate the TA(Timing Advance), we perform N-point IFFT with the values of the received preamble symbols. If an IFFT is performed with the values of all 12 subcarriers, noise is reflected in the timing estimation, which degrades the performance. Therefore, after padding all the values to 0, IFFT is performed by reflecting only four subcarrier values corresponding to the symbol hopping of the detected preamble. For the IFFT results, the power of each index is measured and the index corresponding to the maximum value is reported as the TA estimation value.
III. SIMULATION RESULTS Measuring the probability of erroneous detection is defined in TS36.104. The target defined for any bandwidth and all frame structures is a false alarm probability less than or equal to 0.1%, a missed detection probability less than 1%, and a TA estimation error probability less than 1% based on less than 4 usec. The simulation environment uses the AWGN channel and the iterative transmission is set to one. In the simulation, NPRACH detection performance was evaluated when 1, 5, and 11 preamble sequences are transmitted, respectively. The following figures show false alarm probability and missed detection probability according to detection threshold value.
Figure 5. False Alarm Probability for 1 Premable Transmission

Figure 3. Power Combining
The detection threshold value is set as a specific position of the average of the maximum value and the minimum value for the cumulative sum of the 12 sequences. If the cumulative sum of the 12 sequence exceeds the threshold value, the NPRACH detector declares the sequence as a random access preamble attempted by the UE.

Figure 6. TA Estimation Error Probability for 1 Premable Transmission

Figure 4. TA Estimation Procedure

617

required SNR according to the detection threshold level in case of 1, 5, 11 preamble sequence transmissions.

TABLE III. REQUIRED SNR ACCORDING TO THE DETECTION

Detection Level 0.35 0.40 0.45 0.50 0.55

1 preamble -31.5 -33.0 -34.0 -34.5 -35.5

5 preambles -26.0 -27.5 -28.5 -29.5 -28.0

11 preambles -27.0 -26.5 -25.0 -24.0 -22.5

Figure 7. Missed Detection Probability for 5 Premables Transmission

Figure 8. False Alarm Probability for 11 Premables Transmission
As can be seen from the below table, in case of one preamble sequence transmission, the detection threshold value should be set to 55 ~ 70% of the average to satisfy the target NPRACH performance at the lowest SNR. Similarly, in the case of 5 and 11 preamble sequence transmissions, the detection threshold should be set at 50% and 35% of the average, respectively.

TABLE II. Number of Preambles 1 Preamble
5 Preambles
11 Preambles

REQUIRED SNR ACCORDING TO THE DETECTION LEVEL

Detection Level 0.55 0.60 0.65 0.70

False Alarm -35.5 -36.0 -37.0 -37.5

Missed Detection <-40.0 <-40.0 <-40.0 -39.0

TA Estimation -35.5 -35.5 -35.5 -35.5

0.45

-28.5

-30.5

<<-33.0

0.50

-30.0

-29.5

<<-33.0

0.55

-31.0

-28.0

<<-33.0

0.30

-24.5

<-28.0

<<-28.0

0.35

-27.0

-28.0

<<-28.0

0.40

<-28.0

-26.5

<<-28.0

However, if we want to set only one reference threshold value in all cases, the threshold should be 40% of the average to achieve the best detection performance. Table 3 shows the

IV. CONCLUSION
In this paper, we introduced the random access preamble in NB-IoT systems and presented the performance of the detection algorithm. Clearly, there is a trade-off between the false alarm probability and the missed detection probability. Increasing the detection threshold lowers the false alarm probability at the cost of increased likelihood of misdetection. Conversely, decreasing the detection threshold lowers the missed detection probability at the cost of increased likelihood of false alarm. Therefore, it is necessary to determine the optimal detection level that can maximize the performance through many simulations.
In addition, as shown in the table, performance difference is generated according to the number of transmission preamble and detection reference value. Therefore, if the number of transmission preamble can be estimated, it is expected that the preamble detection performance of the random access channel can be improved through setting the optimum detection threshold.
ACKNOWLEDGMENT
This work was supported by Institute for Information & communications Technology Promotion (IITP) grant funded by the Korea government(MSIP) (No. 2017-0-00724, Development of Beyond 5G Mobile Communication Technologies (UltraReliable, Low-Latency, and Massive Connectivity) and Combined Access Technologies for Cellular-based Industrial Automation Systems)
REFERENCES
[1] 3GPP, “Revised work item: Narrowband IoT (NB-IoT),” RP-152284, December 2015
[2] Xingqin Lin, Ansuman Adhikary, Y.-P. Eric Wang . "Random Access Preamble Design and Detection for 3GPP Narrowband IoT Systems." IEEE Wireless Communication Letters, Vol.5, pp.640-643, 2016
[3] Y.-P. Eric Wang , Xingqin Lin , Ansuman Adhikary , Asbjörn Grövlen , Yutao Sui , Yufei Blankenship, Johan Bergman, and Hazhir S. Razaghi, “A Primer on 3GPP Narrowband Internet of Things (NB-IoT),” IEEE Communications Magazine, Vol.55, pp.117-123, 2017
[4] 3GPP TS 36.211 V13.7.0 (2017-09) Physical channels and modulation..

618

