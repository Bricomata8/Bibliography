This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

1

Evaluation of the IoT LoRaWAN Solution for Distributed Measurement Applications
Mattia Rizzi, Paolo Ferrari, Member, IEEE, Alessandra Flammini, Senior Member, IEEE, and Emiliano Sisinni, Member, IEEE

Abstract— Internet of Things (IoT) is based on data collection, where billions of sensors sample the real world; in other words, the IoT includes a giant distributed measurement system (DMS). A question still requiring an answer is: Are the IoT technologies usable to enhance traditional measurement systems, since they have been developed for a very similar objective? In this paper, the use of a long-range (LoRa) technology, originally developed for IoT, is investigated with the aim of implementing DMSs. After the conclusion that LoRa and LoRa wide area network architectures show a good match with measurement systems, this paper focuses on the characterization of timerelated performance indicators that are important for distributed systems. The experimental results show the capability of lowcost transceiver to schedule the transmission of frames with a standard uncertainty less than 3 µs; and an acceptable longterm clock stability (Allan Deviation) of commercial available devices (nodes and packet forwarders) for application such as smart metering, smart building, and process industry.
Index Terms— Chirp spread spectrum (CSS), distributed measurement systems (DMMs), Internet of Things (IoT), long-range wide area network (LoRaWAN), wireless sensor networks.
I. INTRODUCTION
T HE Internet of Things (IoT) is one of the key technologies of the present and the near future, as discussed in recent market surveys (e.g., consider the recent Gartner Symposium/ITxpo 2016, just to mention one) and scientiﬁc world [1]. Smart and connected things are transforming themselves from stand-alone devices to parts of collaborative systems. Clearly, this growth is also driven by the fact that smart objects are cheaper and more powerful than in the recent past.
Actually, the real basis of the IoT is the pervasive, continuous, and efﬁcient data collection. Data are stored, aggregated, and analyzed by analytics (based on cloud computing) to extract more information [2], [3]. In other words, the set of sensors, devices, and storage systems, by which the IoT is composed of, is very similar to a giant distributed measurement system (DMS).
Typically, a huge amount of information is collected from a very large number of smart devices with a low sampling
Manuscript received May 31, 2017; revised July 24, 2017; accepted August 11, 2017. This work was supported by “Brescia Smart Living: Integrated energy and services for the enhancement of the welfare” under Grant MIUR SCN00416. The Associate Editor coordinating the review process was Dr. Deniz Gurkan. (Corresponding author: Paolo Ferrari.)
The authors are with the Department of Information Engineering, University of Brescia, 25123 Brescia, Italy (e-mail: paolo.ferrari@ing.unibs.it; emiliano.sisinni@unibs.it).
Color versions of one or more of the ﬁgures in this paper are available online at http://ieeexplore.ieee.org.
Digital Object Identiﬁer 10.1109/TIM.2017.2746378

rate (from few times per hour to few times per day) and stored in the cloud. Moreover, slow sampling allows the implementation of specialized transmission (TX) technologies oriented to scalability, like the wireless sensor networks [4]. To be precise, the availability of an ideal, IoT oriented, wireless communication technology for covering very large areas (thus reducing the number of base stations), with adequate transfer rate (up to tens of kilobits per second), and with a long node lifetime (even if battery supplied), is still an open research. Smart cities, smart grids, pollution monitoring, transportation, remote health care application ﬁelds are waiting such kind of technology [5]–[8], and also the new Industry 4.0 may be heavily based on it [9]–[11].
Summarizing, the IoT systems are similar to a DMS and IoT world is pushing new technologies. However, IoT systems have never been characterized in light of DMS requirements (as uncertainty and timestamps). This situation opens some questions for instrumentation and measurement scientists, for instance: Are new IoT technologies usable to realize or replace specialized (private) DMSs? In other, more general, words: Are the new IoT technologies able to provide satisfactory measurement performance?
In this paper, low-power wide area networks (LPWANs) are considered as a viable solution for large-scale DMSs. In particular, the very new wireless long-range wide area network (LoRaWAN) technology is evaluated, which is the open standard LPWAN that can boast the largest number of already deployed pilot studies. LoRaWAN is based on long-range (LoRa) radios from the Semtech Corporation. Originally conceived for IoT slow sampling rate, long-distance communication, it has good scalability, cellular architecture, and central coordination function. This paper investigates the use of LoRa from the perspective of DMSs and applications. Then, this paper tries for the ﬁrst time (according to the best authors’ knowledge) to experimentally evaluate physical (PHY) and data link (DL) layers capability of LoRaWAN, mainly considering time-related performance indicators.
This paper is structured as follows. In Section II, requirements of DMS are brieﬂy summarized and compared with the IoT approach. In Section III, some details of the LoRaWAN architecture are given. In Section IV, the protocol is analyzed in order to highlight the fundamental limits. In Section V, the normative constraints for the use of this wireless technology are discussed. In Section VI, the experimental setup is described and the experiment results are presented. Finally, general discussion is carried out in Section VII.

0018-9456 © 2017 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

2

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

TABLE I MAIN REQUIREMENTS OF TYPICAL DMSS

collect data coming from many (native) protocols of regular sensor networks. Alternatively, new communication protocols proposed for regular IoT applications can be tested to verify their applicability to distributed measurements systems.
In this paper, we addressed the latter approach, evaluating the usability of the LoRaWAN solution as the wireless backhaul of IoT-like measurements solutions. In the following section, the LoRaWAN architecture is described in order to check if ﬁts or not with typical DMS arrangement. In Section IV, additional details about PHY and DL layers are provided in order to state to what extent requirements of some DMS applications (as those reported in Table I) are satisﬁed. Indeed, the PHY affects individual link characteristics, while the DL determines the whole network behavior.

III. LORA/LORAWAN SOLUTION

II. DISTRIBUTED MEASUREMENT SYSTEMS AND IOT
A DMS allows to collect measurements from several sensors/transducers deployed on the ﬁeld connected by means of a (digital) network for further processing and visualization [12], [13]. In particular, DMSs offer great beneﬁts over traditional approaches when several (possibly hard-to-reach) measuring points are distributed on a large area. Industrial applications are among ﬁrst adopters of such an approach, since the introduction of ﬁeldbuses. More recently, the smart grid concept disrupts the power distribution leveraging on DMSs for controlling power ﬂows. Obviously, despite all these application domains share a common arrangement, communication requirements can vary greatly depending on the considered use case. Several ﬁgures of merit (FoM) exist for comparing DMS performance. Since a DMS is involved with time-series collection, time-related FoM as refresh time, latency, and required time synchronization accuracy are particularly meaningful. Interesting to note, other FoM as the typical frame size or the number of nodes per access point affect or are depending on time-related FoM (e.g., the throughput). For sake of completeness, Table I has been completed starting from data available in [14].
Although IoT has different goals, as increasing the smartness of PHY objects for improving their values and for streamlining activities and processes, it is evident that IoT shares several features with DMS. Very roughly speaking, IoT aims at conveying information from “smart things” toward the cloud, just the same way a DMS collects measurements from sensors toward the data sink. Consequently, even if application scenarios and requirements may be very dissimilar, some works available in [15] and [16] already tried to merge the two worlds. The fundamental question to answer is “if is it possible to design an IoT infrastructure that can support different and concurrent DMS applications?” One possible solution is to increase the cloud complexity in order to automatically

Formally, LoRaWAN is a member of the LPWAN family, i.e., those wide area network wireless communications that are designed to cover large areas and minimizing the power consumption but offering a relatively small bit rate. LoRaWAN exploits the cellular architecture typically adopted by IoT solutions. It is useful to highlight that the standard only covers the DL layer above the PHY layer, which relies on proprietary transceivers developed by Semtech. Indeed, LoRaWAN does not provide a network layer, being based on a star topology. Regarding the application layer, the specs do not deﬁne it at all.
A. LoRaWAN Architecture
In the typical LPWAN usage, nodes on the ﬁeld wake up after an event is occurred and try to transmit a message toward the base station. Indeed, LoRaWAN privileges the so-called uplink TX, that is, from the node toward the end user (which the standard says are “…expected to be the predominant trafﬁc…”). In order to keep the wireless infrastructure very simple, the base stations only include the so-called “packet forwarder” without providing roaming, but simply collecting LoRaWAN messages on the air and tunneling them into the network backbone. Formally speaking, the base station is a “gateway,” which tunnels LoRaWAN messages into the backbone network and vice versa. It must be underlined that the gateway does not analyze the payload of incoming messages; node identiﬁcation and join procedures are actually carried out by servers on the backbone, as better described in the following.
The protocol stack of the backbone is out of the LoRaWAN scope. In fact, most of commercially available solutions follow the Semtech application notes, whose architecture is graphically depicted in Fig. 1. In such a case, the backbone is the Internet or at least an intranet. The gateway forward the LoRaWAN message toward one or more network server(s). The network server authenticates the received message and further forward the user payload to a single (or several) application server(s). The application server is in charge of admitting nodes to the network and takes care of encrypting/decrypting user data sent/received to/from the

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

RIZZI et al.: EVALUATION OF IoT LoRaWAN SOLUTION

3

the availability of multiple customer servers allows to apply different measurement algorithms or different reporting/ visualization interfaces to different users.

Fig. 1. Overview of the LoRaWAN hierarchical architecture, according to the Semtech proposal.
end device. Finally, the application server forward node message to a customer server that actually implements the ﬁnaluser application. Additionally, a network controller, whose aim is collecting reports about the network status and can modify the LoRaWAN network accordingly, e.g., changing the data rate supported by end devices [implementing an adaptive data rate (ADR) scheme], can complement the network server(s).
For security reasons, all the communications have multiple levels of message cyphering and signing. Each transaction needs two 128-b symmetric keys, known as the application and network session keys (i.e., AppSKey and the NwkSKey). The NwkSkey provides data integrity between the end device and the network server. The AppSKey provides data conﬁdentiality between the end device and the application “behind” the network server. Two different joining mechanisms are provided, the over-the-air activation (OTAA, based on globally unique node identiﬁer and over-the-air message handshaking) and activation by personalization (ABP, with session keys stored at production time).
The hierarchical organization helps in creating innovative business models, allowing to easily separate the owners of the hardware from the owners of the infrastructure and the owners of the information collected by the nodes (often referred as motes). As reported in [17], application scenarios may range from millions of nodes when transaction rate is one per day, to thousands of nodes when the transaction rate is on the order of tens of seconds.
LoRaWAN has also some care about the time relation between TXs: the packet forwarder has a free-running counter (with a 1-μs resolution) in order to timestamp every incoming uplink message. Regarding downlinks, the network server schedules their TXs sending to the packet forwarder information about when the TX should take place referring to the packet forwarder free-running timer
Finally, the LoRaWAN application layer (e.g., running on Loriot, IBM Bluemix, Amazon AWS, just to mention few platforms) contains useful functions for measurement services, such as data analysis, long-term storage, and easy visualizations. Cloud services and effective (customer oriented) dashboards may be the key ways to obtain the highest impact on the end user of the measurement results. For example,

B. LoRaWAN: State of the Art
LoRa is having a good success and many papers are available about it. In the following, a collection of the works more related to the DMS applications is presented.
The integration of LoRaWAN into the IoT is sponsored by the LoRa alliance, and some open implementations of network server are available [18]. Many sensors are available as well and LoRaWAN ecosystem is constantly growing as explained in [19]. A rather complete analysis of the scalability of LoRaWAN networks is given in [17]. The authors, by means of analytic and simulation-based approach, deeply explore the multiple dimensions of the LoRa network conﬁguration. The number of sensors deployed in the ﬁeld greatly depends on the chosen spreading factor (SF, described in the following section) and on the TX rate given in packets/day. For instance, millions of sensors are possible if they transmit just one packer per day.
In [20], the LoRaWAN PHY is evaluated for the safety application. Besides the conclusion about the suitability of this modulation technique for such application, the work investigates the use of the 2.4-GHz frequency band. In these conditions, chirp modulated signal can pass through few concrete walls and operate immersed in water. Open-space range is conﬁrmed greater than 9 km.
A LoRaWAN network has been deployed in the city of Rennes in [21] evaluating typical communication parameters as the packet error rate (PER) the received signal strength indicator (RSSI) and signal-to-noise ratio (SNR); the main result is the experimental consideration about an average PER of 40% over a such wide area. Other experiments are reported in [22] conﬁrming this outcome: the PER is depending on the SF, and in within a radius of 3.5 km, the average PER is lower than 50% only for the SF12. For SF7 the maximum range seems to be 2.3 km.
A simulation of coexistence of LoRaWAN with other IoT oriented wireless systems is carried out in [23]. LoRaWAN shows a higher bandwidth and a good margin against interference. Different SFs are conﬁrmed to be orthogonal and can be received simultaneously unless the power of the interfering SF is 18 dB greater that the desired SF. In [24], LoRaWAN has been evaluated in mobile situations (i.e., when the nodes are moving during TX): the results highlight that slow fading can affect long LoRa messages (higher SF) when the node speed is higher than 40 km/h.
Finally, LoRaWAN PHY has also been investigated for localization in [25]. The beneﬁts of chirp spread spectrum (CSS) used in LoRaWAN radios in this ﬁeld are limited, due to the low bandwidth, and cannot be compared with results achieved by ultrawide band systems [26].
C. Final Remark
In order to decide if LoRaWAN is suitable for, at least, certain distributed measurement applications, it has to be

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

4

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

compared with the DMS requirements of Table I. From the description in Section III-A, it emerges that some features of LoRaWAN, as the network architecture, the frame size, the hierarchical structure, and the application layer capabilities well ﬁt many distributed measurement applications. In these cases, the scenario where several “instruments” sense variable of interest, transmit data toward one (or more) processing site(s), and export information to the ﬁnal users, can quickly and effectively be implemented. Additionally, the presence in the LoRaWAN standard of “uplink timestamping” feature is of great importance, but its accuracy is not known: as emerged from Section III-B, timing analysis is missing in the literature.
The most important goal of this paper is the evaluation of LoRa and LoRaWAN timing performance (described in Section IV) and the comparison of the obtained result with the requirement of Table I (carried out in Section VII).
IV. LORAWAN PHYSICAL AND DATA LINK LAYERS
This section complements the previous overview furnishing some details about the lower part of the protocol stack, which determines communication performance. In particular, the PHY and DL layers actually limit the time-related performance, whose evaluation is the main objective of this paper. Being more precise: the PHY bounds raw data rate and it must be compliant with national and international regulations; the DL deﬁnes network capacity and coexistence strategies.
A. LoRa: The Physical Layer
The PHY layer is an example of CSS modulation, operating in unlicensed bands. According to CSS, each symbol to be transmitted is “spread” across the transmitting channel by means of a linear frequency-modulated signal having a ﬁxed duration. Thus, it can be considered an example of a spreadspectrum modulation that uses good autocorrelation properties of chirps, instead of well-known codes (e.g., gold codes). The tradeoff is between the larger time/frequency occupation with respect to improved robustness against interferences.
The LoRa solution assigns a speciﬁc instantaneous frequency trajectory to each symbol. In particular, a sharp edge appears in the frequency trajectory due to time wrapping of a reference chirp. Time (and frequency) shifts occur in discrete step, so that M = 2SF possible edge locations exist, each one representing a symbol. Differently said, the tunable SF represents the number of bits encoded in a single symbol. At the receiver, the signal is down mixed to revert it to the baseband, optimally ﬁltered (i.e., unchirped by means of a multiplication by a locally generated reference chirp), and then the actual symbol is estimated in the frequency domain.
When the LoRa radio is used in a LoRaWAN network, chirp bandwidths are in the range B ∈ [125, 250] kHz, whereas the SF can vary in the range SF ∈ [7 . . . 12]. Additionally, LoRa imposes a chirp duration TC = 2SF/B (i.e., B is not affected by the SF). Consequently, the raw bit rate Rb at the PHY level can be computed as in (1) and can vary from about 180 bps (B = 125 kHz, CR = 4/8, and SF = 12) to about 11 kbps (B = 250 kHz, CR = 4/5, and SF = 7). The CR term takes into account possible forward error correction (FEC) scheme

Fig. 2. LoRaWAN message format. Field lengths of the PHY payload are expressed in byte.

applied for increase noise immunity. In particular, the FEC is applied to every nibble as an Hamming code with coding rate CR = N/M, where M = {5, . . . , 8} is the codeword length and N = 4 is the data block length

Rb

=

SF ·

B 2SF

· CR.

(1)

It has to be highlighted that each SF is a sort

of pseudo-orthogonal code. Consequently, frames using

SF = i and SF = j can be correctly decoded even when

they overlap in time and frequency, as long as i = j

and the received packet’s signal-to-interference-plus-noise

ratio (SINR) is above the isolation threshold (a function of

i and j ). Additionally, the higher the SF the more robust the

coding, so that a possible ADR mechanism results in a tradeoff

between the actual SINR and the time-on-air.

The LoRa frame (see Fig. 2) starts with a preamble made

of eight consecutive unshifted reference chirps, used for syn-

chronizing the receiver with the transmitter. This preamble

is followed by a start of frame delimiter (SFD) that occu-

pies 4.25 symbols. The SFD also encodes a so-called “sync

word” which is used to distinguish between public/private

LoRaWAN network (sync word = 0 × 34 or 0 × 12, respec-

tively). Semtech does not disclose the details of the eight-

symbol long PHY header (sent using SF2, CR = 4/8 and

followed by its own cyclic redundancy check (CRC) ﬁeld);

probably it includes information about the payload length

and encoding strategy. Other than the FEC, data whitening;

interleaving and gray mapping of each symbol can be applied.

Finally, the trailer contains the PHY-payload CRC, that is

used for uplinks but it is typically not present in down-

link frames. Fig. 3 shows the initial parts of two frames

transmitted using SF7 and SF10, respectively. The RF signal

has been experimentally acquired by means of the mixed

domain oscilloscope MDO4014C from Tektronix. This oscil-

loscope allows to simultaneously work both in the time and

frequency domain and it has been exploited to track the

signal instantaneous frequency trajectory (brown signal). It is

possible to identify the 8-symbol long preamble and the

4.25-symbol long SFD. It is also evident that B is not affected

by SF, whereas the TC increases with the SF.

The overall message time-on-air can be split into a ﬁxed part

(preamble, SFD, and PHY-header) and a variable duration part

depending on the actual payload TOA = Tﬁxed + Tvariable. The ﬁxed part is poorly documented, but Tﬁxed can be inferred

from the SX1272 transceiver datasheet as in (2). An additional

overhead O is added for SF ∈ {11,12} (i.e., O = 1 and symbol

duration is longer to counteract clock drift occurring in long

frame at low data rates)

28 − 4SF M

Tﬁxed = 20.25 + SF − 2O N TC .

(2)

The variable part duration Tvariable is computed as in (3), where L is the PHY-payload length in B and 16 is the CRC

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

RIZZI et al.: EVALUATION OF IoT LoRaWAN SOLUTION

5

TABLE III
LORAWAN FREQUENCY PLAN IN AGREEMENT WITH ERC RECOMMENDATION 70-03 (AS FEBRUARY 2017)

Fig. 3. Chirp modulation of LoRa: Beginning of the PHY Headers of two messages sent with different SFs.
TABLE II LORA PHY PERFORMANCE

length in bits (if present)

Tvariable =

8L + 16 SF − 2O

M N

TC .

(3)

According to the LoRaWAN specs, the PHY layer payload includes the Media Access Control (MAC) header (MHDR = 1B long), the MAC payload and the message integrity code is 4B long. When the maximum useful payload is considered, the overall time-on-air ranges from TOA ≈ 0.2 s (when SF = 7, B = 250 kHz, O = 0, and CR = 4/5 is used) to TOA ≈ 4 s (when SF = 12, B = 125 kHz, O = 1, and CR = 4/8 is used).
Table II shows the resumed data provided by the radio manufacturer [27] for white noise resiliency regarding a tolerated PER = 10% when a 20B-long packet encoded using CR = 4/5 is transmitted. Regarding intrasystem collisions, when two packets having the same SF hit the antenna simultaneously, one needs to be at least 6 dB higher than the other in order to be correctly received. The demodulation is a linear process and signals having similar power are indiscernible. Conversely, for a collision with any other SF there is a positive isolation value, which means that the packet can “survive” another LoRa signal having bigger amplitude but different SF. In particular, in [28] is reported that per each SF increment, insolation is improved by 3 dB.

B. Data Link Layer
Currently, available LoRa speciﬁcations exploit the ALOHA mechanism for accessing the medium, despite “listen before talk” (LBT) techniques are theoretically allowed. In particular, considering the pseudo-orthogonality of different SFs, the overall network capacity results from the superposition of as many independent ALOHA-based networks as the SFs are. A lot of papers are available in the literature describing the maximum permitted throughput by pure ALOHA, which is 0.5/e frames per frame time (i.e., no more than 18% of time is

spent for successful TXs) per independent SF [17]. However, it must be highlighted that the previous result is further limited by duty-cycle restrictions, which are one of the technique the standard adopts for satisfying unlicensed bands limitations. Due to their importance, such normative constraints are brieﬂy discussed in the following section.
The MAC layer payload is further divided into the end device address (4B long), the frame control and frame counter (1B, and 2B long, respectively), an optional ﬁeld (up to 15B long), the application endpoint (FPort = 1B long), and the variable length frame payload. The MAC ancillary ﬁelds occupy from 9 B to 24 B depending on the optional ﬁeld size. In order to keep time-on-air short, minimizing the effect of clock drift, the usable MAC level payload length may range from [227, 242] B at SF7 down to [36, 51] B at SF12, depending on the size of FOpt ﬁeld. If needed, message can be conﬁgured as “conﬁrmed” requiring that an acknowledge is sent for ﬁnalizing the transaction.
V. LORA AND NORMATIVE CONSTRAINTS
In Section IV showed that the LoRaWAN solution performance is compatible with the targeted application scenario, i.e., the implementation of DMSs. However, limitations deriving from regional norms are not considered and can potentially be the most important affecting parameter. Indeed, the LoRa radios can operate into different unlicensed regions of the spectrum, which are typically only regulated in terms of maximum transmitting power and duty cycle (i.e., the ratio of the total transmitter “on”-time to an observation period). For example, in Europe LoRa can operate in the 868-MHz subbands normed by the EN300220-1, in the bands and subbands speciﬁed in the ERC Recommendation 70-03. The maximum output power ranges from +14 to +27 dBm, with a duty-cycle d from 10% to 0.1% depending on frequency subband (see Table III). Additional fairness of the transmitter can be obtained using: LBT protocols; and adaptivity and frequency agility (AFA) (both of them optional for LoRa device).
As a concluding remark, the availability of 42 virtual channels (obtained from 6 possible SFs multiplied by 7 PHY frequency channels) results in about 3.6 · 106 s per day available for TXs. If few messages per node per day are enough, the overall number of nodes is in the million range. Conversely, if periodic high-speed refresh time is needed, the number of nodes decreases to few thousands, as shown

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

6

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

in [17]. In particular, the synchronization of TX instants can ensure a refresh time of 60 s for more than 6000 nodes [29].
VI. EXPERIMENTAL RESULTS
The evaluation of LoRaWAN has been carried out considering the most important characteristics for the implementation of a DMS. Different setups have been arranged in order to evaluate TX, reception (RX), and timestamping uncertainties.

A. Components of the Hardware Setup
The following components and devices were used. 1) One Agilent 53230A time interval counter (TIC), with
internal ovenized crystal oscillator (OCXO) time-base option. 2) One Agilent 33220A function generator, syntonized to the 53230A through the “Ext. Ref. In” connector. 3) Three SX1272 mbed boards, mounting the Semtech’s SX1272 LoRa modem that can transmit on a single channel per message. 4) Three STM32 nucleo boards. 5) One multitech LoRa packet forwarder. The Multitech packet forwarder uses an SX1301 (from Semtech) that is able to simultaneously decode up to ten channels (1 for a frequency-shift keying communication and the remaining 9 for LoRa messages). 6) One personal computer (PC) connected to the packet forwarder through Ethernet connectivity. The 53230A acts as the time (and frequency) reference for all the setups described in the following. It has an internal reference output (10 MHz) used to syntonize the 33220A. A TIC measures the time interval of two channels, namely, START and STOP, using its internal time base. The 53230A has a single-shot resolution below 20 ps (i.e., resulting into an equivalent Allan deviation of ADEV(τ ) = 2 · 10−11/τ ). The internal time-base (based on an OCXO) has a short-term stability (according to the manufacturer speciﬁcations) equal to ADEV(τ = 1 s) = 10−11 and a linear aging of ±0.3 ppb in 24 h. Accordingly, since measurements in SETUP I and SETUP II have a limited duration (i.e., less than one second), the measurable ADEV is always dominated by the TIC ﬁnite resolution. The 33220A is locked to the TIC’s time base. The function generator is used to provide a 1-pulse-per-second (1-PPS) synchronization signal to the SX1272 boards. The ability of the function generator to modify the shape of the 1-PPS signal (and in particular the duty cycle) is used to simulate scheduled transactions (e.g., for ensuring real-time requirements of DMS). The mbed SX1272 board has an Arduino shield connector, used to communicate with a host board. The connector has a number of communication lines. Notably, one of these lines is used for the signaling of the completed TX or RX of LoRa frames (RX_DONE or TX_DONE, depending on the context). This line is used to characterize the LoRa modem without the inﬂuence of the host board latencies. The SX1272 transceiver has a clock signal output directly derived from the crystal oscillator (XO) used by the internal phase-locked loop and RF stage. By means of the 53320A, the ADEV of such a reference

Fig. 4. Measurement setup for the characterization of the transmisison uncertainty (SETUP I).
clock has been evaluated and shown in Fig. 11. Unfortunately, the mbed SX1272 board does not allow the exploitation of this signal as clock for the host board, unless heavy hardware modiﬁcations.
The host board is an STM32 Nucleo board, used to send and receive frame to/from the mbed SX1272 board. The Nucleo board sends a frame when a rising edge is detected on one of its I/O lines (external trigger) using the highest interrupt priority. The ﬁrmware has been designed to introduce a latency as little as possible and to reduce nondeterministic delays. In order to achieve those characteristics, the ﬁrmware preloads in memory the frame to be send before the external trigger. The data are sent to the SX1272 using the STM32’s LoRa driver. The driver has been inspected to avoid any delay statements, which could introduce latency ﬂuctuations due to the instability of the STM32 internal oscillator.
B. Characterization of Frame Transmission Uncertainty The very ﬁrst experiment deals with the characterization of
the time-related uncertainty of the test setup itself. In particular, the determinism of the TX instant due to the operation of the host board and of the SX1272 is evaluated. This is important for obtainable latency and update-time evaluation and for possible suitability of synchronization algorithms as well.
Fig. 4 shows the measurement setup (SETUP I). The 1-PPS signal is used to trigger the TX of a LoRa frame. The TIC is used to measure and record the time interval (latency) between the TX trigger instant and the “TX_DONE” interrupt generated by the SX1272. The measurement has been repeated for 1000 frames with 64B payload and SF equal to 7 and 10, respectively.
Fig. 5 and Table IV show the measurement results. Notably, the latency strictly depends on the symbol time of the selected SF. The measured latency has a randomly spike of about 8 μs. The spike amplitude is not affected by the SF and it is probably related to the internal processing of SX1272. Since at the highest rate (SF = 7) the discrete position of the instantaneous frequency jump inside the chirp symbol has a resolution of TC /2SF ∼= 8 μs, the achievable level of uncertainty is close to the limit of the LoRa modulation.
Table IV shows the statistics of the measured latency, with a standard deviation of about 1.4 μs for both SFs. The distribution of the measurements is not Gaussian due to the occasional

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

RIZZI et al.: EVALUATION OF IoT LoRaWAN SOLUTION

7

Fig. 5. Latency measurements between TX trigger instant and the “TX_DONE” interrupt generated by the SX1272.

Fig. 6. Measurement setup for the characterization of the transmisison uncertainty, SETUP II-a (solid line) and II-b (dotted line).

TABLE IV MEASUREMENTS RESULTS FOR SETUP I AND SETUP II

spike already mentioned. As previously discussed, the uncertainty measured using SETUP I represents the uncertainty of the TX of a LoRa frame respect to an external trigger signal. In an application involving a device distributing a “Beacon” (i.e., frequency distribution), the measured uncertainty would be a limiting factor.
Next, a characterization of a peer-to-peer TX has been done. The peer-to-peer TX involves the use of two SX1272 boards, one conﬁgured for TX, and the other one for RX, as depicted in Fig. 6. The TIC counter is used to measure the time interval between the signal of “TX_DONE” and of the “RX_DONE” of the boards (SETUP II-a); and the time interval between the TX trigger instant and the “RX_DONE” of the RX board (SETUP II-b).
The measurement has been carried out in a controlled environment without other external interfering nodes. The distance between nodes is of 3 m. The correct TX and RX of 1000 frames having a payload of 64B has been check for SF equal to 7 and 10, respectively.
Table IV shows the results of the SETUP II measurements for a number of factors. Regarding the quality of the link, the PER for both SFs has been assessed to be below 0.1% (no frame lost in the experiment). The SX1272 provides an estimation of the RSSI and of the SNR. The reported data conﬁrms the process gain of LoRa modulation: although the RSSI is the same for both SFs (about −41 dBm), the SNR of the modem has an increase of 6 dB.
The time measurements results of SETUP II-a show the uncertainty in the estimation of difference between the

Fig. 7. Experimental data of SETUP II-a for SF7 and SF10. The measured time interval is plotted as a function of the frame number. Each frame was sent every 1 s.
departure and arrival time done by the SX1272. The measured standard uncertainty is 2.3 μs (i.e., an extended uncertainty of 7 μs with a coverage factor of 3), as shown in Table IV. Fig. 7 shows the experimental data of SETUP II-a (for SF7 and SF10) as a function of frame number. This setup is useful to characterize the performance of a twoway synchronization algorithm (e.g., IEEE1588), where each node measures the time interval between the TX and RX of the synchronization frames (e.g., using “TX_DONE” and “RX_DONE” signals).
The results of SETUP II-b combine the effects of SETUP I and SETUP II-a. Indeed, the measured uncertainty is higher because contains also the effect of the trigger TX uncertainty measured in SETUP I.
For all the setups, Table IV reports the ADEV value, as well. The measured ADEV has a prevalent white phase modulation noise type having a 1/τ slope. The measured ADEV values for τ values shorter than 100 s are very high compared to a typical XO performance. For instance, at τ = 1 s, the ADEV of the mbed SX1272 XO is three order of magnitude better than the measurements reported in Table IV for SETUP II-a (see Fig. 11, referred to an observation time of 20 000 s). Accordingly, it is possible to state that the short-term noise

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

8

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

Fig. 8. Measurement setup for the characterization of the timestamping uncertainty of the packet forwarder (SETUP III).

is mainly dominated by the LoRa transceiver timestamping quality. The choice of the clock correction rate must take into account the ADEV performance of both the node XO and the quality of the time measurement from the transceiver. The former depends on the XO quality and by the environmental conditions, the latter is reported in Table IV. Any synchronization algorithm follows the stability of the reference clock. Thus, referring to results in Fig. 11, a fast clock correction rate (e.g., 1 Hz) would be detrimental to the node’s clock performance, while synchronizing about every 500 s may result in an improvement of the overall stability performance.

Fig. 9. ADEV of SETUP III. The ADEV values are comparable to the ones measured in SETUP II-b.

C. Uplink Test
The characterization of the uplink involves the characterization of the packet forwarder. The analysis of the packet forwarder deals with two aspects: uncertainty in the timestamping of the incoming packets, and uncertainty of the TX instants when scheduled TX is used. Only the former is treated in this section, since falls in the uplink characterization; the latter will be characterized on the following section (downlink test). The authors stress that it is not possible to derive ﬁxed time relationship exploiting the hardware, as it has done with previous setups.
The characterization of the timestamping accuracy has been carried out using the experimental SETUP III, depicted in Fig. 8. The adopted approach involves the use of one SX1272 periodically transmitting a frame, with a rate of 1 frame per second. The packet forwarder timestamps the incoming frames with a counter having microsecond resolution. Since the 1-PPS signal is locked to the TIC’s OCXO (which is the experimental time-base reference), the packet forwarder timestamps are affected by two source of uncertainty: timestamping unit performance; and internal time-base ﬂuctuations.
The timestamping accuracy typically depends on the shortterm noise as white noise and limited resolution. The packet forwarder internal time base is based on a XO, which typically have a good short-term stability but a poor long-term stability due to aging, temperature stability, etc… The ADEV has been computed to separate the short-term noise from the long-term noise. In our case, the former (short-term noise) is dominated by the LoRa transceivers timestamping quality. The ADEV computed from 1000 frames is shown in Fig. 9. The ADEV at τ = 1 s is similar to the value reported

Fig. 10. Experimental setup for the evaluation of the downlink time uncertainty of LoRa radios (SETUP IV).
in Table IV for SETUP II-b (equal to 5E-6/τ ), conﬁrming that the timestamping capability of the packet forwarder, hosting the SX1301, is similar to the SX1272 one.
D. Downlink Test
Despite DMSs gather information from the ﬁeld, thus mainly requiring reliable uplink connections, downlinks are fundamental for dynamically parametrizing and conﬁguring end nodes; for accurate time synchronization; and for supporting feedback loops (e.g., in control applications).
The downlink test characterizes the capability of the packet forwarder to timely transmit messages. A PC, acting as the network server, schedules a TX each “second,” where the “second” refers to the packet forwarder internal time-base, as described in Section III. Formally, this behavior is obtained by incrementing the time-code value (as provided by the network server to the packet forwarder) by one second after each TX.
Fig. 10 shows the experimental SETUP IV. Due to the internal scheduler limitation of the adopted packet forwarder, which allows only one packet to be stored in its own message queue, the experimental setup leverages on an ancillary SX1272 TX board to syntonize (one message per second) the new frame TX instant. Practically, the SX1272 TX board periodically sends a frame that allows the network server knowing the value of the packet forwarder internal counter and to be sure that

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

RIZZI et al.: EVALUATION OF IoT LoRaWAN SOLUTION

9

TABLE V LORA PERFORMANCE

Fig. 11. ADEV of the packet forwarder (solid blue line), SX1272’s time base (dotted black line).
enough time is elapsed from the previous downlink so that the next TX can be scheduled. This solution is adopted since the operating system timer function is too much inaccurate and may introduce a frame slip due to drifting. Remarkably, the adopted solution does not affect the time instant of frame TX by the packet forwarder.
The RX of the frame sent by the packet forwarder is done by another SX1272; its RX_DONE line is connected to the TIC, as an STOP signal. The START signal is the 1-PPS signal also feeding the SX1272 TX board. The choice of using the START and STOP signal in this order is completely arbitrary, and does not affect the measurement. The 1-PPS signal is used as time reference to measure the combined effect of the packet forwarder time-base stability and of the short-term accuracy of the scheduler. Fig. 11 shows the ADEV obtained from this measurement, carried out in laboratory conditions with duration of about 40 000 s.
The long-term stability of the packet forwarder’s time base is clearly visible at τ = 5000–10 000 s (supposing a stationary behavior of the timestamping procedure). The 53230A is not affecting the result; indeed (from the datasheet) the 53230A OCXO stability should be on the order of 0.1 ppb at τ = 10 000 s. The packet forwarder stability is compatible with a cheap XO implementation. The frequency offset of the packet forwarder time base has been estimated as 3 ppm. For τ < 1000 s, the ADEV value is limited by the SX1272 timestamping quality and by the packet forwarder’s scheduler. The slightly larger ADEV at τ = 1 s, with respect to the measurement of SETUP III, is probably imputable to the contribution of the scheduler.
As a ﬁnal remark, the measured ADEV shows that the packet forwarder time base can be synched (e.g., by PTP protocol or external GPS) every 1000 s without any detrimental effect on the overall performance of the synchronization system.
VII. DISCUSSION
As remarked in Section III-C, the comparison of experimental results with the requirement of Table I is the key for

the evaluation of LoRaWAN applied to DMS. Starting from results detailed in Section VI, Table V has been ﬁlled in.
Regarding the minimum update time and the maximum latency, main limitations may come from regional duty-cycle parameters. Accordingly, both FoM ranges from 20 to 400 s when d = 1% and TOA varies from about 0.2 to 4 s (considering the maximum permitted payload, i.e., 51 B at SF7 and 242 B at SF12, respectively). Regarding the synchronization accuracy, it has been demonstrated that timestamping errors (on the order of few microseconds) dominate over local clock stability on the short term; on the contrary, for time intervals longer than 100 s, synchronization algorithm could be proﬁtably applied. Regarding the number of nodes, it has been already stated that when few messages per day are enough for the considered application, the number of nodes is in the order of millions, decreasing to few thousands if (synchronized) short refresh time is needed.
Consequently, DMS application domains having many similarities with IoT paradigm, as smart building automation, and smart metering, are easily managed by LoRaWAN solution. Industrial process automation and home automation can be handled paying attention to timing requirements of the considered application. Conversely, industrial factory automation update time is not met and grid status estimation synchronization error requirement is not met as well. Finally, LoRaWAN ﬁts timings of smart building automation and (EV) ﬂeet management, but its applicability depends on the speciﬁc message size required by the applications.
VIII. CONCLUSION
Any IoT system can be considered a DMS, but the IoT world is pushing new technologies mainly for taking into account scalability and low infrastructure cost, often sacriﬁcing time-related requirements. This paper tried to assess if new IoT technologies are usable to realize specialized (private) DMSs. In detail the LoRa and LoRaWAN technologies are investigated since, from the architectural point of view, this solution satisﬁes many of distributed measurement scenarios needs because of: high number of nodes, very large area of operation, sufﬁcient space in user payload of frames; and some attention to time behavior of nodes. Since the last aspect is probably the least investigated in the literature, this paper focuses on time-related performance indicators. Timestamp uncertainty of events is one of the most important source of error in DMSs and, unfortunately, IoT systems are often designed without considering timestamp accuracy. The experimental results presented in the paper show that low-cost transceivers can schedule the TX of frames with a standard deviation less than 3 μs, thus reaching a low sampling

This article has been accepted for inclusion in a future issue of this journal. Content is final as presented, with the exception of pagination.

10

IEEE TRANSACTIONS ON INSTRUMENTATION AND MEASUREMENT

time uncertainty. Moreover, commercial available packet for-
warders have acceptable long-term clock stability (about 1 · 10−8, as evaluated by means of ADEV) making them
suitable for the implementation of DMSs in the ﬁeld of smart
metering, smart building monitoring and process industry.
ACKNOWLEDGMENT
The authors would like to thank Dr. I. P. Palazzoli of
the A2A Smart City SpA for the general discussion about
application requirements.
REFERENCES
[1] C. Perera, C. H. Liu, and S. Jayawardena, “The emerging Internet of Things marketplace from an industrial perspective: A survey,” IEEE Trans. Emerg. Topics Comput., vol. 3, no. 4, pp. 585–598, Dec. 2015.
[2] I. Stojmenovic, “Machine-to-machine communications with in-network data aggregation, processing, and actuation for large-scale cyberphysical systems,” IEEE Internet Things J., vol. 1, no. 2, pp. 122–128, Apr. 2014.
[3] F. Tao, Y. Zuo, L. Da Xu, and L. Zhang, “IoT-based intelligent perception and access of manufacturing resource toward cloud manufacturing,” IEEE Trans. Ind. Informat., vol. 10, no. 2, pp. 1547–1557, May 2014.
[4] P. Hu, “A system architecture for software-deﬁned industrial Internet of Things,” in Proc. IEEE Int. Conf. Ubiquitous Wireless Broadband (ICUWB), Oct. 2015, pp. 1–5.
[5] A. Zanella, N. Bui, A. Castellani, L. Vangelista, and M. Zorzi, “Internet of Things for smart cities,” IEEE Internet Things J., vol. 1, no. 1, pp. 22–32, Feb. 2014.
[6] L. Da Xu, W. He, and S. Li, “Internet of things in industries: A survey,” IEEE Trans. Ind. Informat., vol. 10, no. 4, pp. 2233–2243, Nov. 2014.
[7] S. M. R. Islam, D. Kwak, M. H. Kabir, M. Hossain, and K.-S. Kwak, “The Internet of Things for health care: A comprehensive survey,” IEEE Access, vol. 3, pp. 678–708, 2015.
[8] P. Castello, P. Ferrari, A. Flammini, C. Muscas, P. A. Pegoraro, and S. Rinaldi, “A distributed PMU for electrical substations with wireless redundant process bus,” IEEE Trans. Instrum. Meas., vol. 64, no. 5, pp. 1149–1157, May 2015.
[9] A. Khan and K. Turowski, “A survey of current challenges in manufacturing industry and preparation for industry 4.0,” in Advances in Intelligent Systems and Computing, vol. 450. Cham, Switzerland: Springer, 2016, pp. 15–26.
[10] Y. Liu and X. Xu, “Industry 4.0 and cloud manufacturing: A comparative analysis,” in Proc. ASME 11th Int. Manuf. Sci. Eng. Conf., vol. 2. 2016, pp. 1–8
[11] P. Bellagente, P. Ferrari, A. Flammini, S. Rinaldi, and E. Sisinni, “Enabling PROFINET devices to work in IoT: Characterization and requirements,” in Proc. Conf. Rec.-IEEE Instrum. Meas. Technol., May 2016, pp. 1–6.
[12] D. Gallo, C. Landi, and N. Pasquino, “Multisensor network for urban electromagnetic ﬁeld monitoring,” IEEE Trans. Instrum. Meas., vol. 58, no. 9, pp. 3315–3322, Sep. 2009.
[13] H.-C. Lee and H.-B. Huang, “A low-cost and noninvasive system for the measurement and detection of faulty streetlights,” IEEE Trans. Instrum. Meas., vol. 64, no. 4, pp. 1019–1031, Apr. 2015.
[14] M. Kuzlu, M. Pipattanasomporn, and M. Rahman, “Communication network requirements for major smart grid applications in HAN, NAN and WAN,” Comput. Netw., vol. 67, pp. 74–88, Jul. 2014.
[15] L. Ascorti, S. Savazzi, G. Soatti, M. Nicoli, E. Sisinni, and S. Galimberti, “A wireless cloud network platform for industrial process automation: Critical data publishing and distributed sensing,” IEEE Trans. Instrum. Meas., vol. 66, no. 4, pp. 592–603, Apr. 2017.
[16] E. Spanò, S. Di Pascoli, and G. Iannaccone, “Internet-of-Things infrastructure as a platform for distributed measurement applications,” in Proc. IEEE Int. Instrum. Meas. Technol. Conf. (IMTC), Pisa, Italy, May 2015, pp. 1927–1932.
[17] K. Mikhaylov, J. Petaejaejaervi, and T. Haenninen, “Analysis of capacity and scalability of the LoRa low power wide area network technology,” in Proc. 22nd Eur. Wireless Conf. Eur. Wireless, Oulu, Finland, May 2016, pp. 1–6.
[18] J. So, D. Kim, H. Kim, H. Lee, and S. Park, “LoRaCloud: LoRa platform on OpenStack,” in Proc. IEEE NetSoft Conf. Workshops (NetSoft), Seoul, South Korea, Jun. 2016, pp. 431–434.

[19] L. Vangelista, A. Zanella, and M. Zorzi, “Long-range IoT technologies: The dawn of LoRa,” in Proc. EAI Int. Conf. Future Access Enablers Ubiquitous Intell. Infrastruct. (Fabulous), Ohrid, Macedonia, Sep. 2015, pp. 51–58.
[20] T. Wendt, F. Volk, and E. Mackensen, “A benchmark survey of long range (LoRaTM) spread-spectrum-communication at 2.45 GHz for safety applications,” in Proc. IEEE 16th Annu. Wireless Microw. Technol. Conf. (WAMICON), Cocoa Beach, FL, USA, Apr. 2015, pp. 1–4.
[21] T. Petric, M. Goessens, L. Nuaymi, A. Pelov, and L. Toutain, “Measurements, performance and analysis of LoRa FABIAN, a real-world implementation of LPWAN,” in Proc. 27th Annu. Int. Symp. Pers., Indoor, Mobile Radio Commun. (PIMRC), Valencia, Spain, Sep. 2016, pp. 1–7.
[22] A. Augustin, J. Yi, T. Clausen, and W. M. Townsley, “A study of LoRa: Long range & low power networks for the Internet of Things,” Sensors, vol. 16, no. 9, p. 1466, 2016.
[23] B. Reynders, W. Meert, and S. Pollin, “Range and coexistence analysis of long range unlicensed communication,” in Proc. IEEE 23rd Int. Conf. Telecomm. (ICT), Thessaloniki, Greece, May 2016, pp. 1–6.
[24] J. Petäjäjärvi, K. Mikhaylov, M. Pettissalo, J. Janhunen, and J. Iinatti, “Performance of a low-power wide-area network based on LoRa technology: Doppler robustness, scalability, and coverage,” Int. J. Distrib. Sensor Netw., vol. 13, no. 3, pp. 1–16, 2017.
[25] T. Verbeke, E. Olti, and A. Munteanu, “Demo: Development and demonstration of a LoRa TDOA-based localisation system,” in Proc. 10th Int. Conf. Distrib. Smart Camera (ICDSC), New York, NY, USA, 2016, pp. 1–2.
[26] P. Ferrari et al., “Timestamping and ranging performance for IEEE 802.15.4 CSS systems,” IEEE Trans. Instrum. Meas., vol. 63, no. 5, pp. 1244–1252, May 2014.
[27] Combined Narrow-Band and Spread Spectrum Physical Layer Proposal for Cellular IoT, document GP-150074, 3GPP-GERAN (GSM EDGE Radio Access Network) Meeting, 2015. [Online]. Available: http://www.3gpp.org/ftp/tsg_geran/TSG_GERAN/GERAN_65_Shanghai/ Docs/GP-150074.zip
[28] C. Goursaud and J.-M. Gorce, “Dedicated networks for IoT: PHY/MAC state of the art and challenges,” EAI Endorsed Trans. Internet Things, vol. 1, no. 1, pp. 1–11, Oct. 2015. [Online]. Available: https://hal. archives-ouvertes.fr/hal-01231221
[29] M. Rizzi, P. Ferrari, A. Flammini, E. Sisinni, and M. Gidlund, “Using LoRa for industrial wireless networks,” in Proc. IEEE 13th Int. Workshop Factory Commun. Syst. (WFCS), Trondheim, Norway, May 2017, pp. 1–4.
Mattia Rizzi received the Ph.D. degree in electronic instrumentation from the University of Brescia, Brescia, Italy, in 2017, with a focus on architectures and instrumentation for high-versatility, FPGA-based, sensor and systems.
He did an internship at CERN, Genève, Switzerland, for more than one year, focusing on time synchronization related topics.
Paolo Ferrari (S’00–M’04) is currently an Associate Professor with the Department of Information Engineering, University of Brescia, Brescia, Italy. His current research interests include embedded measurement instrumentation, smart sensors, sensor networking, smart grids, real-time Ethernet.
Dr. Ferrari received the Technical Award of the IEEE Instrumentation and Measurement Society, in 2013.
Alessandra Flammini (M’99–SM’10) is currently a Full Professor with the University of Brescia, Brescia, Italy. She coordinates the Embedded Systems and Smart Sensors Research Group, Brescia. Her current research interests include numeric measurement instrumentation, sensor signal processing, smart sensors and wireless sensor networking, real-time industrial applications, smart grids and wearable sensing.
Emiliano Sisinni (S’02–M’04) is an currently Associate Professor in electronics with the Department of Information Engineering, University of Brescia, Brescia, Italy. He has authored of more 100 international papers. His current research interests include smart sensors, wireless sensor networking, wired and wireless industrial communications, and smartdevices.

