University of Cuenca
Faculty of Engineering
School of Electronics and Telecommunications
Assessment transmission range LoRa for Wireless Sensors LoRaWAN in forest environments
Work prior to obtaining the title of Engineer in Electronics and Telecommunications degree.

Author :

Pablo Esteban Avila Campos

CI 0105737118

Director :

Ing. Fabian Astudillo Darwin Salinas, PhD

CI 0103907036

Co-Director:

Ing. Andrés Marcelo Vázquez Rhodes, PhD

CI 0301496840

Ecuador basin 2017

University of Cuenca

Summary
Low-power networks and wide area coverage ( Low Power Wide Area Network (LPWAN) ) Are presented as a new trend in the evolution of telecommunications, one of the technologies that has emerged as part of the LPWAN , is Long Range (LoRa) ; addition to the clear advantages of the LPWAN , LoRa It is characterized by the low cost of nodes and rapid deployment.
At this time, new paradigms emerge in communications networks such as the Internet of things ( Internet of Things (IoT) ), Whose needs will eliminate with technologies are still developing as 5G is for this reason that development groups as LoRa Alliance, propose solutions as Long Range Wide Area Network (LoRaWAN) to address market needs. LoRaWAN , Is defined as a layer of Layer Media Access Control (MAC) using the characteristics of LoRa to create targeted networks IoT .
The purpose of this study is to adjust models propagation loss measurements using Level Indicator Signal ( Received Signal Strength Indicator (RSSI) ) And the Radio Signal to Noise ( Signal to Noise Ratio (SNR) ) In different environments, related to the deployment of sensor networks in forest environments, speci fi cally riverbanks. These models are meant to address the hypothesis that in rural environments will have better coverage in urban environments.
The methodology involves sending messages and capture LoRaWAN with the development kit Microchip 900. These ships within intervals of ten meters at a fi xed height of two meters above ground level. At each point of shipment, twenty messages, ten of them are transmitted with the highest data rate ( Data Rate (DR) ) And ten with the lowest allowed by the aforementioned kit. The number of messages received is used as quality parameter of each transmission, helping to determine when it is no longer possible to send information.
As results showed that in rural settings compared to urban, coverage improved to 40% with the highest DR and 60% at the lowest. Both of them DR present

Pablo Campos Avila

iii

Similar models until certain distance that depends on the measured environment. This would prove to be using a DR provided there is greater coverage because their use would result in lower energy consumption for less airtime. Another result is that occurring in urban environments higher standard deviation in the samples exist. This con fi rmaria and is directly related to the higher density of obstacles, also causing the models adjusted in rural environments, more with fi ables. Finally, statistical tests comparing distributions in the three environments were performed with Affirming the need to distinguish environments independently.
Keywords : LoRa , LoRaWAN , IoT , RSSI , SNR , Losses, forest, river, propagation model.

University of Cuenca

Abstract
LPWAN are a new trend in the telecommunications evolution. One of the Technologies that have Emerged as part of LPWAN , is LoRa . In Addition to the clear advantages of LPWAN , LoRa Characterized by low cost is of nodes and rapid deployment.
At the moment, new paradigms as the IoT emerge in the telecommunications networks, Whose needs are solved in technologies still in development like 5G. It is for esta reason That development groups like LoRa Alliance, propose solutions like LoRaWAN to solve the needs of the market. LoRaWAN , Is de fi ned as a MAC That use LoRa features to create networks focused on IoT .
The purpose of this study is to adjust propagation loss models using Received Signal Strength Indicator ( RSSI ) And Signal to Noise Radio ( SNR ) Di ff erent measurements in environments, related to the deployment of sensor networks in forest environments, speci fi cally on riverbanks. These models are Intended to answer the hypothesis That Have rural environments will better coverage than urban.
The methodology Consist in sending messages and capture LoRaWAN With the Microchip development kit 900. The transmissions are made at intervals of ten meters at a height of two fi xed meters height above ground level. At each point of transmission, messages are transmitted twenty. Ten With the highest data rate ( DR ) And ten With the lowest allowed by the kit. The number of received packets is used as the quality parameter of each transmission, helping to determine when it is no longer feasible to send information.
As a result, it is shown by improved coverage That up to 40% With the highest DR and 60% With the lowest Comparing rural with urban environment. Both DR Similar models present up to a distance Depending on the Certain Measured environment. This would Demonstrate That a higher DR Should be used as long as there is coverage Since its use would result in lower energy consumption. Another result found is a greater standard deviation in urban environment. This would con fi rm and is Directly related to the greater density of obstacles, Also Causing the adjusted

Pablo Campos Avila

v

models in rural environments, to be more reliable. Finally, we performed statistical tests Compared That the distributions in the three environments, con fi rming the need to characterize the environments Independently.
Keywords: LoRa , LoRaWAN , IoT , RSSI , SNR , Path loss, forested, riverside, propagation, model

University of Cuenca
General index
Summary Abstract General index Index fi gures Table index Dedication Thanks Abbreviations and acronyms 1. Introduction
1.1. Problem identification. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.2. Justification. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.3. Scope. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.4. Goals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
Pablo Campos Avila

III V
VII XIII XVII XXII XXIII XXIV
two
3 3 4 5
vii

University of Cuenca 1.4.1. Overall objective . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.4.2. Speci fi c objectives. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2. Theoretical Framework
2.1. Introduction. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2.2. Wireless Sensor Networks. . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.2.1. Main Technologies IoT . . . . . . . . . . . . . . . . . . . . . . . . 2.3. Wide area networks and low power ( LPWAN ). . . . . . . . . . . . . .
2.3.1. Main features of a network LPWAN . . . . . . . . . . . . . . . 2.4. Basics of modulation LoRa . . . . . . . . . . . . . . . . . . . . . . .
2.4.1. Principles of Spread Spectrum. . . . . . . . . . . . . . . . . . . . . 10 2.4.2. Spread spectrum LoRa . . . . . . . . . . . . . . . . . . . . . . . . . . eleven 2.4.3. Transmission parameters. . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.4.4. Key Properties Modulation LoRa . . . . . . . . . . . . . . . . . . 12 2.5. MAC LoRa : LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 2.5.1. classes LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . fifteen 2.5.2. Physical formats Messages - Class A. . . . . . . . . . . . . . . . . . . 16 2.5.3. Message Formats MAC - A class . . . . . . . . . . . . . . . . . . . . 17 2.5.4. Enabling end devices. . . . . . . . . . . . . . . . . . . . . . 18 2.5.5. Data Rate ( DR ) And transmit power. . . . . . . . . . . . . . . 19 2.6. Path loss model. . . . . . . . . . . . . . . . . . . . . . . . . . twenty 2.7. Conclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . twenty-one
3. State of the Art LoRa Y LoRaWAN
Pablo Campos Avila

5 5 6 7 7 8 9 9 9
2. 3
viii

University of Cuenca 3.1. Introduction. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 3.2. Physical Layer - LoRa . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 3.3. Cap MAC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.4. System Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 3.5. Conclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28

4. Methodology

29

4.1. Introduction. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30

4.2. Equipment description. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30

4.2.1. Evaluation Kit LoRa - 900. . . . . . . . . . . . . . . . . . . . . . . 30

4.2.2. 3 Model B Raspberry Pi. . . . . . . . . . . . . . . . . . . . . . . . . . . 32

4.2.3. Disposal. . . . . . . . . . . . . . . . . . . . . . . . . . . . 32

4.3. Device conguration. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

4.4. Description of the Environment. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

4.4.1. Environment 1: Urban - Rio Tomebamba. . . . . . . . . . . . . . . . . . . . 3. 4

4.4.2. Environment 2: semi-urban - Rio Machángara. . . . . . . . . . . . . . . . . 35

4.4.3. Environment 3: Rural - Rio Yanuncay. . . . . . . . . . . . . . . . . . . . . . 36

4.5. Procedure description . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.1. Measurement intervals. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.2. Sent packets. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38

4.5.3. Packet capture. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39

4.5.4. Decrypted and storage. . . . . . . . . . . . . . . . . . . . . . . 40

4.6. Data Analysis metrics. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40

Pablo Campos Avila

ix

University of Cuenca 4.6.1. Description Data with Numerical measures. . . . . . . . . . . . . . . . 40 4.6.2. Estimation of confidence intervals. . . . . . . . . . . . . . . . . . . . 41 4.6.3. Correlation analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 4.6.4. Comparison Populations. . . . . . . . . . . . . . . . . . . . . . . . . 42 4.7. Conclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
5. Results: Measurements and Analysis Adjust the empirical model based on RSSI and SNR 44
5.1. Introduction. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Four. Five 5.2. Preliminary measurements. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Four. Five
5.2.1. Frequency Hopping. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Four. Five 5.2.2. Number of packages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46 5.2.3. Power Index. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46 5.3. measurements RSSI Y SNR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47 5.4. Statistical analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 5.4.1. Correlation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 5.4.2. Comparing Environments. . . . . . . . . . . . . . . . . . . . . . . . . . 49 5.5. Modeling in Base path loss. . . . . . . . . . . . . . . . . . 51 5.5.1. Measuring 1 - Urban Environment. . . . . . . . . . . . . . . . . . . . . . . . 52 5.5.2. Measurement 2 - Urban Environment - Shore 2. . . . . . . . . . . . . . . . . . 53 5.5.3. Measuring 3 - semi-urban environment. . . . . . . . . . . . . . . . . . . . . . 53 5.5.4. Measuring 4 - Rural Environment. . . . . . . . . . . . . . . . . . . . . . . . . 55 5.5.5. Comparing Models. . . . . . . . . . . . . . . . . . . . . . . . . . . 57 5.6. Packet error rate. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59

Pablo Campos Avila

x

University of Cuenca 5.7. Conclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62

6. Conclusions and Recommendations

63

6.1. Conclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64

6.2. Recommendations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64

6.3. Future work. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65

A. Device setup

68

A.1. Installation and setup of server and Gateway LoRaWAN. . . . . . . . . . . 68

A.1.1. Installation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69

A.1.2. System Preparation. . . . . . . . . . . . . . . . . . . . . . . . . . . . 70

A.1.3. Setting up the server. . . . . . . . . . . . . . . . . . . . . . . . . . . 73

A.1.4. Network conguration. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75

A.1.5. Fi Additional configuration for 915 MHz. . . . . . . . . . . . . . . . . . . . 78

A.2. Setting up the node. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79

B. Decryption and Storage

84

B.1. Decrypting Packages - LoRaWAN. . . . . . . . . . . . . . . . . . . . . . 85

B.2. Decrypted and storage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 86

C. Measurements of RSSI and SNR

91

C.1. RSSI measurements

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92

C.2. SNR measurements. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96

Bibliography

101

Pablo Campos Avila

xi

University of Cuenca

Pablo Campos Avila

xii

University of Cuenca

Index fi gures

2.1. Enlargement process [ one ]

. . . . . . . . . . . . . . . . . . . . . . . . . . . . 10

2.2. Extract from spectrogram of a chirp ( SF = 8, BW = 125kHz) [ two ]

. . . . . . . . eleven

2.3. LoRaWAN system architecture [ 3 ]

. . . . . . . . . . . . . . . . . . . . . . . 14

2.4. LoRaWAN protocol architecture [ 3 ]

. . . . . . . . . . . . . . . . . . . . . . 14

2.5. Lessons LoRaWAN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . fifteen

2.6. Physical Structure Uplink [ 4 ]. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16

2.7. Physical Structure downlink [ 4 ]. . . . . . . . . . . . . . . . . . . . . . . . . . . 16

2.8. Reception timing [ 4 ]. . . . . . . . . . . . . . . . . . . . . . . . . . . . 16

2.9. Message format LoRa [ 4 ]

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17

3.1. Comparison coverage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26

4.1. Evaluation Kit LoRa - 900 [ 5 ]

. . . . . . . . . . . . . . . . . . . . . . . . . 31

4.2. RF card and Gateway [ 6 ]. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31

4.3. Speck LoRa [ 7 ]

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32

4.4. 3 Raspberry Pi model B [ 8 ]

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33

4.5. Physical Device Layout. . . . . . . . . . . . . . . . . . . . . . . . . . . 33

Pablo Campos Avila

xiii

University of Cuenca 4.6. Environment 1 - Tomebamba River. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3. 4 4.7. Environment 1 - lifting scheme. . . . . . . . . . . . . . . . . . . . . . . . . 35 4.8. Basic 2 - Machángara River. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36 4.9. Environment 3 - Yanuncay River. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37 4.10. Atmosphere 3 - lifting scheme. . . . . . . . . . . . . . . . . . . . . . . . . 37 4.11. Packet capture. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
5.1. values RSSI obtained for different frequencies. . . . . . . . . . . . . . 46 5.2. Measurement of RSSI Ambiente 1 with DR0. . . . . . . . . . . . . . . . . . . . . . 48 5.3. Measurement of SNR Ambiente 1 with DR0. . . . . . . . . . . . . . . . . . . . . . 48 5.4. Correlation analysis RSSI with DR0 - Settings 1. . . . . . . . . . . . . . . fifty 5.5. Correlation analysis RSSI with DR3 - Atmosphere 1. . . . . . . . . . . . . . . fifty 5.6. Adjustment of PL Environment 1 with DR0 - Rio Tomebamba. . . . . . . . . . . . . 52 5.7. Adjustment of PL Environment 1 with DR3 - Rio Tomebamba. . . . . . . . . . . . . 53 5.8. Adjustment of PL Environment 1 with DR0, Shore 2 - Rio Tomebamba. . . . . . . . 54 5.9. Adjustment of PL Environment 1 with DR3, Shore 2 - Rio Tomebamba. . . . . . . . 54 5.10. Adjustment of PL Environment 2 DR0 - Machángara River. . . . . . . . . . . . . 55 5.11. Adjustment of PL Environment 2 DR3 - Machángara River. . . . . . . . . . . . . 56 5.12. Adjustment of PL of Atmosphere 3 with DR0 - Yanuncay River. . . . . . . . . . . . . . 56 5.13. Adjustment of PL of Atmosphere 3 with DR3 - Yanuncay River. . . . . . . . . . . . . . 57 5.14. Settings PL with DR0 - all environments. . . . . . . . . . . . . . . . . . . 58 5.15. Settings PL with DR3 - all environments. . . . . . . . . . . . . . . . . . . 59 5.16. Average trend packet loss with DR0 - Measuring 1. . . . . 60

Pablo Campos Avila

xiv

University of Cuenca 5.17. Average packet loss with DR0 - all environments. . . . . . . 61 5.18. Average packet loss with DR3 - all environments. . . . . . . 61
A.1. Scheme Setting up the kit LoRa [ 9 ]. . . . . . . . . . . . . . . . . . . . . . 69 A.2. Installing the development suite LoRa . . . . . . . . . . . . . . . . . . . . . 70 A.3. Docker virtualization in Windows. . . . . . . . . . . . . . . . . . . . . . . . 71 A.4. Port Forwarding rules. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 TO 5. Conguration static IP Ethernet network adapter. . . . . . . . . . . . 73 A.6. Docker terminal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74 A.7. Utilities Software LoRa Microchipped. . . . . . . . . . . . . . . . . . . . . . 75 A.8. Utilities Software LoRa microchip - Gateway. . . . . . . . . . . . . . . . 76 A.9. Conguration for Custom Auto-Created. . . . . . . . . . . . . . . . . . 77 A.10.Conexión with the MySQL server. . . . . . . . . . . . . . . . . . . . . . . . . . . 77 A.11.Habilitación eight channels in the RN module. . . . . . . . . . . . . . . . . . . . 78 Uplink A.12.Envio a message from the RN module. . . . . . . . . . . . . . . . . . 79 A.13.Cambio of Gateway Region. . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
C.1. Environmental RSSI measurement 1 with DR0 - Rio Tomebamba. . . . . . . . . . . 92 C.2. Environmental RSSI measurement 1 with DR3 - Rio Tomebamba. . . . . . . . . . . 93 C.3. Environmental RSSI measurement 1 2 DR0 shore - Rio Tomebamba. . . . . . 93 C.4. Environmental RSSI measurement 1 Shore 2 with DR3 - Rio Tomebamba. . . . . . 94 C.5. Environmental RSSI measurement 2 DR0 - Machángara River. . . . . . . . . . . 94 C.6. Environmental RSSI measurement 2 DR3 - Machángara River. . . . . . . . . . . 95 C.7. RSSI measurement Atmosphere 3 with DR0 - Yanuncay River. . . . . . . . . . . . 95

Pablo Campos Avila

xv

University of Cuenca C.8. RSSI measurement Atmosphere 3 with DR3 - Yanuncay River. . . . . . . . . . . . 96 C.9. Environmental measurement SNR 1 with DR0 - Rio Tomebamba. . . . . . . . . . . 97 Environmental SNR C.10.Medición 1 with DR3 - Rio Tomebamba. . . . . . . . . . . 97 C.11.Medición SNR Environment 1 2 DR0 shore - Rio Tomebamba. . . . . . 98 Environmental SNR C.12.Medición 1 Shore 2 with DR3 - Rio Tomebamba. . . . . . 98 Environmental SNR C.13.Medición 2 DR0 - Machángara River. . . . . . . . . . . 99 Environmental SNR C.14.Medición 2 DR3 - Machángara River. . . . . . . . . . . 99 Snr C.15.Medición Atmosphere 3 with DR0 - Yanuncay River. . . . . . . . . . . . 100 Snr C.16.Medición Atmosphere 3 with DR3 - Yanuncay River. . . . . . . . . . . . 100

Pablo Campos Avila

xvi

University of Cuenca

Table index

2.1. Field Description Message MAC . . . . . . . . . . . . . . . . . . . . . . 17

2.2. Addresses stored in the end device

. . . . . . . . . . . . . . . . . . 18

2.3. Data rate table ( DR ) [ 4 ]. . . . . . . . . . . . . . . . . . . . . . . . . . . 19

2.4. Transmission power table [ 4 ]

. . . . . . . . . . . . . . . . . . . . . . . . twenty

4.1. Permitted data rates. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39

5.1. Standard Deviation results with different number of packages. . . . . . 47 5.2. Power variation indices. . . . . . . . . . . . . . . . . . . . . . . . . . . 47 5.3. P values ​Dunn test. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 5.4. Values ​used to calculate the path loss. . . . . . . . . . 52 5.5. Compraración of propagation characteristics with DR0. . . . . . . . . . . . . 58 5.6. Comparison with DR3 propagation characteristics. . . . . . . . . . . . . 59

Pablo Campos Avila

xvii

University of Cuenca
Dedication
My mother Gloria. For the example of perseverance and perseverance that characterize, for their advice, values ​and motivation that has always given me, which allowed me to be a good person, but more than anything for his love. Pablo Avila

Pablo Campos Avila

xxii

University of Cuenca
Thanks
To my family. My uncles Olga, Lucy, Hugo, Fredy, Diana, my grandmother Carmela, my father Manuel and all those who always supported me, believed in me and who directly or indirectly participated in the preparation of this thesis. Thanks to you!
To my teachers. To all who set every stage of my university life but especially the engineers Fabian Andres Vazquez Astudillo and for their great support and encouragement for the development of this thesis. Pablo Avila

Pablo Campos Avila

xxiii

University of Cuenca
Acronyms and Abbreviations
BW Bandwidth. fifteen , 16 CR Coding Rate. fifteen DR Data Rate. 7 , fifteen , 16 , 2. 3 GPIO General Purpose Input / Output. 8 LoRa Long Range. 3 - 5 , 7 - 9 , 19 , 2. 3 LoRaWAN Long Range Wide Area Network. 3 - 5 , 7 , 10 , fifteen , 16 , 22 , 2. 3 , 27 LPWAN Low Power Wide Area Network. 3 PER Packet Error Rate. 4 , 7 , 19 , 28 RSSI Received Signal Strength Indicator. 4 , 5 , 7 , eleven , 14 - 19 , 22 , 28 , 33 , 38 SF Spreading Factor. fifteen , 16 , 2. 3 SNR Signal to Noise Ratio. 4 , 7 , 14 - 17 , 19 , 28 , 33 , 38 SPI Serial Peripheral Interface. 7 Wifi Wireless Fidelity. 3 WSN Wireless Sensor Network. 3 , 13

Pablo Campos Avila

xxiv

University of Cuenca
Chapter 1
Introduction
In this chapter, the problem appears to be treated, as well as the justification, scope and overall objectives and speci fi to meet during this investigation.

Pablo Campos Avila

two

University of Cuenca
1.1. Problem identification
It is estimated that by 2020, more than fifty trillion devices will be connected via wireless communications. [ 10 ] This is part of the approach do more with less who encounters obstacles in applying traditional networks such as cellular or technologies such as Wifi due to the requirements of scalability and enegía. Many of these devices will be part of wireless sensor networks ( WSN ), for its acronym in English. In fact, at present, WSN They cover a wide range of applications, one that has been developed is the most successful environmental monitoring. [ eleven ]
This is why emerging projects like Wireless application to flow prediction system technologies in Tomebamba river basin [ 12 ], Conducted by the Department of Electrical, Electronics and Telecommunications (DEET) for the benefit of the Program for Soil and Water Management (PROMAS). In this project, we intend to use a technology that is part of the WSN called LoRaWAN to connect nodes with sensors limnigrá fi cos one . For such projects using new technologies, it is necessary to have a first approach which will facilitate the implementation.
Along with the development of new technologies such as LoRaWAN , Also arise questions regarding the behavior of the same in speci fi c environments, as mentioned above. This behavior may depend on different factors that determine their effectiveness. These factors should be de fi ned in order to achieve the best benefit regarding the scope or reliability provided by this technology.
1.2. Justification
LoRaWAN It is part of the so-called wide area networks and low consumption ( LPWAN ) For its acronym in English, which represent a new trend in the evolution in telecommunications [ 14 ]. LoRaWAN uses the benefits of LoRa . LoRa is a radio technology owner often characterized by the use efficient energy with batteries that can last up to 10 years coverage with line of sight of more than 10 km in rural areas as well as rapid deployment of network nodes low cost [ 3 , fifteen ]. These nodes can collect and transmit real-time information such as temperature, rain, humidity and other variables
one Meters of water levels in rivers, lakes or any body of water, are used for flood forecasting (maximum heights of water), define or delineate areas at risk of flooding and to project structures (bridges or other waterworks) . [ 13 ]

Pablo Campos Avila

3

University of Cuenca weather [ 16 ] Conducive to making this technology in forest environments as proposed in the aforementioned project [ 12 ].
Speci fi cally, LoRaWAN , Is a medium access layer (MAC), created to use modulation LoRa in the best way and focus the internet of things (IoT) [ 4 ], for its acronym in English. The sensor information is transmitted to the Gateway, by jumping to then be sent to web servers, which can be processed to infinitude of applications. Among the benefits that adds LoRaWAN are addressing, security through encryption AES 128 bit, and MAC commands that make the development of a network LoRaWAN It is fast and accurate [ 4 , 17 , 18 ].
So far, there have been studies on performance, scalability, generally spread inside and outside [ two , 14 , 16 - 2. 3 ] But since LoRaWAN It is a still new technology, there are no reported studies evaluating transmission range in forest environments.

1.3. Scope
The contribution of this work focuses on developing a path loss model to facilitate the development of sensor network technology LoRaWAN . To achieve this, measurements Level Indicator will received signal ( RSSI ), For its acronym in English, using the Evaluation Kit LoRa 900, microcontrollers [26]. This kit allows the modification of different parameters such as the spreading factor (SF), bandwidth (BW) and transmit power, as established in the LoRaWAN [ 4 ], With which, they can be obtained different ranges, allowing to evaluate the transmission range.
sets of measurements shall be made on the bank of the river Tomebamba, where a node LoRa will act as a transmitter, and Gateway the kit as a receiver. The rate of packets received ( PER ), For its acronym in English, will act as overall quality parameter network. The transmissions will be receptadas by Gateway, which in turn transmit them to the server, the same will be keeping a record of the RSSI , SNR Y PER transmissions.
After obtaining the data, it is proposed to fit a curve of losses based on RSSI path, this will have an empirical model of losses for the required area [ 24 - 26 ], Thus fulfilling the main goal of this research.

Pablo Campos Avila

4

University of Cuenca
1.4. goals
1.4.1. Overall objective
Set a path loss model based on RSSI that allows for analytical models and simulations to facilitate the implementation of sensor network technology LoRaWAN on riverbanks with forest environments.
1.4.2. Speci fi c objectives
• An analysis of the state of the art, as well as the measurement methodology. • Con fi gure the development kit LoRa with LoRaWAN For sending and data capture. • Do two sets measurements where samples will be taken RSSI a fi xed and variable distances. • Set a suitable path loss model for the use of LoRa on riverbanks with forest environments.

Pablo Campos Avila

5

University of Cuenca
Episode 2
Theoretical framework
In this chapter, it is shown in detail the operation of LoRaWAN Starting from a general basis on which concepts of Wireless Sensor Networks explained to important aspects of operation and modulation LoRa and the manner in which it can use the RSSI to determine a propagation loss model.

Pablo Campos Avila

6

University of Cuenca
2.1. Introduction
It is estimated that by 2020, more than fifty trillion devices will be connected via wireless communications [ 10 ]. For this, the next generation of communication systems, called 5G is required. 5G must integrate natively services Internet of Things ( IoT ) Without degrading the quality of traditional services.
So far, the term IoT has been used for a variety of technologies generally try to connect to internet physical objects [ 3 ]. The main difference between the traditional Internet and the Internet of Things is that IoT devices are less available resources such as memory, processing power, bandwidth and energy [ 10 ].
This trend of doing more with less has encountered technological restrictions on current wireless networks that do not meet the energy requirements and scalability necessary. That is why they have emerged new protocols and technologies such as wide area networks and low power ( LPWAN ). This technology enables the development of wide area networks gateways and adapt parameters such as transmission rate, power, modulation, etc., so that the fi nal devices, called nodes and are sufficient in terms of energy expenditure [ 10 ].

2.2. Wireless Sensor Networks
Largely due to recent advances in wireless and digital electronic technologies, design and development of sensor nodes low-cost and low energy consumption, it has become feasible [ 27 ].
The properties of individual nodes located generally in different geographical points cos fi, present challenges to communication protocols in terms of energy consumption. It is for this reason that its main focus is on the energy ef fi ciency unlike traditional networks that focus on improving the performance of delay or amount of processed information.
The WSN They are defined as distributed sensors that monitor physical or environmental parameters and usually collaborate to carry this information to a central server or node [ 28 ].

Pablo Campos Avila

7

University of Cuenca
2.2.1. Main Technologies IoT
In this section, a brief review of related technologies is carried out IoT to provide a better perspective on LoRaWAN [ 10 ]:

IEEE 802.15.4 is a standard that defines the physical and link layers for Networks InalámPersonal factories Low Rate Transmission ( LR-WPAN ) [ 29 ]. Among its features is support unlicensed bands (868 MHz, Europe, 928 MHz, North America, 2.4 GHz, global). It provides data rates up to 250kbps and scope with line of sight ( THE ) Up to 1000 m. On IEEE 802.15.4 Zigbee can be used which is a technology that pro fi les communications and provides a network layer [ 30 ].
Bluetooth / YOU It was originally created to wirelessly replace cables dispositivos which typically are connected together, such as cell phones, laptop computers, audio devices, keyboards, etc. It offers low data rates of about 1 Mbps and short range with typical distances of 5-10 m with low energy consumption. After several revisions, in 2016 it introduced Bluetooth 5.0 [ 31 ]. This version is extremely focused on IoT . It is fully compatible with the previous version 4.2, increases bandwidth up to 2 Mbps, low power mode ( YOU ), For its acronym in English, with ranges of up to 240 m.
IEEE 802.11 ah It provides a standard LAN [ 32 ]. Compared to IEEE 802.11 operating at 2.4 GHz and 5 GHz, IEEE 802.11 ah supports higher transmission rates up to 1 km to a power of 200 mW default. This standard may operate with a bandwidth of 4 Mbps or 7.8. With the new modulation schemes and coding of
802.11 ac can reach transfer rates of hundreds of Mbps.
Sigfox It was the first technology LPWAN proprietary, consumer proposition. his cloak physical uses a modulation ultra narrowband ( ONE B ). Theoretically each Sigfox Gateway can support up to a million devices connected to a coverage area of ​30-50 km in rural and urban areas 3-10 km in [ 33 ]. Each node can send up to 140 messages per day, at a data rate of up to 100 bps.

Pablo Campos Avila

8

University of Cuenca
2.3. Wide area networks and low power ( LPWAN )
The ecosystem IoT is broad, containing devices with data rates ranging from a few bps to Mbps. The coverage also varies from a few centimeters to several kilometers. LPWAN is responsible for meeting these needs in new applications emerging daily [ 3. 4 ].
2.3.1. Main features of a network LPWAN
Although these networks should cover different needs, there are common requirements in designing a network LPWAN :
• Its operation should require minimal energy consumption. This given the limited capacity of current batteries and high cost.
• Cost is an important factor. Especially in the nodes must provide tools for easy installation and both hardware and software they should be limited.
• The level of activity depends on the application, however, the device must be able to wake up only when sending information. This point would support the idea of ​the type architectures crashes mesh architectures.
• The network infrastructure must be easy to assemble. Adding devices or transfer to other countries must meet some standard.
• The transfer of information between the object and the end user must be safe. • Although most applications, objects are not moving, so that the channel remains constant, the robustness of modulation is
a valuable feature.
2.4. Basics of modulation LoRa
LoRa is a proprietary modulation scheme derived from the spread spectrum modulation with chirps ( CSS ), Whose main objective is to improve the sensitivity at the expense of a reduction in the data rate for bandwidth ( BW ) dice. Implementing variable data rates using spreading factors ( SF ) Orthogonal, which allows a compromise between data rate and scope, and optimize network performance with constant bandwidth.

Pablo Campos Avila

9

University of Cuenca LoRa It is a physical layer implementation and does not depend on implementations in upper layers. This allows you to coexist with different network architectures. Here are some basic concepts are presented on the modulation LoRa and the advantages of developing a network LPWAN . [ one ]
2.4.1. Principles of Spread Spectrum
In information theory, the Shannon theorem - Hartley, defines the maximum rate at which information can be transmitted in a communication channel with a width of speci fi c band in noise.
This known equation, one can conclude that if the bandwidth is increased, can be compensated degradation SNR radio channel.
In systems Direct Sequence Spread Spectrum ( DSSS ), The phase of the transmitter carrier is changed according to a code sequence. This process is accomplished by multiplying the desired signal data with a spreading code, known as chip sequence. This chip sequence has a higher rate than the data signal so widens the bandwidth of the original signal. This is shown in Figure 2.1 .
Thus, a gain processing occurs and a reduction in the amount of interference. DSSS It is widely used in communication applications, however challenges arise when you need to reduce the cost and energy expenditure devices with this technology.

Figure 2.1: Process spreading [ one ]

Pablo Campos Avila

10

University of Cuenca
2.4.2. Spread spectrum LoRa
modulation LoRa Solves the problems of DSSS providing an alternative lower cost and lower energy consumption.
In modulating LoRa , The spectrum spread is achieved by generating a chirp signal that varies continuously in frequency, as shown in Figure 2.2 . An advantage of this method is that the timing and frequency variations between the transmitter and receiver are equivalent, reducing the complexity of the receiver. The bandwidth of this chirp is equivalent to the spectral bandwidth of the signal. The desired signal is enlarged with a chip and modulated on a chirp. The relationship between the desired rate of data, the symbol rate and chip rate for LoRa , Can be expressed as follows:

In equation 2.1 , Is defined bit rate modulation, R b

Where: Where:

R b = SF * C or digodetasa
two SF
BW

bits / sec

C or digodetasa = 4 4 + CR

• SF = spreading factor that can vary between 7 and 12 • CR = coding rate which varies between 1 and 4 • BW = Bandwidth (Hz)

(2.1) (2.2)

Figure 2.2: Excerpt from the spectrogram of a chirp ( SF = 8, BW = 125kHz) [ two ] Pablo Campos Avila

eleven

University of Cuenca
2.4.3. Transmission parameters
As already mentioned above, a device LoRa It can be fi gured for use with different Power Transmission ( TP ) Carrier frequency ( CF ) Spreading factor ( SF ), Bandwidth ( BW ) And rate Codification ( CR ) To get the best connection performance and lower energy consumption.
The combination of these variables results in about 6720 with possible configurations, allowing the user to fully adjust LoRa its implementation [ 35 ]. Next, a brief description of each of these parameters is [ 36 ]:
one. Potency of transmission ( TP ): ( TP ) in LoRa , It can be varied between -4 dBm and 20 dBm, but due to implementation limits, can be adjusted 2 dBm to 20 dBm. With higher power dBm 17 you can only use 1% duty cycle.
two. Carrier Frequency ( CF ): Is the center frequency can be varied in jumps 61 Hz between 137 MHz and 1020 MHz, depending on the chip and the region of use.
3. Spreading factor ( SF ): It is the ratio between the symbol rate and the rate of chips. higher SF not only increases the SNR The range and sensitivity, but also the airtime package. Each increase in the SF also halved transmission rate doubles the transmission duration and power consumption. The SF can vary between 6 and 12, being useful for the separation of networks as the SF They are orthogonal.
Four. Bandwidth ( BW ): It is the frequency range in the transmission band. A BW greater, it gives a higher data rate (slower air), but lower noise sensitivity aggregation. one child BW It requires more precise crystals, ie less parts per million (ppm). The data is sent at a rate equivalent to chips BW ; a BW 125 kHz equivalent to a chip rate of 125 kcps. A network LoRa typically operates at 125 kHz, 250 kHz or 500 kHz.
5. Codification rate ( CR ): CR is the rate of forward error correction ( FEC ) Used by LoRa against interference and can be con fi gured with: 4/5, 4/6, 4/7 and 4/8. A CR more offers more protection against noise, but increases the air time. Transmitters with different CR can communicate since the CR It is in a packet header that is always codi fi ed 4/8.
2.4.4. Key Properties Modulation LoRa
Here are some key issues that stand out are presented LoRa and make it the best candidate for applications IoT [ one ]:

Pablo Campos Avila

12

University of Cuenca
• Scalable bandwidth: It can be used in frequency hopping narrowband applications and broadband direct sequence.
• Low power consumption: The output power can be reduced compared to FSK maintaining the same or better link budget.
• High Robustness: Because asynchronous nature, the signal LoRa It is resistant to interfencias in and out of band.
• Fading resistant: Thanks to broadband chirp of pulses, LoRa It provides immunity to multipath fading and making it ideal for urban and suburban environments.
• Doppler resistant: The Doppler shift causes a small frequency shift in momentum LoRa introducing a insigni fi cant shift in the time axis of the baseband signal, making it immune to the Doppler effect.
• Wide Coverage Capacity: Compared to FSK While maintaining the same transmission power, the link budget is higher in LoRa .
• Improved network capacity: Semtech modulation LoRa employs SF orthogonal transmit multiple signals that allow propagation and at the same time on the same channel without significant degradation of the RX sensitivity. Modulated signals with different SF They appear as noise to the target receptor and may be treated as such.

2.5. MAC LoRa : LoRaWAN
LoRaWAN is a network protocol created by the Alliance LoRa one optimizing parameters LoRa for lower energy consumption fi nal devices (nodes).
The networks LoRaWAN are centralized networks typically use a star topology in which gateways passing packets between devices fi nal (nodes or motes) and a central network server. The gateways They connect to the network server via IP while the fi nal devices transmissions use a single jump LoRa or FSK . Although communication is bidirectional, the flow of information from the device to the end gateway It corresponds to traf fi c predominant [ 4 ]. In Figure 2.3 the architecture of a system is observed LoRaWAN .

one https://www.lora-alliance.org/

Pablo Campos Avila

13

University of Cuenca
Figure 2.3: Architecture LoRaWAN system [ 3 ] Communication between devices and the late gateways It uses different frequencies and channels, using the following rules:
• The end device changes channel pseudorandom in each transmission. • The end device compliant with the maximum duty cycle on the sub-band transmission and local regulations. • The end device complies with maximum transmission. A transmission LoRaWAN Uses layers seen in Figure 2.4 .

Figure 2.4: Architecture protocol LoRaWAN [ 3 ]

Pablo Campos Avila

14

University of Cuenca
2.5.1. classes LoRaWAN
LoRaWAN It defines three classes that were designed for different applications where a compromise between energy consumption and latency is made. All devices LoRaWAN They must implement at least Class A and be compatible with it. In Figure 2.5 The location of the classes is observed with respect to the layers of LoRa .

Figure 2.5: Classes LoRaWAN
• A class: The device fi nal class A, allow bidirectional communication because after each transmission Uplink ( the server node) there are two windows downlink ( server node). Class A operation is the one that produces less power consumption.
• Class B: The fi nal Class B devices allow more windows reception. In addition to the receive windows of Class A, Class B opens windows reception time extra fi xed. This is accomplished Beacons sent from the gateway to fi jar the time when the fi nal device must be in listening mode.
• Class C: Devices fi nal class C have almost continuous reception windows only close when it is transmitting. Class C devices consume more power to operate than Class A or Class B, but offer the lowest latency between the server and the end device.
Since all devices LoRaWAN must implement at least Class A and the device used in this work uses this class, the following protocol will be explained from this viewpoint.

Pablo Campos Avila

fifteen

University of Cuenca
2.5.2. Physical formats Messages - Class A
In LoRaWAN Messages are distinguished Uplink ( node server) downlink ( server node).
Messages Uplink These messages are sent by fi nal devices to one or more gateways, which forwards them to the server. These messages use explicit way in which a physical header is included LoRa ( PHDR ) Plus a header CRC ( PHDR CRC ). The integrity of the payload is protected by the CRC . These headers are added by the transceiver. The structure of a message Uplink, It is shown in Figure 2.6 .
Figure 2.6: Physical Structure Uplink [ 4 ] Messages downlink
Each message downlink is sent by the network server to one of the fi nal devices, being forwarded by one gateway. Figure 2.7 .
Figure 2.7: Physical Structure downlink [ 4 ] Receive Windows
As he mentioned above, after each transmission uplink, The end device opens two short windows reception. To define the beginning of the fi nal transmission is used as a reference. Figure 2.8 .

Figure 2.8: Timing of Reception [ 4 ]

Pablo Campos Avila

16

University of Cuenca
2.5.3. Message Formats MAC - A class
All messages Uplink Y downlink They carry a payload PHY beginning with a header MAC one byte (MHDR), followed by a payload MAC (MACPayload) and fi nalizando with a message integrity code of 4 bytes ( MIC ). The different parts of the message Class A, it is shown in Figure 2.9 .

Figure 2.9: Message Format LoRa [ 4 ]

In the table 2.1 The description of the different parts of the message is given:

Table 2.1: Field Description Message MAC Message field MAC LoRa Description

MHDR MAC payload MIC FHDR FPort FRMPayload Devaddr FCtrl FCNT FOpts

Header MAC , One octet in length The upper layer data Integrated Site code Message, four octets in length Frame header Optional port field optional payload field frame Device Address Byte frame control Frame counter, two octets in length Frame options to send commands MAC , 15 bytes

Pablo Campos Avila

17

University of Cuenca
2.5.4. Enabling End Devices
To be part of a network LoRa Each device must be activated. This activation can be done in two ways: Activation in the air ( OTAA ), When you want to add a new device or Activation Customization ( ABP ). [ 4 ]

Final data stored on the device
After activation, the following information in the final device is stored: a device address ( DevAddr ), An Application identifier ( AppEUI ), A session key network ( NwkSKey ) And a session key application ( AppSKey ). The description of these addresses are shown in Table 2.2 .

Table 2.2: addresses stored in the end device

Key

Description

DevAddr consists of 32 bits that identify the device on the network AppEUI It is a global identifier that identifies an entity capable of processing a request frame aggregation.

NwkSKey

It is used by the network server and the end device to calculate the MIC . It is used to encrypt and decrypt the payload of the payload field in messages MAC .

AppSKey is used to encrypt and decrypt the payload of the payload field data messages speci fi c application.

Activation in the air ( OTAA )
For this activation, the fi nal devices must follow an aggregation procedure before sending information to the network server. A OTAA requires the final device have the following information before aggregation procedure: A single er identified overall ( DevEUI ), The application identifier ( AppEUI ) And AES-128 key ( AppKey ).

• End identifier device ( DevEUI ): An overall cation identified in IEEE EUI-64 address space that uniquely identifies the device so.
• Key Application ( AppKey ): AES-128 is a unique device key. When the device performs a final OTAA , Used the AppKey to generate the NwkSKey Y AppSKey speci fi c device that are used to encrypt and verify the network communication.

Pablo Campos Avila

18

University of Cuenca

Table 2.3: Table of data rates ( DR ) [ 4 ] Data Rate ( DR ) With setup bit rate physical (bit / sec)

0 one two 3 4 5: 7 8 9 10 eleven 12 13
14:15

SF10 / 125kHz SF9 / 125kHz SF8 / 125kHz SF7 / 125kHz SF8 / 500 kHz RFU SF12 / 500 kHz SF11 / 500 kHz SF10 / 500 kHz SF9 / 500 kHz SF8 / 500 kHz SF7 / 500 kHz RFU

980 1760 3125 5470 12500
980 1760 3900 7000 12500 21900

The procedure followed devices consists of a request message aggregation or activation which includes AppEUI Y DevEUI . The network server responds with an acceptance message aggregation containing a device address fi nal ( DevAddr ) And a field AppNonce which is used by the device to calculate the
NwkSKey Y AppSKey .
Customizing activation ( ABP ) Under certain circumstances, the fi nal devices can be activated or added to the network by customization. This procedure adds the device directly to the network without the need to request messages and acceptance of the network used in the ABP .
This activation requires the keys DevAddr and the two session keys NwkSKey Y AppSKey You are already stored in the final device. Each device must have NwkSKey Y AppSKey unique, not to compromise the safety of other communication devices. These keys must be created in such a way that can not be calculated from public information.

2.5.5. Data Rate ( DR ) And Power Transmission
LoRaWAN complies with the regulations established by the FCC which imposes a maximum transmission time 400 more in Uplink in US 902-928 MHz band. Table 2.3 present the DR allowed with their respective configurations.

Pablo Campos Avila

19

University of Cuenca The transmission powers meanwhile, speci fi ed in Table 2.4 .

Table 2.4: Transmission power table [ 4 ]

txpower

Conguration

0 one two 3: 9 10
11:15

30 dBm - 2 * txpower 28 dBm 26 dBm ... 10dBm RFU

2.6. Path loss model
Power indicator signal RSSI , Measures the intensity of the signal reaching the receiver dBm. This parameter signal, has been widely used to measure the quality of the spread in different environments and with different technologies [ twenty , 22 , 24 , 37 ]. It is used for positioning and tracking mobile nodes as evidenced in [ 38 - 40 ]. In any case, it takes into account the values ​of RSSI fl uctuate due to changes in the environment that affect propagation.

Loss Model
For the results of a study are useful, usually a path loss model is generated. These models reflect the reduced power signal as it propagates through space and commonly expressed logarithmically, as shown in Equation 2.3 [ 24 ].

P L ( dB) = P 0 ( dBm) + twenty log (d

d 0) + X θ

where d Y d 0 are the transmission distance and the reference distance, while P 0 It is the power level d 0. X θ is a random variable with normal distribution with standard deviation θ

(2.3)

The other way commonly used to express the propagation introduced by Weissberger forest environments and amended in ITU-R models and COST235 exponentially fading is observed in Equation 2.4 [ 41 ].

Pablo Campos Avila

twenty

University of Cuenca

L (dB) = A * F B d C where F is the frequency, d distance; A, B Y C They are adjusted based on the measured data.

(2.4)

In works like [ fifteen ] Y [ 24 ], Combined and simplified ca models in Equation 2.5 .

P L ( dB) = a + b * log (d) + X θ

(2.5)

In which to Y b are adjusted by the measured data, while X θ It represents the stochastic characteristic of the signal due to multipath fading and noise. In this way, the exponential distance factor is expressed by b, while other factors ( 2.3 ) Y ( 2.4 ) They are included in to.

The randomness of the received signal is calculated from the measured data. It assumes a normal distribution with mean zero and standard distribution θ.

Path loss calculation with RSSI and SNR

To calculate the path loss to be adjusted to the logarithmic curve described by Equation 2.5 , Equation is used 2.6 , Taken from [ fifteen ].

P L = | RSSI | + SNR + P tx + G rx Where SNR is the signal to noise radio, PTX is the power radiated by the transmitter and GRX It is the gain of the receiving antenna.

(2.6)

2.7. conclusions
LoRa It is presented as a technological solution that will help and be part of 5G. There are several technologies with features LPWAN that can address some of the needs of these developments, however, were not designed to meet this specific purpose co.
As for the physical layer, is presented as a spread spectrum modulation that allows the modification of key parameters such as spreading factor, bandwidth, transmit power and coding rate, allowing the user to focus LoRa their specific needs. Doppler resistance, low energy consumption and large coverage ranges exceeding 10 km in rural areas, make it reliable for wireless sensor networks WSN .

Pablo Campos Avila

twenty-one

University of Cuenca
On the other hand, LoRaWAN It is a network protocol that uses LoRa With a focus IoT . Although many of the variables of LoRa they are suppressed in LoRaWAN , You try to give the user options through classes and security is provided using different encryption keys that allow information.
RSSI It is presented as an indicator of energy received which together with the SNR They can be used to generate models path loss. These models are used to characterize a specific technology in a co fi environment so it is important to define the type of model fit.

Pablo Campos Avila

22

University of Cuenca
Chapter 3
State of the Art LoRa Y LoRaWAN
This chapter presents an overview of the main developments in the physical layer LoRa , MAC LoRaWAN and studies analyzing generally to networks LoRa .

Pablo Campos Avila

2. 3

University of Cuenca
3.1. Introduction
As shown in the previous chapter, the advantages of this technology allow its use not only with the approach of the Internet of Things as proposed LoRaWAN but other approaches that have been developed since it was introduced LoRa .
Here are some of these approaches will be shown and a comparison to show the state of the art LoRa .
3.2. Physical Layer - LoRa
As already discussed in the previous chapter, the physical layer LoRa It owns and was developed by Semtech so different implemententaciones use Semtech chips. Proprietary protocols generally do not extend the same manner as free so work has been done [ two ] Analyzing and implementing a blind analysis ( Blind Analysis) different parts of the physical layer LoRa . Among the parts analyzed are demodulation, preamble detection, and frame start header. Another key part is the decoding fi cation which presents the gray indexing, whitening, interleaving and FEC. The foregoing is implemented in gr-LoRa, which is free, improving development LoRa .
Another key points in the physical layer LoRa is the scope. This has been tested in several works both indoors and outdoors. In [ fifteen ], Coverage is studied in two areas: in the city of Oulu, Finland and at sea. To evaluate the coverage, packet loss rate is estimated. a transmit power of 14 dBm is used, spreading factor ( SF ) Of 12 and Bandwidth ( BW ) 125kHz. problems with packet forwarding rate and transmit power due to the country's telecommunications regulations are presented. The authors were able to distances of 15km on land and 30km on sea with losses of up to 38% of shipments.
Other work has propagation measurements outdoors is [ twenty ]. Its main feature is that it considers the Fresnel area, focusing on free-space propagation. The measurement area is divided into short and long range. The short range covers distances up to 6km. Two tests were performed with different values ​of SF , BW , CR and payload. The measurement parameters are the packet error rate ( PER ), Indicator level of the received signal ( RSSI ) And the signal to noise ratio ( SNR ). The authors achieved a maximum distance of 6.66 km with PER <7.3% with the configuration of test 1 ( SF = 10, BW = 250 kHz, CR = 6.4, DR = 1626.6 bps).

Pablo Campos Avila

24

University of Cuenca
In [ 22 ], Tested the indoor coverage LoRa in a building of reinforced concrete in the city of Prague. Two experiments one receiver in the basement and one with the receiver on the roof of the building are made. It uses RSSI gra fi ed for the heat map of the building. The devices used are not able to cover the whole edifice; however, best results are achieved with the receiver on the roof, covering almost the entire building.
Other interior work is presented in [ 19 ]. The purpose of it is to check the reliability of the system in health-related cases. a node LoRa on the arm of a person sends packets every 13 seconds. The transmission parameters are chosen to achieve the greatest reach. SF = 12 and BW = 125kHz, data rate = 293bps, Ptx = 14 dBm, f = 868 MHz. They are sent 300-1800 packages in different places. The radius of good packets was 96.7%, so it is concluded that it is a reliable technology for this application.
LoRa it presents itself as a technology-oriented sensor networks so in works like [ 18 ] Proves its reliability in this application. The reliability is tested making packages are shipped over long periods of time and with conditions SF and channel random. It is concluded that this technology can be reliable for applications with remote sensing inexpensive; however, topography and density of the edi fi cations plays an important role in signal propagation.
In the following research, a clear trend is shown with respect to the combination of LoRa with other technologies that take advantage of features like better reach, bandwidth or ease of implementation thereof.
In the case of [ 42 ], The WiFi technology is combined with LoRa . WiFi stands out for its higher bandwidth and range on the other hand LoRa It offers low power consumption and even greater reach. In [ twenty-one ], In addition to these two technologies, used Bluetooth low energy (BLE) and through an algorithm that is controlled by an agent, deciding which technology to use is taken. The decision is based on maximizing the effective rate and minimize energy expenditure. In both cases an improvement is especially levels RSSI .
In summary, as for the comparable parameters between the above work, the frequency is one of the main variables that define the scope of a wireless communications system. For the articles described, all use 868MHz except for [ 22 ] Using 2.4 GHz. Another important variable is the transmission power. As is known, this is seen genralmente restricted by the regulations of each country, so that [ fifteen ] Y [ 19 ] 14dBm is used. The gain value depends on the chosen antenna and varies from 2 to 4.5dBi in [ fifteen ] And has a maximum 8dBi in [ 42 ]. The bit rate ( BR ) Depends on the value of SF It is having a value of 12 in the case of [ fifteen ], [ 22 ] Y [ 19 ], On the other hand 10 [ twenty ]. Higher values ​are given for longer ranges but should take into account that decreases BR and Bandwidth ( BW ). With respect to BW They are given values ​at 125KHz [ fifteen ], [ 22 ] Y [ 19 ]; a value of 25KHz in

Pablo Campos Avila

25

University of Cuenca
[ twenty ]. The coding rate is another factor that defines the BR However in most studies the value used is not given, except [ 22 ] In the CR It is 4/6.
As expected, the range depends on a variety of parameters in addition to the type of application. The greater range is achieved [ 42 ] With 20km, in [ fifteen ] 15km, then 7.482km in [ 22 ], 420m in [ 19 ]. Figure 3.1

Figure 3.1: Comparison hedge
It should be noted that in most of the papers, tests were performed with different values BR , BW Y SF , So as de fi ned above it belongs to the greatest achievements made by each study.

3.3. Cap MAC
As already he mentioned in the previous chapter, the layer MAC of LoRa , Is de fi ned by different implementations. The most widespread is LoRaWAN . LoRaWAN It was developed by LoRa Alliance [ 4 ] And its features, defines three different types of devices that take advantage of the best capabilities LoRa . This protocol is oriented towards the Internet of Things (IoT) and divides the network into four parts. Where fi nal devices are sensors, gateways that route traf fi c, network servers and application servers that process and respond to requests respectively. [ 4 ]
In general, different implementations of the layer MAC on LoRa , Focus on longer ranges or implement different forms of architecture. In the case of [ 36 ], Presents itself

Pablo Campos Avila

26

University of Cuenca
performance analysis and capacity Semtech SX1272 transceiver. For this, the protocol is implemented MAC LoRaBlink that allows data collection with multihop. It is concluded that the spokes LoRa They multihop be used and, despite the increased complexity, maintains the efficiency of energy use.
Other related work layer MAC It is done in [ 43 ]. FABIAN LoRa is presented as a protocol stack that can be used on any physical layer. It is focused on the simplification of access, using common Internet protocols such as DNS Y HTTP . Its main advantage over LoRaWAN is your interoperablidad Internet. As in previous works, performance is measured using the PER , RSSI Y SNR . It is concluded that the location and elevation of the antenna play a fundamental role in the performance and the RSSI by itself, is not a good gauge as measurements do not show a strong correlation.

3.4. System Analysis
being LoRa a relatively new technology, some studies have focused on evaluating their characteristics more generally.
In the case of [ 14 ], Measuring the performance of a single node is made LoRa using the effective rate of Uplink and time data transmission. For various scenarios, the maximum number of nodes that can be served by a GW is analyzed. It is shown that the ability to uplink, It depends on the distance to the base (BS) station and does not exceed 2 kbps. In conclusion, the authors determined that a single BS LoRa can theoretically serve millions of devices, however, most of these should be at a mean distance from the BS. LoRaWAN It has great coverage, and scalability with little traf fi c, however, has low reliability, delays, and poor performance in traf fi c downlink. LoRa should be used, therefore, devices with little traf fi c strict existing latency or reliability, for example, environmental monitoring not critical.
Another job that a general analysis is presented in [ 17 ]. In this article, a framework for modeling performance of a network is provided LoRa with GW. peculiarities include LoRa as the modulation technique, regulatory limitations and using ALOHA. It is determined that the coverage probability decays exponentially with increasing nodes due to signal interference using the same spreading sequence. The theoretical mathematical analysis in this work was verified by simulations ed. Analyzing the simulation results, it was found that the increase of nodes, causes interference leading to a performance problem and lack of scalability.

As can be seen, there are common results across studies showing LoRa

Pablo Campos Avila

27

University of Cuenca as a useful technology for certain applications such as sensor networks that do not require high reliability and scalability.
3.5. conclusions
The work carried out so far show that technology LoRa It does not have a scenario of operation de fi ned by what research has focused on trying different approaches with the aim of defining the ideal work area.
The physical layer LoRa It offers advantages related to the scope, energy consumption and simplicity. These advantages are fl ected re in different work in which highlights the variables measuring the quality of used link: PER , RSSI Y SNR . Another aspect here is that there is no consensus on the number of packets to send and some of the transmission characteristics, are not presented, complicating the replicability of some of the studies. Perhaps the most important aspect to reflect the scope achieved. The longest range is achieved in [6] with 20km and unhindered. It is important to emphasize at this point that most studies use 868MHz and 915MHz which no presents an opportunity for further research.
Work related to the layer MAC , Focus on overall system performance, looking for the best way to use features LoRa . In this paper three main approaches are reviewed layer MAC : LoRaWAN , LoRaBlink and LoRa FABIAN. Each of these layers MAC It has different approaches. LoRaWAN intended use LoRa Internet of things architecture of a jump. On the other hand, LoRaBlink allows multihop, keeping the energy ef fi ciency. Finally, LoRa better suited FABIAN LoRa Internet protocols for easy use.
Finally, there are studies evaluating LoRa from a higher plane. One of the aspects evaluated is the scalability which have performed simulations and field tests in which it is concluded that the reliability of LoRaWAN It is low and should be used in non-critical applications. On the other hand, the overall performance is also evaluated LoRa where coverage is an essential aspect that decays exponentially with increasing nodes.

Pablo Campos Avila

28

University of Cuenca
Chapter 4
Methodology
This chapter methodology is technically showing the characteristics of the devices used, the physical arrangement of the same, the chosen environment and methodology used for measurements and subsequent analysis.

Pablo Campos Avila

29

University of Cuenca
4.1. Introduction
One of the pillars of research is certainly replicability. Replicability is based on a study should produce the same results if repeated exactly. To achieve this, it is important that the methodology be clear to the reader, it is why in this chapter technical aspects of the devices used and the parameters used for setup are dealt with.
Another important point to make a field study is to describe the environment in depth to determine all the variables that could affect data collection. A fundamental part of the methodology is the description of the measurement procedure, which explains how the variables were measured as the RSSI , SNR or PER . Finally, the statistical analysis performed in the following chapter explains and what is their influence on the study.
4.2. Equipment description
At this point, the equipment used are described for measurements RSSI , SNR Y PER . First, a brief description Evaluation Kit LoRa in the section 4.2.1 Then in the section 4.2.2 , Talking about the Raspberry Pi, which controls the transmitter (mota or node), and finally, in section 4.2.3 The arrangement of equipment used in the tests is presented.
4.2.1. Evaluation Kit LoRa - 900
The Evaluation Kit LoRa It provides several tools for testing parameters such as range and data rates ( DR ) of LoRaWAN . The kit consists of a Gateway and two specks or nodes with the RN2903 module. In Figure 4.1 the above components are observed. Then they are described the main features of the devices:
Gateway LoRaWAN RF card The gateway LoRa is a demonstrative plate made for use with modules using the RN Microchip transceivers at 915 MHz. It provides the communication with the application server in the network LoRa . The packages Uplink They are captured and retransmitted via the TCP / IP protocol according to the specification of LoRaWAN . Figure A.8 . Radio card capture all packets Uplink Semtech SX1257 using two transceivers and sent to the baseband processor SX1301 band which in turn sends them to the card Gateway via Serial Peripheral Interface ( SPI ). The card Gateway receives

Pablo Campos Avila

30

University of Cuenca

Figure 4.1: Assessment Kit LoRa - 900 [ 5 ]
information captured by the network card. Using the PIC-24 with the device coder (ENC624J600), the gateway converts packets into TCP / IP and sends it to the Ethernet port.
Speck LoRa RN2903 The weed LoRa It is a demonstrative card that provides a first approach to technology LoRa . Figure 4.3 . Provides access to the module LoRa through a USB to UART bridge supports connections via ports GPIO . USB access provided by PIC 18 is part of the plate and allowing the management module LoRa with ASCII commands. One can also modify the PIC information using connectors

Figure 4.2: RF card and Gateway [ 6 ]

Pablo Campos Avila

31

University of Cuenca

Figure 4.3: Mota LoRa [ 7 ] available on the card. Two modes are supported: USB Y drums. When the card is connected to a computer via USB, it operates in USB mode. As it mentioned above the PIC18LF45K50 functions as a USB-UART bridge so that you can send commands directly to the module.
When not connected via USB but powered by AAA batteries, the card goes into battery mode. In this mode the PIC18LF45K50 can run custom functions by sending ASCII commands directly to the module.
4.2.2. Raspberry Pi 3 Model B
Raspberry Pi is a microcomputer linux inexpensive ($ 20- $ 35) the size of a credit card. It was developed by the Raspberry Pi Foundation, this foundation is focused on promotion of computer science and make learning easy [ 8 ]. In this case, it was used for sending packets via the USB mode speck described in the previous section. Figure 4.4 .
4.2.3. Disposal
The device arrangement shown in Figure 4.5 . The node or mota LoRa It is controlled via the USB interface for the Raspberry Pi, which sends ASCII packages. On the receiver side, the packets are received by the Gateway and reenviandos using TCP / IP to the server that captures and saves them in its database.

Pablo Campos Avila

32

University of Cuenca

Figure 4.4: 3 Raspberry Pi model B [ 8 ]

Figure 4.5: Physical Device Layout
4.3. Device conguration
As devices evaluation kit LoRaWAN , Some functions such as sending data or server were already implemented, however it was necessary the configuration and modification, if the node to adjust the transmission parameters to the chosen and described methodology in Section 4.5 . In Appendix A, detailed the configuration of the devices described.

4.4. Description of the Environment
The objective of the research is to evaluate the transmission range LoRaWAN and its propagation characteristics in forest environments on the banks of rivers, using different measurements. For these measurements, it took into account the environment posed in the draft wireless application to flow prediction system technologies in Tomebamba river basin [ 12 ]. Since it is required to give general research, three main areas were chosen: urban, semi-urban and rural city of Cuenca, Ecuador. In which

Pablo Campos Avila

33

University of Cuenca

Figure 4.6: Environment 1 - Rio Tomebamba
there sought different forest density and different vegetation. For work-related measurements RSSI , It is known that they are usually performed in sections where there is a straight line between the transmitter and receiver, so treated that belong to selected environments straight sections [ 24 , 41 ].
As to climatic factors, measurements were taken on the day, morning and evening. The average temperature is a parameter difficult to estimate since it is highly variant in this region, however, generally it varies between 10 and 19 degrees Celsius. No precipitation nor fog occurred during the measurements. Next, they are described in detail each of the environments tested.

4.4.1. Environment 1: Urban - Rio Tomebamba
The Tomebamba River is one of the main tributaries to the city of Cuenca. It was chosen as environment conducive as it crosses the city of Cuenca near its urban area. The figure 4.6 shows the section chosen. This section was chosen because no greater curvature and its proximity to the University of Cuenca.
Vegetation

Pablo Campos Avila

3. 4

University of Cuenca

Figure 4.7: Environment 1 - Lifting Scheme
As for the vegetation, various species of trees with heights of between 2 and 4 meters, planted with a distance of between 3 to 5 meters are observed. Topography The topography is one of the most important factors in measuring propagation fl ows as directly in the power received at the Gateway. In Figure 4.7 The pro fi elevation shown.
Others Measurement following the guidelines outlined in [ 12 ], Shipments were made at a height of 2 meters above ground level and as close to the edge that is where most vegetation is concentrated. It should be noted that in certain sections of the measurement by obstacles such as bridges, the transmitter was at a higher altitude, which in fl uence the results shown in chapter 5. As this is an exploratory study, it was decided measured in the two banks of the river, which has a variable width of between 10 and 18 meters, with the aim of defining the difference that can exist between the two sides of the same river. Therefore, in the following chapters two related to ambiente 1 measurements will be presented.

4.4.2. Environment 2: semi-urban - Rio Machángara
The second chosen environment is another effluent to the city of Cuenca. This river originates north of El Cajas National Park. This environment was chosen because it is on the edge of the urban perimeter of the city. There are no large buildings near it and presents characteristics of semi-urban environment. More precisely, the section of the Patamarca sector was chosen, in front of the citadel of doctors. The figure 4.8 It shows the measured portion having the following features:
Vegetation In the case of Machángara river, density of vegetation present, was remarkably

Pablo Campos Avila

35

University of Cuenca

Figure 4.8: Atmosphere 2 - Machángara River
less. shrubs up to three meters high and lots of eucalyptus trees up to seven meters high, with spacings between three and seven meters between them: two kinds of vegetation were mainly observed. Topography The topography of the site chosen does not have steep slopes, so it can be considered flat. Others Just as in the room 1 should be considered in the analysis results in some points, because of the measurement methodology to be described in Section 4.5 Some shipments are in unfavorable areas in terms of the height of the transmitter or nearby vegetation.
4.4.3. Environment 3: Rural - Rio Yanuncay
The WSN , As reviewed in the second chapter, they can be deployed in variety of environments. It is for this reason that the third environment complements the above, having a free rural scene of edi fi cations. Speci fi cally, the measurements were performed in the population of Barabón. In Figure 4.9 the measurement distance having the following characteristics is presented:

Pablo Campos Avila

36

