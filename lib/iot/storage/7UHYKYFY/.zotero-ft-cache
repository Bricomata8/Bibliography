LoRaWAN Analysis under Unsaturated Trafﬁc, Orthogonal and non-Orthogonal Spreading Factor
Conditions
Ine`s El Korbi∗, Yacine Ghamri-Doudane † and Leila Azouz Saidane∗ ∗ National School of Computer Science, CRISTAL Lab, University of Manouba, 2010 Tunisia † L3i Lab, University of La Rochelle, Av. Michel Cre´peau, 17042, La Rochelle CEDEX 1, France
ines.korbi@ensi.rnu.tn, yacine.ghamri@univ-lr.fr, leila.saidane@ensi-uma.tn

Abstract—LoRaWAN is the new transmission protocol for Low-Power Wide Areas (LPWA) networks. In addition to long range communications, one of the most solid arguments in favour of the LoRaWAN technology is its ability to operate at orthogonal spreading factors (SFs). This enables simultaneous transmissions at different data rates on the same frequency channel. But Recently, it has been shown that transmissions at different SFs are not perfectly orthogonal which generates crossSF interferences (i.e. interferences between different spreading factors’ transmissions). Therefore, we propose here an analytical model of a single cell LoRaWAN under unsaturated trafﬁc, duty cycle and multi-channel deployment conditions. The model considers both perfect and imperfect SF orthogonality scenarios. The network performance are then derived in terms of achievable throughput at the gateway as a function of the offered load, the number of received packets per device and the percentage of successful transmissions. All the Results show that if spreading factors are assumed to be orthogonal, the capture effect improves the network performance in comparison with the theoretical pure Aloha access scheme. Whereas, the consideration of imperfect SF orthogonality revises the LoRaWAN performance downward.
I. INTRODUCTION
In the past few years Low-Power Wide-Area (LPWA) networks were proposed as a potential communication technology for the IoT trafﬁc transportation from sensors/objects to the appropriate gateways. In the opposite to multi-hop communications where the forwarding process is complex and requires high energy consumption, with LPWA, nodes can directly reach the wired infrastructure at a very low transmission power. In this context, LoRaWAN [1], a new LPWA wireless communication protocol has raised much interest given its deployment ease and its open aspects (open speciﬁcations and operation in unlicensed ISM bands). LoRaWAN is based on the LoRa modulation [2] largely inspired from the CSS (Chirp Spread Spectrum) modulation. The chirp spreading mechanism allows high resistance to interferences, thus a good signal reception miles away from the emitters. Despite the efﬁciency of the LoRa modulation, LoRaWAN operates in very narrow ISM bands (EU 863-870 M Hz, US 902-928 M Hz). To increase its throughput LoRa adopts the spreading factors’ mechanism. With spreading factors, several signals can be sent on the same frequency band at different data rates. Thus, as
978-1-5386-7659-2/18/$31.00 c 2018 IEEE

spreading factors increase, the receiver’s sensitivity (its ability to pick up the required level of radio signals) increases too at the expense of bit rates’ decrease. Theoretically, transmissions at different spreading factors are perfectly orthogonal and can be simultaneously decoded by the gateway. But very recent studies have shown that in reality, spreading factors are not perfectly orthogonal [3], [4], [5]. Hence, a correct signal reception at a given spreading factor is conditioned by the absence of all cross SF-interferences (i.e. interferences between transmissions at different spreading factors). Works that tackled the imperfect SF orthogonality in LoRaWAN either analytically evaluated LoRaWAN saturation throughput while considering a rough estimation of cross-SF interferences [5], or conducted real experiments to illustrate the imperfect SF orthogonality phenomenon [3], [4]. Other works, evaluated the LoRaWAN scalability through simulations while considering real cross-SF interference thresholds [6], [7].
In the hereby paper, we propose a new LoRaWAN analysis that aims to compare the network performance when either orthogonal or non-orthogonal spreading factors’ deployment scenarios are considered. The analysis will be conducted under unsaturated trafﬁc, duty cycle and multi-channel conditions. The performance results will be derived in terms of achievable gateway throughput as a function of the offered load per end device, the number of received packets per device and the percentage of successful transmissions. The rest of the paper will be organized as follows. In the next section, we review the LoRa and LoRaWAN fundamental concepts. Then, we discuss the works related to the performance evaluation of LoRa networks either analytically, through simulations or testbeds. In Section III, we present the system model we adopt at the physical and the network layers. In Section IV, we derive the LoRaWAN analysis in both orthogonal and non-orthogonal SF conditions. Section V will be dedicated to the discussion of the LoRaWAN performance results. Finally, we conclude the paper and present future directions in Section VI.
II. BACKGROUND AND RELATED WORK
A. LoRa and LoRaWAN overview
Today LoRaWAN [1] stands as one of the most powerful LPWA solutions dedicated to IoT communications. Its owes

its notoriety to many factors: free standard (open LoRaWAN

speciﬁcations), free access on the ISM bands, certiﬁed hard-

ware, etc. In the following we present the main LoRaWAN

aspects at the physical and the network layers as speciﬁed by the LoRa Alliance1.

1) The LoRaWAN physical layer: LoRaWAN uses the

LoRa modulation [2] at the physical layer which is a variation

of the Chirp Spread Spectrum (CSS) modulation. CSS consists

in generating chirp signals that continuously vary (continu-

ously increasing or continuously decreasing) in frequencies.

Each chirp/symbol will be in charge of transmitting a ﬁxed

number of bits. The number of bits per symbol is called

Spreading factor (SF). In LoRa, SFs vary from 7 to 12. For in-

stance, as spreading factors increase, the receiver’s sensitivity

increases too and henceforth does the communication range.

In the opposite, data bit rates drop down and transmission

durations, referred as Times on Air (T oA) become longer.

The relationship between spreading factors (SFs), date rates

(Rb) and modulation bandwidth (BW ) is given by:

BW

Rb= SF ∗ 2SF

(1)

LoRa transceivers can operate in bandwidth ranges from

137 M Hz to 1020 M Hz. They are, however, often deployed

in the ISM bands 868 M Hz for Europe and 915 M Hz for

USA. In the European region, for instance, LoRa Alliance

states that each end device must implement the three default

channels: 868.10, 868.30 and 868.50 M Hz, each of 125 kHz

bandwidth. On each channel, data rates from DR0 to DR5 must be implemented (cf. Table I). Moreover, according to the ETSI2 regulations in Europe, the maximum output power

on each device is +14 dBm and the duty-cycle limit is set

to 1% for the three mandatory channels. LoRa modems also

provide, through Coding Rates (CRs), a FEC mechanism to

enhance protection against bit corruption. Coding Rates vary

from 4/5 to 4/8 (respectively denoted as CR = 1 to CR = 4).

TABLE I DATA RATES AND RELATED CONFIGURATION (EU. 863-870 MHZ)

DRi SF Sensitivity BR (bits/s) SNR (dB)

0 12 -137

250

-7.5

1 11 -134.5

440

-10

2 10 -132

980

-12.5

39

-129

1760

-15

48

-126

3125

-17.5

57

-123

5470

-20

2) The LoRaWAN network layer: LoRaWAN is the communication protocol deﬁned by the LoRa Alliance on the top of the LoRa physical layer. LoRaWAN is a star based topology where thousands of objects (sensors or actuators) can directly send their data to a gateway using LoRa modulation. This
1A Consortium of telecommunications operators, electronic companies and research institutions that adopted the LoRaWAN technology https://loraalliance.org/
2The European Telecommunications Standards Institute

latter will be in charge of forwarding, through backhaul, the collected data to a network server for processing (c.f. Figure 1).
At the MAC layer, LoRaWAN deﬁnes three bi-directional operation classes. The class A, known as the basic service class, is supported by all devices that decide themselves when to transmit using a pure Aloha protocol. After sending message to the gateway (uplink), a device opens two receive windows, one for the acknowledgments and the other for the downlink trafﬁc. With class B, additional downlink trafﬁc is enabled to allow gateways sending beacon frames at regular intervals. In class C, devices can continuously receive frames, except when transmitting. At the MAC layer, LoRaWAN deﬁnes six type of messages that aim to join the LoRa network, send/receive unconﬁrmed data or send/receive conﬁrmed data. To ensure the communication security, LoRaWAN provides end-to-end encryption and data integrity.
Figure 1. LoRaWAN Architecture (Semtech picture courtesy)
B. Related work Early works on LoRa/LoRaWAN were interested in eval-
uating the impact of the LoRa physical parameters (SF, CR, bandwidth, etc.) on the network performance through measurement campaigns, real experiments and testbeds [8], [9], [10]. Thereafter, several works tackled more global issues in LoRaWAN such as scalability [11], the network capacity in terms of the number of supported end devices [12], the energy consumption [13] or the delay analysis [14]. One of the most interesting studies in this context is [15] that derives the class A LoRaWAN throughput with pure Aloha access scheme. The authors in [15] proposed a model that captures major LoRaWAN aspects such as duty cycle, multi-channel access or the time on air. The results showed that the network performance mainly depend on the monitored application trafﬁc characteristics. However, the model in [15] only considers the LoRaWAN characteristics at both medium access and network layers. Whereas, the physical layer properties were completely ignored (interferences between signals transmitted at the same or different SFs). For instance, in LoRaWAN speciﬁcation [1] and early works [8], [11], [12], it was considered that data transmissions on each spreading factor are orthogonal which allows the gateway to correctly decode trafﬁc coming from different nodes on the same frequency band.
But very recent results [16], [3], [5] have shown through real experiments and numerical analysis of the LoRa modulation

that a signal transmitted by an end device to the gateway may suffer two kinds of disruption leading to its premature outage. This disruption can be either caused by co-SF interferences (i.e. interferences coming from transmissions using the same spreading factor) or cross-SF interferences (i.e. interferences coming from transmissions using different spreading factors). Thus, to be correctly decoded, a packet sent at a given SF should respect Signal-to Interference-plus-Noise-Ratio (SINR) margins (in db units) with all other spreading factors as illustrated in Table II [7], [17].

TABLE II SINR THRESHOLDS FOR ALL SF PAIRS

Desired SINR 7 8 9 10 11 12

7

6 -16 -18 -19 -19 -20

8

-24 6 -20 -22 -22 -22

9

-27 -27 6 -23 -25 -25

10

-30 -30 -30 6 -26 -28

11

-33 -33 -33 -33 6 -29

12

-36 -36 -36 -36 -36 6

Subsequently, new works integrate this result in their evaluation of the LoRa network. Thus, [18] developed a simulation model where co/cross-SF interferences were considered to derive the impact of the IoT trafﬁc on the LoRaWAN performance. In [4], the authors thoroughly examined the SF orthogonality aspect and demonstrated the efﬁciency of using different SFs in pipelined multihop LoRaWANs. [5] proposes an analytical model of the LoRaWAN saturation throughput under orthogonal and non orthogonal SF conditions. Despite its novelty, the model presented in [5] only focused on the saturation throughput derivation while ignoring how IoT applications, with their different characteristics, impact this network performance. Moreover, throughput expressions were derived using slotted Aloha access scheme whereas class A users contend for the medium through pure Aloha. The usage of a slotted access scheme requires a regular gateway synchronization [19] which is not always possible in class A LoRaWAN where most of the trafﬁc is unacknowledged. In addition, the model does not integrate duty cycle and multi-channel properties. Finally, in the case of imperfect SF orthogonality, mutuel spreading factors’ SINR thresholds were not considered individually and only rough estimations of cross-SF SINR margins were integrated for the model evaluation.
C. Main contributions
From the above discussion of the LoRaWAN state of art and related work, we can clearly state the paper contributions as follows:
1) We propose here an analytical model of a single cell LoRaWAN to derive its performance under orthogonal and non-orthogonal spreading factors’ transmissions. The performance will be evaluated in terms of the achievable throughput at the gateway, the number of received packets

per end device and the percentage of successful transmissions. 2) The analysis will be conducted under unsaturated trafﬁc conditions to illustrate how IoT applications’ characteristics impact the network performance. 3) The pure Aloha access scheme will be considered at the network layer [1]. In the opposite to slotted Aloha, with pure Aloha transmissions are not synchronized. Thus a tagged packet transmission can be annoyed by early or late transmitters [20] which signiﬁcantly deviates the network performance. 4) Both duty cycle and multi-channel aspects will be considered in the analytical model. 5) In the case of non-orthogonal SFs, the network performance parameters will be derived given exact values of mutual SINR thresholds.
III. SYSTEM DESCRIPTION
In this paper, we focus on the LoRaWAN evaluation under unsaturated trafﬁc conditions for two case studies: orthogonal and non-orthogonal spreading factors’ transmissions. Thus, depending on the SF orthogonality considerations (perfect or imperfect orthogonality), a signal at the gateway will be correctly received if one or more of the three following capture conditions are met:
• Condition 1: The signal power received at a given spreading factor SFi must be above the signal to noise ratio (SNR) required for that spreading factor as shown in Table I.
• Condition 2: A signal transmitted at a spreading factor SFi is correctly captured if the co-SF SIN R(i, i) is higher than a given threshold θii (i.e. the transmitted signal can not be disturbed by other transmissions using the same SF ).
• Condition 3: A signal transmitted at a spreading factor SFi is correctly captured if for each SFj, j = i, we have SIN R(i, j) is higher than θij (i.e. the transmitted signal can not be disturbed by any other transmission using any other spreading factor SFj).
Therefore, we ﬁrst deﬁne the radio propagation and the network models we adopt in our study.
A. Propagation model and physical layer parameters
According to the above description of the LoRa modulation scheme in Section II-A1, we can state the following assumptions related to the model we adopt at the physical layer:
1) The end devices are all equipped with LoRa transceivers and transmit at a ﬁxed power P0.
2) We assume that the transmitted signals are subject to path loss, shadowing and fading effects where:
- follows from the Friis transmission equation [16], the path loss attenuation function g(r) = fc/(4πr)α, where fc is the carrier frequency, α is the path loss exponent (α = 2.7 in sub-urban environments) and r is the distance (in m) to the gateway.

- the channel gain due to fading between an end-device and the gateway is given by |h0 |2. We have |h0 |2 N (0, 1) for the Rayleigh fading [16], [5].
- the shadowing adds zero-mean AWGN to the path loss with noise variance:
σ2 = −174 + N F + 10log(BW ) [dBm], (2)

where BW is the signal bandwidth. N F is the receiver’s noise ﬁgure that can be considered to have a value of 6 dB in the hardware implementations [17].

3) In the LoRa network, end devices can transmit at a given spreading factor SFi belonging to the set S = {SF1, ..., SFK } of spreading factors (K = 6). We have: SF1 = 7 and SFK = 12. Thus, given assumptions 1 and 2 and according to [5], a signal transmitted using SFi can be received at a maximum distance li from the emitter:

1

li =

P0fc (4π)α ψi

α

(3)

where ψi is the receiver’s sensitivity at SFi (cf. Table I). 4) Given the Rayleigh-faded envelope of the transmitted
signal, the instantaneous signal to noise ratio (SNR) γ0 of an end device ED0 at the receiver situated at a distance r0 from ED0 is exponentially distributed as [21]:

1 fΓ0 (γ0) = γ0 exp

γ0 γ0

(4)

where γ0 is the local-mean SNR of the transmitted signal at the receiver:

γ0

=

P0fc (4πr0)ασ2

= βr−α 0

(5)

β

=

P0 fc (4π )α σ 2

is

constant

and

identical

for

all

the

end

devices.

B. Network model
Now that we have set the physical layer parameters, we focus here on the network model and consider the following assumptions:
1) The LoRa network is a single cell area of radius R where N end devices are uniformly distributed and transmit data to a single gateway G0 placed at the cell center and able to receive up to 8 signals in parallel [1]. R corresponds to the highest spreading factor’s (SF6 = 12) distance threshold. According to Equation (3), we have: R = l6 and G0 is placed at the radius l0 = 0.
2) Spreading factors are assigned to end devices according to their distances to the gateway. Thus, if a node ED0 is situated at a distance r0 from the gateway such as li−1 ≤ r0 ≤ li, it will be assigned the spreading factor SFi (cf. Figure 2). li−1 and li respectively correspond to SFi−1 and SFi distance thresholds given by Equation (3).
3) End devices have the same packet generation rate λ and the same packet size L.

Figure 2. LoRaWAN system setup: distance based SF allocation

4) Each end device implements M frequency channels.

According to the LoRa speciﬁcation, the minimum M

value is 3, which corresponds to the three mandatory

frequency channels in the EU 868 M Hz unlicensed band

[868.1, 868.3, 868.5] M Hz. In all these bands the duty

cycle limit is ﬁxed to d = 1%.

From the above assumptions, we can derive the following

notations:

• The time on air (T oA) for each SFi is evaluated as follows:

2SF i T oAi= BW (((NP+4.25) + SW + max (

ceil 8 P L − 4 SFi + 28 + 16 CRC − 20 IH 4(SFi − 2 DE)

(CR + 4) , 0)))

(6)

where:
- BW is the channel’s bandwidth. - NP is the number of preamble symbols (NP=8 bytes)
and SW is the length of synchronization word (SW =8 bits). - CRC and IH: specify the presence of CRC and physical header for the packet. We have, CRC=0 and IH=1 for the uplink trafﬁc. - DE : indicates the use of data rate optimization (DE = 1 for DR0 and DR1, i.e. SF6 = 12 and SF5 = 11). - CR : Coding rate. CR = 1 corresponds to 4/5 coding rate. - P L: the number of the physical layer payload bytes.

P L = 12 + F HDROP T S+F P ort + F RM P ayload (7)

where F HDROP T S is the length of the optional frame header ﬁeld carrying MAC commands, F P ort = 1 is

the application speciﬁc port. F RM P ayload is the size

in bytes of the application payload.

• Let λM i , be the packet generation rate per channel of a given end device transmitting at the spreading factor SFi.

λM i

=

λ min(
M

,

d )
T oAi

(8)

where

λ M

is the packet generation rate per channel per

end device and d is the duty cycle limit per channel and

is identical for all the channels [15].

• We deﬁne by Ni, the number of nodes using the spreading factor SFi, i.e. the end devices situated in the annulus deﬁned by the smaller and the larger radii li−1 and li.

From assumptions 1 and 2, we have :

li 2r

Ni = N

dr R2
li−1

where R is the network communication radius.

IV. LORAWAN PERFORMANCE ANALYSIS
This section is dedicated to the LoRaWAN performance analysis. We ﬁrst evaluate the throughput metric achieved at the gateway G0. In reference to [15] and under the assumption of pure Aloha access, the LoRaWAN capacity at the MAC layer can be roughly calculated as the superposition of independent ALOHA-based networks (one independent network for each channel and for each SF). In this context, the expression of the throughput B can be evaluated as:

K

K

B =M

BiM = M

NiρM i e−2NiρM i

(9)

i=1

i=1

where BiM is the per channel throughput achieved by all the nodes transmitting at SFi. ρM i is the per channel offered load of an end device transmitting at SFi.

ρM i = λM i T oAi

(10)

The expression of B in Equation (9) assumes that two signals with the same SF obviously collide at G0. But concurrent transmissions at different SFs could be perfectly decoded.
In reality, and in accordance with the related work discussion in Section II-B, the phenomena that occur at the physical layer deviate the throughput actually achieved at G0. Indeed, the gateway could perfectly decode two signals transmitted with the same SFi if the SINR between these two signals is above a certain threshold. On the other hand, signals transmitted at other SFj could preclude the correct reception of the SFi signal if the mutuel (SFi, SFj) SINR margin is below a given value. In the following we derive the correct throughput expressions in both perfect and imperfect SF orthogonality situations.

A. Case Study 1: Orthogonal Spreading Factors conditions

In this ﬁrst case of study, we are in perfect SF orthogonality

conditions, i.e. the signals coming from two different SFs do

not interfere with each other. Thus, the correct reception of a signal transmitted by an end device ED0i (using SFi and placed at a distance ri0 from G0) is subject to the capture conditions 1 and 2 as deﬁned in Section III. The condition 1

can be rewritten as:

γi0 ≥ γith

(11)

where γi0 is the node ED0i SNR as deﬁned in Section III-A and γith is the SFi SNR threshold given in the last column of the Table I.
Given the general SINR expression [7] and using the noise variance normalization, condition 2 can be formulated as [5]:

SIN R(i, i) =

γi0

ni p=1

γip

+1

≥

θii

(12)

where γip is the SNR of the node EDpi , interfering with ED0i at the same channel and the same SFi. ni is the number of interfering packets at SFi and θii is the co-SFi SINR
threshold as deﬁned in Table II. According to [22], [20] we can express BiM , the per channel
SFi throughput as:

Ni −1

BiM = NiρM i

P Capture EDi0/ni Pr [ni] (13)

ni =0

where ni is the number of interferers at SFi, P Capture EDi0/ni is the probability that the ED0i signal is correctly captured at G0 given ni interferers.
Let fΓi (γ) (resp. FΓi (γ)) be the pdf (resp. the complementary density function (cdf )) of the SFi SNR at G0. We also deﬁne Zi, the random variable corresponding to the SINR observed at G0 by a packet transmitted at SFi, which pdf is fZi and cdf is FZi . If ni = 0, then the probability of capture is conditioned by the fulﬁllment of only condition 1.
Otherwise, if ni > 0, the satisfaction of condition 2 implies the satisfaction of condition 1 too (We said that condition 2
is dominant on condition 1) [5]. Thus:

BiM

=

Ni

ρM i

e−2Ni

ρM i

[FΓi

(γ

th i

+

Ni −1 ni =1

( ) 2NiρM i ni
ni !

FZi/n(θii))

(14)

If we focus on a particular end device ED0i placed at a

distance

ri0

from

G0,

the

pdf

of

ED0i

SNR

denoted

by

fΓ0i

(γ

0 i

)

is given by Equation (4). Moreover, as nodes using SFi are

placed in the annulus ϑi deﬁned by radii li and li−1, the pdf

of the distance ri0 to the gateway of a randomly chosen node

ED0i

within

the

annulus

ϑi

is

fϑi (ri0)

=

, 2ri0
|ϑi |

where

|ϑi|

=

(li2 − li2−1) [16]. Therefore, according to Equation 11 and in

reference to [21], we get:

FΓi

(γ

th i

)

=

∞ ri0=0

∞ γ =γith

fΓ0i

(γ

0 i

)dγi0

fϑi (ri0)dri0

=

li ri0 =li−1

exp

( ) γith ri0 α
β

2ri0 |ϑi |

dri0

(15)

Now, we go through the evaluation of fZi/ni (z), the pdf of the random variable Zi given the presence of ni interferers at SFi. For pure Aloha, the transmission of a packet P0i at time instant t0 by the node ED0i can interfere at SFi either with early transmitters (packets transmitted before t0)
or late transmitters (packets transmitted after t0). Thus, the vulnerability period of P0i corresponds to the time interval [t0 − T oAi, t0 + T oAi] = 2 ∗ T oAi, where T oAi is the time on air of the packet P0i. Hence, given ni, the number of

SFi interferers during time interval 2 ∗ T oAi, there are 2ni Hence, BiM is obtained by replacing the expression of

possible realizations of early and late interferers during this FZi/ni (θii) given by the equation (22) in the equation (14).

interval. A realization rnki = Inki (t0), Inki (t1), ..., Inki (tni ) is a vector of values Inki (ti) that correspond to the number of interferers left after the occurrence of the ith event (arrival of late interferer or departure of early interferer). If we denote

The overall throughput achieved at the gateway will be equal

to B = M

K i=1

BiM

.

B. Case Study 2: Non-orthogonal Spreading factors

by j, the maximum number of interferers during time interval In this second case of study, we consider that transmissions

2 ∗ T oAi,

ni 2

≤ j ≤ ni, there will be Cni (j) realizations

among 2ni where j is the maximum number of interferers

at different spreading factors interfere with each other, thus precluding from a correct signal reception at the gateway

during 2 ∗ T oAi [20]. The explicit expression of Cni (j) is given in Equation (9b) in [20]. Thus:

unless the three capture conditions deﬁned in Section III are satisﬁed. As conditions 1 and 2 were already considered in

1

ni

fZi/ni (z) = 2ni

Cni (j)fZi/ni,j (z)

j= ni/2

(16)

Let γi1, γi2, ..γij be the SNRs of the j packets, respectively situated at positions ri1, ri2, ..rij from the gateway and inter-

the computation of the throughput in perfect SF-orthogonality
conditions, we focus here on the third condition formulation
related to cross-SF interferences. Therefore, for each transmission of an ED0i at SFi, cross-SINR thresholds with each spreading factor SFj, j = i should also be satisﬁed. Thus, condition 3 becomes:

fering with the packet P0i, having an SNR γi0 and placed at

position ri0 from G0. ∈ [0, j], fΓpi (γip) =

According to Equation (4), for each p

1 γip

exp(−

γip γip

),

where

γip

=

β (rip)−α.

Let W =

j p=1

Γpi ,

be

the

random

variable

corresponding

the sum of the j interfering packets SNRs, whose pdf is

SIN R(i, j) =

γi0

nj p=1

γjp

+1

≥

θij

(23)

where nj is the number of SFj nodes interfering with ED0i .
θij is the cross-SIN R(i, j) threshold as deﬁned in Table II. Analogically to Equation (13), we can write BiM here as:

fW (w) = fΓ1i ... fΓji (w). Therefore, according to [22],

N1

NK

we can write:

BiM = NiρM i

...

P [capture EDi0 /n1,...,nK ] Pr [n1, ..., nK ]

fZi/ni,j,ri1,ri2...rij (z)

=

∞ w=1

wf

Γ0i

(zw)

fΓ1i

...

fΓji (w − 1)dw

(17)

n1=0 nK =0
(24) where P [capture EDi0 /n1,...,nK ] is the probability that

Using the Fubini theorem in relation with the convolution a packet transmitted by ED0i is correctly captured while

product [23] and after variable change we obtain:

n1, ..., nK interferers are transmitting at spreading factors

ffZΓ1ii/(nγi1i,j),.r.i0.f,rΓi1ji..(.rγijji()zd)γ=i1...dγ∞i0γ=ji 0 ...

∞ γip =0

fΓ0i

(z(1

+

γ1i +...

+

γ

j i

))

SF1, ..., SFK . Thus, as in the orthogonal SF case, if (n1, ..., nK ) = (0, ..., 0) , only condition 1 applies. Otherwise, conditions 2 and 3 are dominant on condition 1 [5]. Moreover,

(18) we assume that SIN R thresholds at each spreading factor

Then, according to [21], [24] and by integrating over should be satisﬁed independently of each other [16], [7]. We,

γi0, γi1, ..γij, we obtain:

therefore deﬁne Zij, the random variable of the SFi SINR observed at G0 in the presence of SFj interferers, which pdf

j

1

FZi/ni,j,ri0,ri1,ri2...rij (z) = p=1 1 + z

rip ri0

z −α exp(

ri0

α
)

β

(19)

As ri0, ri1, ri2...rij are identically distributed and by integrating over ri0, ri1, ri2...rij, we have:

FZi/ni,j (z) =

li ri0 =li−1

I (ri0 )

j

z exp(

ri0 β

α

)

2ri0 |ϑi|

dri0

(20)

where I(ri0) is evaluated as [21]:

is fZij and cdf is FZij . Moreover, if the number of SFj interferers, nj = 0, then we set FZij/nj = 1. Hence:

K

BiM

=

Ni

ρM i

− Nl
e l=1

ρM l

Fγi

(γ

th i

)+

K
Π
l=1

Nl

FZil

/nl

(θil

)

(Nl

ρM l nl !

)nl

nl =1,(n1 ...nk )=(0...0)

(25)

where FZil/nl (θil) is evaluated in the same way as FZi/ni (z) given by Equation (22). Nl is the number of

I(ri0) =

li

2 ∗ rip

drip

rip =li−1

|ϑi| 1 + z

rip ri0

−α

(21)

Finally, by a simple integration of the equation (16), we

obtain:

FZi/ni (z)

=

1 2ni

×

ni j= ni/2

Cni (j)

li ri0 =li−1

I (ri0 )

j

exp(

z(ri0
β

)α

)

2ri0 |ϑi |

dri0

(22)

interferers at SFl. We have Nl = Nl, if l = i and Ni = Ni −1

for SFi. The throughput B at the gateway G0 will then be

equal to M

K i=1

BiM

.

From the above throughput metric, we derive two other

metrics to be also applied in orthogonal SF conditions:

- Λ : The total number of packets received at the gateway per

end device:

K
Λ= M

BiM

(26)

i=1 Ni ∗ T oAi

- Psucc : The probability (percentage) of successful transmissions at the gateway that can be approximated by:

Psucc≈ M

= B

K i=1

N

iρM i

B M ∗N ρ

(27)

where ρ is the average offered load per channel per end

K

device given by ρ =

Ni N

ρM i

.

i=1

V. NUMERICAL RESULTS

In this section, we proceed to the numerical evaluation of the LoRaWAN model presented above under orthogonal and nonorthogonal spreading factor conditions. We adopt the Matlab tool for implementations in conjunction with python scripts. Table III summarizes the main parameters we adopt in our implementations.

TABLE III MODEL PARAMETERS

Parameter
Channels’ number (M ) Carrier frequency (fc) Emission power (P0) Bandwidth (BW ) Path loss exponent (α) Coding rate (CR) Spreading factors Distance Thresholds

Value
3 868.1 868.2 868.3 M hz 14 dbm 125 Khz 2.7 4/5 SF1 = 7 to SF6 = 12 l0=0 km, l1=3.52 km, l2=4.86 km, l3=5.78 km, l4=6.28 km, l5=7.15 km, l6=8.13 km

According to table III, all the nodes transmit at the same power P0 = 14 dbm and each device implements the three mandatory channels [868.1, 868.3, 868.5] in the EU 868 M Hz ISM band and transmits at a maximum duty cycle d = 1%. Figure 3, depicts the LoRaWAN throughput (in kbps) achieved at G0 for different deployment scenarios and for different values of the average offered load/channel per end device ρ deﬁned in the previous section. Throughput values are derived under orthogonal and non orthogonal SF conditions and in comparison to the reference pure Aloha throughput.
All the curves in ﬁgures 3(a) to 3(d) show that in perfect SF orthogonality conditions, the capture effect that considers the co-SF interferences, allows improving the theoretical throughput achieved by pure Aloha access scheme. Indeed, with pure Aloha, if two signals are transmitted simultaneously, they obviously collide. Whereas, when considering the co-SF interferences, a signal can be decoded at a given spreading factor as long as its strength is higher than the SINR threshold for that SF. Moreover, if we consider the more realistic imperfect SF orthogonality scenario, we notice that throughput values decrease compared to pure Aloha and perfect SF orthogonality conditions.
In ﬁgures 3(a) to 3(d) throughput values respectively achieved by the 3 access schemes increase as we increase the offered load/channel ρ. Indeed, for a given number of

end devices N = 300, and ρ = 0.5%, the throughput values achieved by pure Aloha, Lora with orthogonal SFs and LoRa with non-orthogonal SFs are respectively 2.64 kbps, 2.91 kbps and 2.41 kbps. These values decrease to 3.14 kbps, 3.79 kbps and 2.78 kbps when ρ = 1% and for same number of EDs. Moreover, we notice that for all these scenarios, the gap between the three access schemes’ throughput increases with the number of nodes in the network.
In Figures 3(e) and 3(f), we focus on the throughput variation with the offered load ρ. For the two considered scenarios (N = 200 and N = 600), throughput values increase until ρ reaches the value of 1% which corresponds to the duty cycle limit per channel deﬁned by the LoRaWAN speciﬁcations for the three mandatory channels [868.1,868.3,868.5] M Hz. An additional aspect could be noticed in Figure 3(a) where for a small number of nodes (N = 100), the throughput obtained in the case of non-orthogonal SFs is higher than the one obtained with pure Aloha. We explain this by the fact that when the number of end devices is small, signals could be decoded even in the presence of concurrent transmissions on other spreading factors as long as the SINR threshold is not reached.
This aspect is further illustrated is Figure 4(a) where we depict the number of the received packets per device at the gateway Vs. the packet generation rate/hour per device λ. Thus for, N = 100, λ = 223 packts/hour and a packet size = 30 bytes, the number of received packets with pure Aloha and LoRa with non-orthogonal SFs are respectively given by 190 pkts/hour and 197 pkts/hour. Whereas, if we increase the packet arrival rate λ to 794 packets/hour (for a packet size = 10 bytes), the number of received packets with pure Aloha is always higher than the one of LoRa with non orthogonal SFs (no matter the number of EDs). For LoRa with orthogonal SFs, however, the number of received packets at the gateway per end device is always higher than Aloha and Lora with non-orthogonal SFs. As in Figure 3(e) and 3(f), Figure 4(c) shows that the number of received packets per device is limited by the duty cycle bound above which it remains unchanged. Figure 4(d), illustrates the variation of the received packets’ number with the packet size. We notice that, initially, the number of delivered packets increases with the packet size, then the curves’ increase aspect slows down as packet sizes become higher. This is due to the fact that high packet sizes signiﬁcantly increase the time on air which directly impact the delivered packets’ number. As a ﬁnal step of the LoRaWAN performance evaluation, we depict in Figures 5(a) and 5(b), the probability of successful transmissions. The results in Figures 5(a) and 5(b) corroborate those obtained in previous Figures 4(a) and 4(b) and show that the percentage of successful transmissions reversely decrease with the number of end devices and the trafﬁc load (determined by the packet generation rate and the packet size). This decrease is more signiﬁcant if the realistic non-orthogonal SF scenario is considered.
For the sake of completeness, we also consider in Table IV different IoT applications [12] for which we characterize the network capacity to achieve high successful transmission probabilities (80% and 90%). From Table IV, we notice

(a) Offered load per channel/ED (b) Offered load per channel/ED (c) Offered load per channel/ED (d) Offered load per channel/ED

ρ=0.3%

ρ=0.5%

ρ=0.8%

ρ=1% (duty cycle limit)

(e) Throughput Vs. Offered load (f) Throughput Vs. Offered load ρ

ρ (ED number=200)

(ED number=600)

Figure 3. LoRaWAN Throughput achieved at the gateway G0 (kpbs)

(a) packet generation rate λ=233 (b) packet generation rate λ=743

pkts/hour per ED, packet size=30 pkts/hour per ED, packet size=10

bytes

bytes

(a) packet generation rate λ=233 pkts/hour per ED,
packet size=30 bytes

(b) packet generation rate λ=743 pkts/hour per ED, packet
size=10 bytes

Figure 5. Probability of successful transmission (%)

(c) Number of received pkts Vs. (d) Number of received pkts Vs.

packet generation rate λ

packet size

Figure 4. Average number of received packets/hour per end device

that the network capacity depends on the IoT application’s characteristics. Thus, for some applications as Roadway signs (where ρ approaches on each channel 50% of the duty cycle), to achieve a high successful transmission percentage (90% for example), the number of end devices under non-orthogonal SFs should not exceed 53 nodes. This number is very small if the IoT application targets the coverage of a whole city. In this context, a multi-gateway deployment would be necessary, as recommended in [11]. Moreover, if pure Aloha or LoRa with orthogonal SFs models are considered to achieve the network

dimensioning, this will result in an over estimation of the effective network capacity. As a consequence, the expected percentage of successful transmissions would not be satisﬁed.
From the above evaluation of LoRaWAN in both orthogonal and non-orthogonal SF conditions and in comparison with pure Aloha, we can conclude that:
• Considering the imperfect SF orthogonality conditions, which are more prone to sustain the real LoRaWAN implementations, has a direct impact on the network performance in terms of achievable throughput at the gateway, the number of delivered packets per end device or the percentage of successful transmissions.
• The LoRaWAN network designer should, imperatively, proceed to the network dimensioning thus to ensure the satisfaction of the expected quality of Service (QoS).
• For some IoT applications, where a certain network density is required to satisfy all the users’ needs, a multigateway deployment would be preferable to a single cell topology where we are limited by a given number of end devices to achieve a certain QoS.

TABLE IV LORAWAN CAPACITY FOR DIFFERENT IOT APPLICATIONS

IoT Application

Prob. of success (Pure Aloha)

80%

90%

Roadway signs (message period= 30.03 s, 140

60

message size= 1 byte)

Trafﬁc lights (message period= 59.88 s, 232

118

message size= 1 byte)

Credit machine in a shop (message pe- 276

115

riod= 120.48 s, message size= 24 bytes)

Prob. of success

(Lora with or-

thogonal SFs)

80%

90%

180

84

320

140

363

154

Prob. of success

(Lora with non-

orthogonal SFs)

80%

90%

120

53

213

99

244

108

VI. CONCLUSION
In this paper, we focus on the single cell LoRaWAN analysis under unsaturated trafﬁc, multi-channel and duty cycle conditions. We consider both cases of orthogonal and nonorthogonal spreading factors’ transmissions. We ﬁrst, review the background and the work in relation with LoRaWAN performance evaluation. Then, we set the main assumptions at the physical and the network layers we adopt in our analysis. Therefore, we derive the throughput expressions we obtain in perfect and imperfect spreading transmissions. From the throughput, we derive two other performance metrics corresponding to the number of packets delivered per end device and the percentage of successful transmissions. All the results show that considering the imperfect spreading factors’ orthogonality in LoRaWAN slows down the network performance in comparison with pure Aloha or a network with perfect SF orthogonality. The imperfect SF orthogonality is a real phenomenon in LoRaWAN and should not be neglected when proceeding to network dimensioning. Moreover, as pure Aloha is adopted at the MAC layer in LoRaWAN, then to satisfy a certain QoS for some IoT applications, the network density show remain relatively low. Thus, a multi-gateway LoRaWAN should be adopted. As a future work, we intend to extend our study to a multi-gateway scenario where capture probabilities should account for gateways’ intersection zones.
REFERENCES
[1] N. Sornin, M. Luis, T. Eirich, T. Kramp, and O. Hersent, LoRaWAN Speciﬁcations 1.0, Std., 2016.
[2] “Lora modulation basics-an1200.22,” Semtech Corporation, Tech. Rep., May 2015.
[3] D. Croce, M. Gucciardo, S. Mangione, G. Santaromita, and I. Tinnirello, “Impact of lora imperfect orthogonality: Analysis of link-level performance,” IEEE Commun. Lett., vol. 22, no. 4, 2018.
[4] G. Zhu, C.-H. Liao, M. Suzuki, Y. Narusue, and H. Morikawa, “Evaluation of lora receiver performance under co-technology interference,” in Proc. CCNC, 2018.
[5] A. Waret, M. Kaneko, A. Guitton, and N. E. Rachkidy, “Lora throughput analysis with imperfect spreading factor orthogonality,” in arXiv:1803.06534v1 [cs.NI], 2018.
[6] F. V. den Abeele, J. Haxhibeqiri, I. Moerman, and J. Hoebeke, “Scalability analysis of large-scale lorawan networks in ns-3,” IEEE Internet Things J., vol. 4, no. 6, 2017.

[7] D. Magrin, M. Centenaro, and L. Vangelista, “Performance evaluation of lora networks in a smart city scenario,” in Proc. IEEE ICC, 2017.
[8] M. Bor, J. Vidler, and U. Roedig, “Lora for the internet of things,” in Proc. EWSN ’16, 2016.
[9] J. Petajajarvi, K. Mikhaylov, A. Roivainen, T. Hanninen, and M. Pettissalo, “On the coverage of lpwans: range evaluation and channel attenuation model for lora technology,” in Proc. ITST, Dec. 2015.
[10] ——, “Evaluation of lora lpwan technology for remote health and wellbeing monitoring,” in Proc. ISMICT, 2016.
[11] T. V. M. Bor, U. Roedig and J. M. Alonso, “Do lora low-power wide-area networks scale?” in Proc. ACM MSWIM, 2016.
[12] K. Mikhaylov, J.Petajajarvi, and T. Hanninen, “Analysis of capacity and scalability of the lora low power wide area network technology,” in Proc. EW’16, 2016.
[13] R. V. L. Casals, B. Mir and C. Gomez, “Modeling the energy performance of lorawan,” Sensors journal, October 2017.
[14] F. Delobel, N. E. Rachkidy, and A. Guitton, “Analysis of the delay of conﬁrmed downlink frames in class b of lorawan,” in Proc. VTC Spring’17, 2017.
[15] F. Adelantado, X. Vilajosana, P. Tuset-Peiro, B. Martinez, J. Melia-Segui, and T. Watteyne, “Understanding the limits of lorawan,” IEEE Commun. Mag., vol. 55, no. 9, 2017.
[16] O. Georgiou and U. Raza, “Low power wide area network analysis: Can lora scale?” IEEE Wireless Commun. Lett., vol. 6, no. 2, 2017.
[17] C. Goursaud and J. Gorce, “Dedicated networks for iot: Phy/mac state of the art and challenges,” EAI Endorsed Transactions on Internet of Things, vol. 1, no. 1, 2015.
[18] V. Gupta, S. K. Devar, N. H. Kumar, and K. P. Bagadi, “Modelling of iot trafﬁc and its impact on lorawan,” in Proc. IEEE Globecom’17, 2017.
[19] B. Ray, “Improving lorawan scalability,” Link Labs, Tech. Rep., January 2017.
[20] R. Borchardt and T. Ha, “Power capture aloha,” in Proc. MILCOM’88, 1988.
[21] Z. Hadzi-Velkov and B. Spasenovski, “Capture effect in ieee 802.11 basic service area under inﬂuence of rayleigh fading and near/far effect,” in Proc. IEEE PIMRC, 2002.
[22] J. Arnbak and W. van Blitterswijk, “Capacity of slotted aloha in rayleigh-fading channels,” IEEE Sel. Areas Commun., vol. 5, no. 2, 1987.
[23] H. S. Chung, D. Skoug, and S. J. Chang, “A fubini theorem for integral transforms and convolution products,” International Journal of Mathematics, vol. 24, no. 3, 2012.
[24] M. Haenggi, “On routing in random rayleigh fading networks,” IEEE Trans. Wireless Commun., vol. 4, no. 4, 2018.

